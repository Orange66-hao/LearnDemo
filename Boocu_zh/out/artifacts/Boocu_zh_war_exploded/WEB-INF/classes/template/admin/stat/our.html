<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=9" > </meta>
<title>晧辰仪联网-客户检测</title>
<style type="text/css">
body{
	margin:0px;
	font-family:Arial,"宋体",Verdana,sans-serif;
	font-size:100px;
}
html,body {padding: 0;margin: 0; overflow-x:hidden; overflow-y:auto;}
dl,dd{margin:0px}
ul{
	list-style-type:none;
	margin:0px;
	padding:0px;
	
}
#tj .tableDiv table tr:nth-child(even)  td:hover{
	background-color:#C0C0C0;
	cursor:pointer;
}
</style>
<script type="text/javascript" src="/adminthemes/new/js/jquery-1.8.3.min.js"></script>
<link rel="stylesheet" type="text/css" href="/adminthemes/new/js/easy-ui/themes/gray/easyui.css"/>    
<link rel="stylesheet" type="text/css" href="/adminthemes/new/js/easy-ui/themes/icon.css"/>  
<script type="text/javascript" src="/adminthemes/new/js/easy-ui/jquery.easyui.min.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/easy-ui/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/jquery.blockUI.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/jquery.loading.js"></script>
<link href="/adminthemes/new/css/main.css" rel="stylesheet" type="text/css" />
<link href="/adminthemes/new/css/style.css" rel="stylesheet" type="text/css" />
<link href="/statics/css/daterangepicker.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css"
	href="/adminthemes/new/js/easy-ui/themes/loading.css" />
	<link rel="stylesheet" type="text/css" href="/statics/iconfont/iconfont.css">
<script src="/statics/js/moment.min.js"></script>
<script src="/statics/js/jquery.daterangepicker.js"></script>
<script src="/statics/js/highcharts.js"></script>
<script src="/statics/js/exporting.js"></script>
<script type="text/javascript"
	src="/adminthemes/new/js/loading.js"></script>
		</script>
<script type="text/javascript">
$(function () {
	//加载时间插件
	$('#time1').dateRangePicker();
	/* $('#time2').dateRangePicker();
	$('#time3').dateRangePicker();
	$('#time4').dateRangePicker();
	$('#time5').dateRangePicker();
	$('#time6').dateRangePicker(); */
	
	/* loadData("",1,"container1");
	loadData("",2,"container2");
	loadData("",3,"container3");
	loadData("",4,"container4");
	loadData("",5,"container5");
	loadData("",6,"container6"); */
});

function loadData(time,type,container){
	$.ajax({
		url : "/stat/lvMostData.json",
		type : "POST",
		dataType : "JSON",
		data : {"time":time,"type":type},
		async: false,
		success:function(data){
			var proNo= data.mostName.split(",");
			var proVal = data.mostVal.split(",");
			var val = new Array();
			for(var i = 0;i < proVal.length;i++){
				val[i] = parseInt(proVal[i]);
			}
			var charts;
			charts = new Highcharts.Chart({
			//$(container).highcharts({
		        chart: {
		        	renderTo: container,
		            zoomType: 'xy'
		        },
		        title: {
		        	text: '发布最多的型号'
		        },
		        xAxis: [{
		            categories: proNo,
		            crosshair: true
		        }],
		        yAxis: [{ // Primary yAxis
		            title: {
		                text: '数量',
		                style: {
		                    color: Highcharts.getOptions().colors[1]
		                }
		            }
		        }, { // Secondary yAxis
		        }],
		        tooltip: {
		            shared: true
		        },
		        credits: {enabled: false},
		        series: [{
		            name: '发布次数',
		            type: 'column',
		            yAxis: 1,
		            data: val,
		            tooltip: {
		                valueSuffix: '次'
		            }
		        }]
			});
		}
	});
}
</script>
[#include '/template/admin/include/common.html']

</head>
<body>
<div id="loading"></div>
<div class="main">
	<div class="easyui-tabs" id="tj">
		<div title="统计" style="padding:10px;">
			<div class="clear height10"></div>
			<form id="memberform1" style="font-size: 16px;" >
				<div id="tb" style="height: auto">
					<span style="float: left;"> 
						<span id="simpleSearch">
							统计时间：<input id="time1" class="input_text" value="" size="30" name="statTime">
							<a href="javascript:;" class="easyui-linkbutton" data-options="plain:true" onclick="chTime('#time1',1,'container1','#saleList')">搜索</a>
							<b>提示：带图标的可以查看详情页！</b>
							<!-- <a href="javascript:;" class="easyui-linkbutton" data-options="plain:true" onclick="downLoadExcel('#time1',1)">下载</a> -->
						</span>
						
					</span>
				</div>
				<div class="clear height10"></div>
				<div class="shadowBoxWhite tableDiv" style="background-color:#b0e0e6" >
					<table id="tb2" border="1px" cellspacing="0" cellpadding="0" >
						<tr>
							<td>总用户数</td>
							<td>用户订阅总量</td>
							<td>新增用户</td>
							<td>用户登录数量</td>
							<td>发邮件数量</td>
							<td>点击数量</td>
						</tr>
						<tr style="background-color: white;">
							<td id="td1"></td>
							<td id="totalSubscribe"></td>
							<td id="newMember"></td>
							<td id="loginCell"></td>
							<td>111</td>
							<td id="clickCount">2223</td>
						</tr>
						<tr>
							<td>多少用户首次邮件订阅</td>
							<td>多少用户关闭邮件订阅</td>
							<td>多少用户首次手机订阅</td>
							<td>多少用户关闭了手机订阅</td>
						</tr>
						<tr style="background-color: white;">
							<td></td>
							<td id="emailCloseSubscribe"></td>
							<td></td>
							<td id="mobileCloseSubscribe"></td>
						</tr>
						<tr>
							<td>总共累计产品数</td>
							<td>销售</td>
							<td>求购</td>
							<td>租赁</td>
							<td>求租</td>
							<td>维修</td>
							<td>求修</td>
							<td>测试方案</td>
							<td>方案需求</td>
							<td>招标</td>
							<td>产品测试</td>
							<td>测试需求</td>
							<td>计量校准</td>
							
						</tr>
						<tr style="background-color: white;">
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td>新增产品数</td>
							<td>新增销售</td>
							<td>新增求购</td>
							<td>新增租赁</td>
							<td>新增求租</td>
							<td>新增维修</td>
							<td>新增求修</td>
							<td>新增测试方案</td>
							<td>新增方案需求</td>
							<td>新增招标</td>
							<td>新增产品测试</td>
							<td>新增测试需求</td>
							<td>新增计量校准</td>
							
						</tr>
						<tr style="background-color: white;">
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td>总共累计多少家企业</td>
							<td>有新增多少企业</td>
							<td>多少企业进行登录</td>
						</tr>
						<tr style="background-color: white;">
							<td></td>
							<td></td>
							<td></td>
						</tr>
					</table>
				</div>
			</form>
			<div class="slistd" id="loading-content" ></div>
			<div id="dlg" class="easyui-dialog" title="用户登录情况" data-options="iconCls:'icon-tip',closed:'true'" style="width:800px;height:500px;padding:10px;">
				<table id="dg"></table>
			</div>
			<div id="newMemberdlg" class="easyui-dialog" title="新增用户" data-options="iconCls:'icon-tip',closed:'true'" style="width:800px;height:500px;padding:10px;">
				<table id="newMemberdg"></table>
			</div>
			<div id="totalSubscribedlg" class="easyui-dialog" title="用户订阅总数" data-options="iconCls:'icon-tip',closed:'true'" style="width:800px;height:500px;padding:10px;">
				<table id="totalSubscribedg"></table>
			</div>
			<div id="emailCloseSubscribedlg" class="easyui-dialog" title="关闭邮件订阅详情" data-options="iconCls:'icon-tip',closed:'true'" style="width:800px;height:500px;padding:10px;">
				<table id="emailCloseSubscribedg"></table>
			</div>
			<div id="mobileCloseSubscribedlg" class="easyui-dialog" title="关闭手机订阅详情" data-options="iconCls:'icon-tip',closed:'true'" style="width:800px;height:500px;padding:10px;">
				<table id="mobileCloseSubscribedg"></table>
			</div>
            <div id="clickCountdlg" class="easyui-dialog" title="用户点击详情" data-options="iconCls:'icon-tip',closed:'true'" style="width:800px;height:500px;padding:10px;">
                <table id="clickCountDatagrid"></table>
            </div>
		</div>
</div>
<script type="text/javascript" src="/adminthemes/js/BooCu.js"></script>
<script type="text/javascript">
$(function(){
	chTime('#time1',1,'container1','#saleList')
	/* $("#loginCell")[0].onclick=function(){
		/* var a=$("#td1")[0]
		alert($("#td1")[0].innerText); 
		alert()
	} */
	function formdate(value, row, index) {
		if(value != null){
                return new Date(value).format("yyyy-MM-dd");
		}
	}
	function formtUsertype(value, row, index) {
		if(value != null&&value=='personal'){
			return '个人';
		}else{
			return '企业';
		}
	}
	
	$("#mobileCloseSubscribe")[0].onclick=function(){
		$('#mobileCloseSubscribedg').datagrid({
		    url:'/member/getList.json',
		    pagination:true,
		    pageList:[5,10,15],
		    rownumbers:true,
		    fitColumns:true,
		    autoRowHeight:false,
		    nowrap:true,
		   	queryParams:{
		   		params:'mobileCloseSubscribe',
				time: $("#time1").val()
			},
		    columns:[[
		    	{field:'id',title:'ID',width:100,align:'center'},
				{field:'username',title:'用户名',width:100,align:'center'},
				{field:'realName',title:'真实姓名',width:100,align:'center'},
				{field:'mobile',title:'手机号码',width:100,align:'center'},
				{field:'createDate',title:'注册时间',width:100,align:'center',formatter:formdate},
				{field:'contacts',title:'联系人',width:100,align:'center'},
				{field:'userType',title:'用户类型',width:100,align:'center',formatter:formtUsertype}
		    ]],
		    onLoadSuccess:function(){
		    	if($("#mobileCloseSubscribedg").datagrid("getData").total<=0){
		    		$.messager.alert('提示','暂无数据!');
		    	}else{
		    		$("#mobileCloseSubscribedlg").dialog('open')
		    	}
		    }
		    	
		});
		
		
		
	}
	$("#emailCloseSubscribe")[0].onclick=function(){
		$('#emailCloseSubscribedg').datagrid({
		    url:'/member/getList.json',
		    pagination:true,
		    pageList:[5,10,15],
		    rownumbers:true,
		    fitColumns:true,
		    autoRowHeight:false,
		    nowrap:true,
		   	queryParams:{
		   		params:'emailCloseSubscribe',
				time: $("#time1").val()
			},
		    columns:[[
		    	{field:'id',title:'ID',width:100,align:'center'},
				{field:'username',title:'用户名',width:100,align:'center'},
				{field:'realName',title:'真实姓名',width:100,align:'center'},
				{field:'mobile',title:'手机号码',width:100,align:'center'},
				{field:'createDate',title:'注册时间',width:100,align:'center',formatter:formdate},
				{field:'contacts',title:'联系人',width:100,align:'center'},
				{field:'userType',title:'用户类型',width:100,align:'center',formatter:formtUsertype}
		    ]],
			onLoadSuccess:function(){
		    	if($("#emailCloseSubscribedg").datagrid("getData").total<=0){
		    		$.messager.alert('提示','暂无数据!');
		    	}else{
		    		$("#emailCloseSubscribedlg").dialog('open')
		    	}
		    }
		});
		
	}
	$("#totalSubscribe")[0].onclick=function(){
		$('#totalSubscribedg').datagrid({
		    url:'/member/getList.json',
		    pagination:true,
		    pageList:[5,10,15],
		    rownumbers:true,
		    fitColumns:true,
		    autoRowHeight:false,
		    nowrap:true,
		   	queryParams:{
		   		params:'totalSubscribe',
				time: $("#time1").val()
			},
		    columns:[[
		    	{field:'id',title:'ID',width:100,align:'center'},
				{field:'username',title:'用户名',width:100,align:'center'},
				{field:'realName',title:'真实姓名',width:100,align:'center'},
				{field:'mobile',title:'手机号码',width:100,align:'center'},
				{field:'createDate',title:'注册时间',width:100,align:'center',formatter:formdate},
				{field:'contacts',title:'联系人',width:100,align:'center'},
				{field:'userType',title:'用户类型',width:100,align:'center',formatter:formtUsertype}
		    ]],
			onLoadSuccess:function(){
		    	if($("#totalSubscribedg").datagrid("getData").total<=0){
		    		$.messager.alert('提示','暂无数据!');
		    	}else{
		    		$("#totalSubscribedlg").dialog('open')
		    	}
		    }
		});
		
	}
	$("#newMember")[0].onclick=function(){
		this.disabled=true;
		$('#newMemberdg').datagrid({
		    url:'/member/getList.json',
		    pagination:true,
		    pageList:[5,10,15],
		    rownumbers:true,
		    fitColumns:true,
		    autoRowHeight:false,
		    nowrap:true,
		   	queryParams:{
		   		params:'newMember',
				time: $("#time1").val()
			},
		    columns:[[
		    	{field:'id',title:'ID',width:100,align:'center'},
				{field:'username',title:'用户名',width:100,align:'center'},
				{field:'realName',title:'真实姓名',width:100,align:'center'},
				{field:'mobile',title:'手机号码',width:100,align:'center'},
				{field:'loginDate',title:'最后登录日期',width:100,align:'center',formatter:formdate},
				{field:'contacts',title:'联系人',width:100,align:'center'},
				{field:'userType',title:'用户类型',width:100,align:'center',formatter:formtUsertype}
		    ]],
		    onLoadSuccess:function(){
		    	if($("#newMemberdg").datagrid("getData").total<=0){
		    		$.messager.alert('提示','暂无数据!');
		    	}else{
		    		$("#newMemberdlg").dialog('open')
		    	}
		    }
		});
		
	}
	$("#loginCell")[0].onclick=function(){
		$('#dg').datagrid({
		    url:'/member/getList.json',
		    pagination:true,
		    pageList:[5,10,15],
		    rownumbers:true,
		    fitColumns:true,
		    autoRowHeight:false,
		    nowrap:true,
		   	queryParams:{
		   		params:'loginCell',
				time: $("#time1").val()
			},
		    columns:[[
		    	{field:'id',title:'ID',width:100,align:'center'},
				{field:'username',title:'用户名',width:100,align:'center'},
				{field:'realName',title:'真实姓名',width:100,align:'center'},
				{field:'mobile',title:'手机号码',width:100,align:'center'},
				{field:'loginDate',title:'最后登录日期',width:100,align:'center',formatter:formdate},
				{field:'contacts',title:'联系人',width:100,align:'center'},
				{field:'userType',title:'用户类型',width:100,align:'center',formatter:formtUsertype}
		    ]],
		    onLoadSuccess:function(){
		    	if($("#dg").datagrid("getData").total<=0){
		    		$.messager.alert('提示','暂无数据!');
		    	}else{
		    		$("#dlg").dialog('open')
		    	}
		    }
		});
		
	}
    $("#clickCount")[0].onclick=function(){
        $('#clickCountDatagrid').datagrid({
            url:'/stat/getClickDeatilList.json',
            pagination:true,
            pageList:[5,10,15],
            rownumbers:true,
            fitColumns:true,
            autoRowHeight:false,
            nowrap:true,
            queryParams:{
                time: $("#time1").val()
            },
            columns:[[
                {field:'id',title:'ID',width:50,align:'center'},
                {field:'username',title:'用户名',width:100,align:'center'},
                {field:'co_name',title:'公司',width:190,align:'center'},
                {field:'pro_name',title:'产品名称',width:100,align:'center'},
                {field:'openType',title:'打开方式',width:100,align:'center',formatter:formatOpenType},
                {field:'clickCount',title:'点击次数',width:100,align:'center'},
                {field:'createDate',title:'最近一次打开日期',width:100,align:'center',formatter:formdate}
            ]],
            onLoadSuccess:function(){
                if($("#clickCountDatagrid").datagrid("getData").total<=0){
                    $.messager.alert('提示','暂无数据!');
                }else{
                    $("#clickCountdlg").dialog('open')
                }
            }
        });

    }
})
var count=1;
function chTime(id,type){
    count++;
	var time = $(id).val();
	if(time.length==0||time.length==24){
		$("#loading-content").html("")
		 var load = new Loading();
		load.init();
		load.start();
		$.ajax({ url: "/stat/sumMember.json", data:{'time':time},success: function(data){
		    //console.log($('#tabs').tabs('exists', "首页"))
            var flag;
            $.each(parent.$(".tabs-title"),function (i,e) {
               if(e.innerText=="首页"){
                   flag=true;
               }
            })
			load.stop();
			$("#tb2").children().children()[1].cells[0].innerHTML=data.totalMember;
			$("#tb2").children().children()[1].cells[1].innerHTML=data.totalSubscribe+"<i class='iconfont icon-dianji' style='float:right;box-sizing: border-box;'></i>";
			$("#tb2").children().children()[1].cells[2].innerHTML=data.totalNewMember+"<i class='iconfont icon-dianji' style='float:right;box-sizing: border-box;'></i>";
			$("#tb2").children().children()[1].cells[3].innerHTML=data.totalLoginMember+"<i class='iconfont icon-dianji' style='float:right;box-sizing: border-box;'></i>";
			$("#tb2").children().children()[1].cells[4].innerHTML=data.sendEmailCount+"<i class='iconfont icon-dianji' style='float:right;box-sizing: border-box;'></i>";
			$("#tb2").children().children()[1].cells[5].innerHTML=data.clickCount+"<i class='iconfont icon-dianji' style='float:right;box-sizing: border-box;'></i>";

			$("#tb2").children().children()[3].cells[0].innerText=data.totalNewSubscribe;
			$("#tb2").children().children()[3].cells[1].innerHTML=data.totalCloseSubscribe+"<i class='iconfont icon-dianji' style='float:right;box-sizing: border-box;'></i>";;
			$("#tb2").children().children()[3].cells[2].innerText=data.totalMobileSubscribe;
			$("#tb2").children().children()[3].cells[3].innerHTML=data.totalCloseMobileSubscribe+"<i class='iconfont icon-dianji' style='float:right;box-sizing: border-box;'></i>";;
			
			$("#tb2").children().children()[5].cells[0].innerText=data.userData.totalProduct;
			$("#tb2").children().children()[5].cells[1].innerText=data.userData.totalSale;
			$("#tb2").children().children()[5].cells[2].innerText=data.userData.totalPurchase;
			$("#tb2").children().children()[5].cells[3].innerText=data.userData.totalRentOut;
			$("#tb2").children().children()[5].cells[4].innerText=data.userData.totalWantRent;
			$("#tb2").children().children()[5].cells[5].innerText=data.userData.totalRepair;
			$("#tb2").children().children()[5].cells[6].innerText=data.userData.totalSeekingRepair;
			$("#tb2").children().children()[5].cells[7].innerText=data.userData.totalAutoTest;
			$("#tb2").children().children()[5].cells[8].innerText=data.userData.totalProjectNeed;
			$("#tb2").children().children()[5].cells[9].innerText=data.userData.totalInvite;
			$("#tb2").children().children()[5].cells[10].innerText=data.userData.totalProductTest;
			$("#tb2").children().children()[5].cells[11].innerText=data.userData.totalRequireTest;
			$("#tb2").children().children()[5].cells[12].innerText=data.userData.totalCalibration;
			$("#tb2").children().children()[7].cells[0].innerText=data.userData.addProduct;
			$("#tb2").children().children()[7].cells[1].innerText=data.userData.addSale;
			$("#tb2").children().children()[7].cells[2].innerText=data.userData.addPurchase;
			$("#tb2").children().children()[7].cells[3].innerText=data.userData.addRentOut;
			$("#tb2").children().children()[7].cells[4].innerText=data.userData.addWantRent;
			$("#tb2").children().children()[7].cells[5].innerText=data.userData.addRepair;
			$("#tb2").children().children()[7].cells[6].innerText=data.userData.addSeekingRepair;
			$("#tb2").children().children()[7].cells[7].innerText=data.userData.addAutoTest;
			$("#tb2").children().children()[7].cells[8].innerText=data.userData.addProjectNeed;
			$("#tb2").children().children()[7].cells[9].innerText=data.userData.addInvite;
			$("#tb2").children().children()[7].cells[10].innerText=data.userData.addProductTest;
			$("#tb2").children().children()[7].cells[11].innerText=data.userData.addRequireTest;
			$("#tb2").children().children()[7].cells[12].innerText=data.userData.addCalibration;
			$("#tb2").children().children()[9].cells[0].innerText=data.userData.totalCompany;
			$("#tb2").children().children()[9].cells[1].innerText=data.userData.addCompany;
			$("#tb2").children().children()[9].cells[2].innerText=data.userData.LoginCompany;
	   	}});
		
	}else{
		$.messager.alert('提示','请选择正确的时间!');
		return;
	}
    if(count==2){
        parent.addTab1("首页","/admin/home/summary.jspx");
    }
}
function formatOpenType(value, row, index) {
    if(row.open_type=="0"){
        return "PC";
    }else{
        return "手机";
    }
}
function downLoadExcel(id,type){
	var time = $(id).val();
	window.location.href="/stat/exportAddMostExcel.jspx?time="+time+"&type="+type;
}
</script>
</body>
</html>