
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=9">
</meta>
<title>云图商城-后台管理</title>
<style type="text/css">
body {
	margin: 0px;
	font-family: Arial, "宋体", Verdana, sans-serif;
	font-size: 12px;
}

html, body {
	padding: 0;
	margin: 0;
	overflow-x: hidden;
	overflow-y: auto;
}

dl, dd {
	margin: 0px
}

ul {
	list-style-type: none;
	margin: 0px;
	padding: 0px;
}

.prosortd {
	clear: both;
	margin-left: 10px;
	overflow: hidden;
	zoom: 1;
}

.prosortd p {
	float: left;
	padding-right: 120px;
	font-size: 14px;
}

.prosortd1 {
	clear: both;
	margin-left: 10px;
	overflow: hidden;
	zoom: 1;
}

.prosortd1 p {
	float: left;
	padding-right: 150px;
	font-size: 14px;
}

.prosortd2 {
	clear: both;
	margin-left: 240px;
	overflow: hidden;
	zoom: 1;
}

.prosortd2 p {
	float: left;
	padding-right: 150px;
	font-size: 14px;
}
</style>

<script type="text/javascript"
	src="/adminthemes/new/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript"
	src="/adminthemes/new/js/jquery-form-2.33.js"></script>
<script type="text/javascript" src="/statics/js/area_sql.js"></script>
<link rel="stylesheet" type="text/css"
	href="/adminthemes/new/js/easy-ui/themes/gray/easyui.css" />
<link rel="stylesheet" type="text/css"
	href="/adminthemes/new/js/easy-ui/themes/icon.css" />
<script type="text/javascript"
	src="/adminthemes/new/js/easy-ui/jquery.easyui.min.js"></script>
<script type="text/javascript"
	src="/adminthemes/new/js/easy-ui/easyui-lang-zh_CN.js"></script>
<script type="text/javascript"
	src="/adminthemes/new/js/jquery.blockUI.js"></script>
<script type="text/javascript"
	src="/adminthemes/new/js/jquery.loading.js"></script>
<link href="/adminthemes/new/css/main.css" rel="stylesheet"
	type="text/css" />
<link href="/adminthemes/new/css/style.css" rel="stylesheet"
	type="text/css" />
<script type="text/javascript" src="/adminthemes/js/BooCu.js"></script>
<script type="text/javascript"
	src="/adminthemes/new/js/ajaxupload.3.9.js"></script>
<script type="text/javascript" src="/frontthemes/js/easyuiUtil.js"></script>
<script type="text/javascript" src="/editor/ckeditor362/ckeditor.js"></script>


[#include '/template/admin/include/common.html']

</head>
<body>

	<div id="bookinfo" style="display: none;"></div>
	<div id="loading"></div>
	<div class="main">
		<div title="筛选条件" data-options="selected:true"></div>
		<div class="easyui-tabs">
			<div title="收件箱列表" style="padding: 10px;">
				<form id="memberform1">
					<div id="tb" style="height: auto">
						<span style="float: left;"> <span id="simpleSearch">
								<input id="searchKeyword1" class="input_text" type="text"
								value="" size="30" style="width: 300px;"
								placeholder="请输入标题关键字查询" name="keyword"> <a
								href="javascript:void(0)" class="easyui-linkbutton"
								data-options="plain:true" onclick="searchAdvertBase()">搜索</a>
						</span>
						</span>
					</div>
					<div class="clear height10"></div>
					<div class="shadowBoxWhite tableDiv">
						<table class="easyui-datagrid"
							data-options="url:'/admin/member/memberMessage/getMessageData.jspx',pageList: [5,10,15,20],pageSize:10"
							pagination="true" id="memberdata1" sortName="createDate"
							sortOrder="desc">
							<thead>
								<tr>
									<th data-options="field:'createDate'">发送时间</th>
									<th data-options="field:'title'">标题</th>
									<th data-options="field:'state'">已读?</th>
									<th data-options="field:'sendName'">发件人</th>
									<th data-options="field:'context',width:400,sortable:'true'">内容</th>
									<th
										data-options="field:'action',width:$(this).width()*0.1,align:'center'"
										formatter="formatOperation0">操作</th>
								</tr>
							</thead>
						</table>
					</div>
				</form>
			</div>
			<div title="发件箱列表" style="padding: 10px;">
				<form id="memberform0">
					<div id="tb" style="height: auto">
						<span style="float: left;"> <span id="simpleSearch">
								<input id="searchKeyword1" class="input_text" type="text"
								value="" size="30" style="width: 300px;"
								placeholder="请输入标题关键字查询" name="keyword1"> <a
								href="javascript:void(0)" class="easyui-linkbutton"
								data-options="plain:true" onclick="searchAdvertBase1()">搜索</a>
						</span>
						</span>
					</div>
					<div class="clear height10"></div>
					<div class="shadowBoxWhite tableDiv">
						<table class="easyui-datagrid"
							data-options="url:'/admin/member/memberMessage/getSendMessageData.jspx',pageList: [5,10,15,20],pageSize:10"
							pagination="true" id="memberdata0" sortName="createDate"
							sortOrder="desc">
							<thead>
								<tr>
									<th data-options="field:'recName'">收件人</th>
									<th data-options="field:'createDate'">发送时间</th>
									<th data-options="field:'title'">标题</th>
									<th data-options="field:'state'">已读?</th>
									<th data-options="field:'context',width:400,sortable:'true'">内容</th>
									<th
										data-options="field:'action',width:$(this).width()*0.1,align:'center'"
										formatter="formatOperation1">操作</th>
								</tr>
							</thead>
						</table>
					</div>
				</form>
			</div>
			<div title="群发短信" style="padding: 10px;">
				<form id="memberform2" class="validate">
					<div class="clear height10"></div>
					<div class="shadowBoxWhite tableDiv">
						<table>
							<tr>
								<td>标题：</td>
								<td><input class="input_text easyui-validatebox"
									name="title"></td>
							</tr>
							<tr>
								<td>接收用户组：</td>
								<td><input class="easyui-combobox"
									data-options="url:'/admin/member/memberMessage/getMemberGradeData.jspx',valueField:'id',textField:'text', width:307"
									name="grade" style="height: 30px;"></td>
							</tr>
							<tr>
								<td>内容：</td>
								<td><textarea rows="15" style="width: 300px;"
										name="context"></textarea></td>
							</tr>
							<tr align="center">
								<td colspan="2"><a href="javascript:void(0)"
									class="easyui-linkbutton" data-options="plain:true"
									onclick="submitGrade()">提交</a></td>
							</tr>
						</table>
					</div>
				</form>
			</div>
			<div title="私发短信" style="padding: 10px;">
				<form id="memberform3" class="validate">
					<div class="clear height10"></div>
					<div class="shadowBoxWhite tableDiv">
						<table>
							<tr>
								<td>发送到：</td>
								<td><input class="easyui-combobox "
									data-options="url:'/admin/member/memberMessage/getMemberData.jspx',valueField:'id',textField:'text', width:307"
									name="member" style="height: 30px;"></td>
							</tr>
							<tr>
								<td>标题：</td>
								<td><input class="input_text easyui-validatebox"
									name="title"></td>
							</tr>
							<tr>
								<td>内容：</td>
								<td><textarea rows="15" style="width: 300px;"
										name="context"></textarea></td>
							</tr>
							<tr align="center">
								<td colspan="2"><a href="javascript:void(0)"
									class="easyui-linkbutton" data-options="plain:true"
									onclick="submitMember()">提交</a></td>
							</tr>
						</table>
					</div>
				</form>
			</div>

		</div>
		<div id="divdia" style="display: none;"></div>

	</div>
	<script type="text/javascript">
	$(function(){
		
	})
		function submitGrade ()
        {
	        var formflag = $ ("#memberform2").form ().form ('validate');
	        if (formflag)
	        {
		        var title = $ ("#memberform2").find ("[name=title]").val ();
		        var context = $ ("#memberform2").find ("[name=context]").val ();
		        var grade = $ ("[name=grade]").val ();
		        if (grade == "")
		        {
			        alert ("请选择群发用户组");
			        return;
		        }
		        if (title == "")
		        {
			        alert ("请输入消息标题");
			        return;
		        }
		        if (context == "")
		        {
			        alert ("请输入消息内容");
			        return;
		        }
		        $.Loading.show ("正在发送....");
		        $.ajax (
		        {
		            url : "/admin/member/memberMessage/sendGrade.jspx",
		            type : "POST",
		            data :
		            {
		                "grade" : grade,
		                "title" : title,
		                "context" : context
		            },
		            success : function (result)
		            {
			            if (result.result == 1)
			            {
				            $.Loading.show (result.message);
				            $ ("#memberdata2").datagrid ('reload');
			            }
			            if (result.result == 0)
			            {
				            $.Loading.error (result.message);
			            }
			            $.Loading.hide ();
		            },
		            error : function (e)
		            {
			            alert ("出现错误 ，请重试");
		            }
		        });
	        }
        }
        function submitMember ()
        {
	        var formflag = $ ("#memberform3").form ().form ('validate');
	        if (formflag)
	        {
		        var title = $ ("#memberform3").find ("[name=title]").val ();
		        var context = $ ("#memberform3").find ("[name=context]").val ();
		        var member = $ ("[name=member]").val ();
		        if (member == "")
		        {
			        alert ("请选择私信用户");
			        return;
		        }
		        if (title == "")
		        {
			        alert ("请输入消息标题");
			        return;
		        }
		        if (context == "")
		        {
			        alert ("请输入消息内容");
			        return;
		        }
		        $.Loading.show ("正在发送....");
		        $.ajax (
		        {
		            url : "/admin/member/memberMessage/sendMember.jspx",
		            type : "POST",
		            data :
		            {
		                "member" : member,
		                "title" : title,
		                "context" : context
		            },
		            success : function (result)
		            {
			            if (result.result == 1)
			            {
				            $.Loading.show (result.message);
				            $ ("#memberdata3").datagrid ('reload');
			            }
			            if (result.result == 0)
			            {
				            $.Loading.error (result.message);
			            }
			            $.Loading.hide ();
		            },
		            error : function (e)
		            {
			            alert ("出现错误 ，请重试");
		            }
		        });
	        }
        }
        function submitForm (map)
        {
	        var formflag = $ (map["formId"]).form ().form ('validate');
	        if (formflag)
	        {
		        $.Loading.show (map["loadshow"]);
		        var options =
		        {
		            url : map["url"],
		            type : "POST",
		            dataType : 'json',
		            success : function (result)
		            {
			            if (result.result == 1)
			            {
				            $.Loading.show (result.message);
				            $ (map["divDialog"]).dialog ('close');
				            $ (map["gridreload"]).datagrid ('reload');
			            }
			            if (result.result == 0)
			            {
				            $.Loading.error (result.message);
			            }
			            $.Loading.hide ();
		            },
		            error : function (e)
		            {
			            alert ("出现错误 ，请重试");
		            }
		        };
		        $ (map["formId"]).ajaxSubmit (options);
	        }
        }

        //查看
        function submitForm1 (map)
        {
		        $.Loading.show (map["loadshow"]);
		        var options =
		        {
		            url : map["url"],
		            type : "POST",
		            success : function (result)
		            {
	 		            
				            $ (map["divDialog"]).dialog ('close');
				            $ (map["gridreload"]).datagrid ('reload');
				            $ (map["memberdata0"]).datagrid ('reload');
			            $.Loading.hide ();
		            },
		            error : function (e)
		            {
			            alert ("出现错误 ，请重试");
		            }
		        };
		        $ (map["formId"]).ajaxSubmit (options);
        }
        
        function append4 (id)
        {
        	 if (!confirm('确认要删除这条记录吗?'))
 	        {
 		        return;
 	        }
 	        $.Loading.show ("正在删除数据!");
 	        $.ajax (
 	        {
 	            url : '/admin/member/memberMessage/delSendMess.jspx?id=' + id,
 	            type : 'POST',
 	            success : function (result)
 	            {
 		            if (result.result == 1)
 		            {
 			            $.Loading.show (result.message);
 		            }
 		            if (result.result == 0)
 		            {
 			            $.Loading.error (result.message);
 		            }
 		            $.Loading.hide ();
 		           $ ("#memberdata0").datagrid ('reload');
 	            },
 	            error : function ()
 	            {
 		            alert ('出现错误!');
 	            }
 	        });
        }
        function append1 (id)
        {
	        var map = {}; // Map map = new HashMap();
	        if (id != null)
	        {
		        map["href"] = "/admin/member/memberMessage/findView.jspx?id=" + id;
		        map["formId"] = "#editForm";
		        map["title"] = "  查看短消息";
		        map["loadshow"] = "正在刷新数据......";
		        map["url"] = "/admin/member/memberMessage/toMemberMessageList.jspx";
		        map["text"] = "返回";
	        }
	        map["divDialog"] = "#divdia";
	        map["gridreload"] = "#memberdata1";
	        addDialog (map);
        }
        function append5 (id)
        {
	        var map = {}; // Map map = new HashMap();
	        if (id != null)
	        {
		        map["href"] = "/admin/member/memberMessage/findSendView.jspx?id=" + id;
		        map["formId"] = "#editForm";
		        map["title"] = "  查看短消息";
		        map["loadshow"] = "正在刷新数据......";
		        map["url"] = "/admin/member/memberMessage/toMemberMessageList.jspx";
		        map["text"] = "返回";
	        }
	        map["divDialog"] = "#divdia";
	        map["gridreload"] = "#memberdata0";
	        addDialog (map);
        }

        function append2 (id)
        {
	        var map = {}; // Map map = new HashMap();
	        if (id != null)
	        {
		        map["href"] = "/admin/member/memberMessage/replyMessage.jspx?id=" + id;
		        map["formId"] = "#editForm";
		        map["title"] = "  回复短消息";
		        map["loadshow"] = "正在加载数据......"; 
		        map["url"] = "/admin/member/memberMessage/doReplyMessage.jspx";
		        map["text"] = "提交回复";
	        }
	        map["divDialog"] = "#divdia";
	        map["gridreload"] = "#memberdata1";
	        addDialog (map);
        }
        function append3 (id)
        {
	        if (!confirm ('确认要删除这条记录吗?'))
	        {
		        return;
	        }
	        $.Loading.show ("正在删除数据!");
	        $.ajax (
	        {
	            url : '/admin/member/memberMessage/delMess.jspx?id=' + id,
	            type : 'POST',
	            success : function (result)
	            {
		            if (result.result == 1)
		            {
			            $.Loading.show (result.message);
		            }
		            if (result.result == 0)
		            {
			            $.Loading.error (result.message);
		            }
		            $.Loading.hide ();
		            $ ("#memberdata1").datagrid ('reload');
	            },
	            error : function ()
	            {
		            alert ('出现错误!');
	            }
	        });
        }
        function addDialog1 (map)
        {
	        $ (map["divDialog"]).show ();
	        $ (map["divDialog"]).dialog (
	        {
	            title : map["title"],
	            width : 500,
	            height : 500,
	            closed : false,
	            cache : false,
	            href : map["href"],
	            modal : true,buttons : [ {
					text : map['text'],
					iconCls : 'icon-ok',
					handler : function() {
						var savebtn = $(this);
		　　				var disabled=savebtn.hasClass("l-btn-disabled");
		　　				if(!disabled){
							 submitForm(map,savebtn);
						}
					}
				} ]
	        });
	        
        }function addDialog (map)
        {
	        $ (map["divDialog"]).show ();
	        $ (map["divDialog"]).dialog (
	        {
	            title : map["title"],
	            width : 500,
	            height : 500,
	            closed : false,
	            cache : false,
	            href : map["href"],
	            modal : true,buttons : [ {
					text : map['text'],
					iconCls : 'icon-ok',
					handler : function() {
						var savebtn = $(this);
		　　				var disabled=savebtn.hasClass("l-btn-disabled");
		　　				if(!disabled){
		　　					submitForm1(map,savebtn);
						}
					}
				} ]
	        });
        }

        //收件箱操作
        function formatOperation0 (value, row, index)
        {
		     var val = "<a class='edit' title='查看' href='javascript:void(0);' onclick='append1(" + row.id + ")' ></a><a class='issue' title='回复' href='javascript:void(0);' onclick='append2(" + row.id
		                + ")' ></a><a class='delete' title='删除' href='javascript:void(0);' onclick='append3(" + row.id
		                + ")' ></a>";
	        return val;
        }
        //发件箱操作
        function formatOperation1 (value, row, index)
        {
        	//alert(appr);
        	$('[name=appr]').val();
	        var val = "<a class='edit' title='查看' href='javascript:void(0);' onclick='append5(" + row.id + ")' ></a>";
	        if (row.state == '未读')
	        {
		        val = "<a class='delete' title='删除' href='javascript:void(0);' onclick='append4(" + row.id + ")' ></a>";
	        }
	        return val;
        }
     
        //搜索
        function searchAdvertBase ()
        {
	        var username = $("[name=username]").val ();
	        var keyword = $ ("[name=keyword]").val ();
	        var appr = $ ("[name=appr]").val ();
	        $ ("#memberdata1").datagrid ("load",
	        {
	            username : username,
	            keyword : keyword,
	            page : 1,
	            appr : appr
	        });
        }
	</script>
</body>
</html>