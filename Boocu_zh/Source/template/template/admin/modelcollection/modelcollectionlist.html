
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
		"http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=9">
	</meta>
	<title>晧辰仪联网-后台管理</title>
	<style type="text/css">
		body {
			margin: 0px;
			font-family: Arial, "宋体", Verdana, sans-serif;
			font-size: 12px;
		}

		html, body {
			padding: 0;
			margin: 0;
			overflow-x: hidden;
			overflow-y: auto;
		}

		dl, dd {
			margin: 0px
		}

		ul {
			list-style-type: none;
			margin: 0px;
			padding: 0px;
		}

		.input_text2{
			border: 1px solid #D7D7D7;
			border-radius: 3PX;
			/*height: 14PX;*/
			padding: 7px 0 7px 5px;
			line-height: 14PX;
			font-size: 12px;
			display: inline-block;
			width:150px;
		}

		.input_text2:focus {
			border: 1px solid #06F;
			box-shadow: inset 0 1px 2px rgba(0, 102, 255, 0.3);
		}

	</style>
	<script type="text/javascript" src="/editor/ckeditor362/ckeditor.js"></script>
	<script type="text/javascript"
			src="/adminthemes/new/js/jquery-1.8.3.min.js"></script>
	<script type="text/javascript"
			src="/adminthemes/new/js/jquery-form-2.33.js"></script>
	<script type="text/javascript" src="/statics/js/area_sql.js"></script>
	<link rel="stylesheet" type="text/css"
		  href="/adminthemes/new/js/easy-ui/themes/gray/easyui.css" />
	<link rel="stylesheet" type="text/css"
		  href="/adminthemes/new/js/easy-ui/themes/icon.css" />
	<script type="text/javascript"
			src="/adminthemes/new/js/easy-ui/jquery.easyui.min.js"></script>
	<script type="text/javascript"
			src="/adminthemes/new/js/easy-ui/easyui-lang-zh_CN.js"></script>
	<script type="text/javascript"
			src="/adminthemes/new/js/jquery.blockUI.js"></script>
	<script type="text/javascript"
			src="/adminthemes/new/js/jquery.loading.js"></script>
	<link href="/adminthemes/new/css/main.css" rel="stylesheet"
		  type="text/css" />
	<link href="/adminthemes/new/css/style.css" rel="stylesheet"
		  type="text/css" />
	<script type="text/javascript" src="/adminthemes/js/BooCu.js"></script>
	<script type="text/javascript"
			src="/adminthemes/new/js/ajaxupload.3.9.js"></script>
	<script type="text/javascript" src="/frontthemes/js/easyuiUtil.js"></script>



	[#include '/template/admin/include/common.html']

</head>
<body>

<div id="bookinfo" style="display: none;"></div>
<div id="loading"></div>
<div class="main">
	<!--<form name="Form2" action="/admin/ModelCollection/doImport.jspx" method="post"  enctype="multipart/form-data">
        <input type="file" name="file">
        <input type="submit" value="批量导入客户"/>
    </form>-->
	<form id="memberform">
		<div id="tb" style="height: auto">
			<a href="javascript:append()" class="button blueButton" id="hre1"
			   data-options="iconCls:'icon-add',plain:true" onclick="ja(0)">添加</a>
			<!--				<a href="javascript:void(0)" class="easyui-linkbutton" id="hre2"
                                data-options="plain:true" onclick="del()">删除</a>-->
			<a href="javascript:void(0)" class="easyui-linkbutton" id="hre3"
			   data-options="plain:true" onclick="allocate_customer()">批量分配责任人</a>
			<!-- <a href="javascript:void(0)" class="easyui-linkbutton" id="hre3"
                data-options="plain:true" onclick="orderExport()">导出</a> -->
		</div>
		<span style="float: left;">
				<!-- <span >
				行业分类：
				<input style="width: 240px; height: 30px;"
										class="input_text easyui-combotree"
										url="/admin/mcIndustyClass/combotreeData.json" name="mc_industry_class_show" data-options="multiple:true"
										id="mc_industry_class_show" />
				</span>&nbsp;&nbsp;&nbsp;&nbsp;
				<span >
				主营产品：
				<input style="width: 240px; height: 30px;"
										class="input_text easyui-combotree"
										url="/admin/mcMajor/combotreeData.json" name="major_product_show" data-options="multiple:true"
										id="major_product_show" />
				</span>&nbsp;&nbsp;&nbsp;&nbsp;
				<span >
				常用仪器及品牌型号：
				<input style="width: 240px; height: 30px;"
										class="input_text easyui-combotree"
										url="/admin/basedata/mcproductclass/combotreeData.json" name="mc_productclass_show"
										id="mc_productclass_show" data-options="multiple:true"/>
				</span> -->
				<span >
				<span >
				公司名：
				<input style="width: 140px; height: 30px;"
					   class="input_text easyui-combobox"
					   url="/admin/mcCompanyName/get_mcmember_names.jspx" name="searchKeyword"
					   id="searchKeyword" data-options="multiple:false,cascadeCheck:false,valueField:'text',textField:'text',editable:true"/>
				</span>



				<span >
				行业分类：
					<!-- <input style="width: 200px; height: 30px;"
                                            class="easyui-combobox"
                                            url="/admin/mcIndustyClass/combotreeData.json" name="mc_industry_class_all" data-options="valueField:'id',multiple:true,textField:'text',editable:true"
                                            id="mc_industry_class_all"/> -->
				 <input style="width: 110px; height: 16px;"
						class="input_text easyui-validatebox"
						name="mc_industry_class_all" data-options="editable:true"
						id="mc_industry_class_all"/>
				</span>
				<span >
				主营产品名称：
					<!-- <input style="width: 200px; height: 30px;"
                                            class="easyui-combobox"
                                            url="/admin/mcMajor/get_major_names.jspx" name="major_product_all" data-options="multiple:true,valueField:'id',textField:'text',editable:false"
                                            id="major_product_all"/> -->
					<!--<input style="width: 100px; height: 16px;"
                           class="input_text easyui-validatebox"
                            name="major_product_all" data-options="editable:true"
                           id="major_product_all" /> -->
					<input style="width: 110px; height: 30px;"
						   class="easyui-combobox"
						   url="/admin/industyClass/combotreeData.json?getSanji=true" name="major_product_all" data-options="multiple:false,valueField:'id',textField:'text',editable:true"
						   id="major_product_all"/>
				</span>
				<span >
					仪器名称：
					<input style="width: 100px; height: 30px;"
                                           class="easyui-combobox"
                                           url="/admin/basedata/productclass/combotreeData.json?getSanji=true" name="mc_productclass_all" data-options="multiple:false,valueField:'id',textField:'text',editable:true"
                                           id="mc_productclass_all"/>

				</span>
				<span >
					仪器品牌：
					<input style="width: 70px; height: 32px;"
						   class="input_text easyui-combobox" url="/admin/basedata/brand/get_brand_names.jspx"
						   name="mc_brand_all" data-options="multiple:false,cascadeCheck:false,valueField:'id',textField:'text',editable:true"
						   id="mc_brand_all"/>
				</span>
				<span >
					仪器型号：
							 <input style="width: 80px; height: 16px;"
									class="input_text easyui-validatebox"
									name="mc_model_all" data-options="editable:true"
									id="mc_model_all"/>
				</span>
				<span>
				联系人：
					<!--<input style="width: 80px; height: 16px;" class="input_text easyui-validatebox" name="search_contact" data-options="editable:true" id="search_contact"/>-->
					<input style="width: 90px; height: 30px;"
						   class="easyui-combobox"
						   url="/admin/mcContacts/get_mcmember_names.jspx" name="search_contact" data-options="valueField:'id',textField:'text',editable:true"
						   id="search_contact"/>
				</span>
				<span >
				责任人：
				<input style="width: 90px; height: 30px;"
					   class="easyui-combobox"
					   url="/admin/mcMember/get_mcmember_names.jspx" name="mode_blame" data-options="valueField:'id',textField:'text',editable:true"
					   id="mode_blame"/>
				</span>
				<span >
				介绍人：
					 <input style="width: 70px; height: 16px;"
							class="input_text easyui-validatebox" name="search_introducer" data-options="editable:true" id="search_introducer"/>
				</span>

				<span >
				等级：
										<select id="grade_all" name="grade_all" class="input_text"  style="width: 70px; height: 32px;">
											<option value="">全部</option>
											<option value="1">一级</option>
											<option value="2">二级</option>
											<option value="3">三级</option>
											<option value="4">四级</option>
											<option value="5">五级</option>
											<option value="6">六级</option>
											<option value="7">七级</option>
											<option value="8">八级</option>
											<option value="9">九级</option>
										</select>
				</span>
				<span >
				计量时间：
										<select id="measurement_time_all" name="measurement_time_all" class="input_text"  style="width: 70px; height: 32px;">
											<option value='' selected="selected">全部
											<option value='1'>一月</option>
											<option value='2'>二月</option>
											<option value='3'>三月</option>
											<option value='4'>四月</option>
											<option value='5'>五月</option>
											<option value='6'>六月</option>
											<option value='7'>七月</option>
											<option value='8'>八月</option>
											<option value='9'>九月</option>
											<option value='10'>十月</option>
											<option value='11'>十一月</option>
											<option value='12'>十二月</option>
										</select>
				</span>
				<span >
				创建时间：
										<select id="create_date_all" name="create_date_all" class="input_text"  style="width: 90px; height: 32px;">
											<option value='all' selected="selected">全部
											<option value='3'>三天内
											<option value='7'>本周内
											<option value='30'>本月内
										</select>
				</span>
				&nbsp;&nbsp;&nbsp;&nbsp;
				<span id="simpleSearch">
					<!-- <input id="searchKeyword" class="input_text" type="text" value="" size="30" style="width: 300px;"
					placeholder="请输入公司名称" name="searchKeyWord">  -->
					<a href="javascript:void(0)" class="easyui-linkbutton"
					   data-options="plain:true" onclick="searchIndustryClass();">搜索</a>
				</span>
			</span>

			<div class="clear height10"></div>
			<div class="shadowBoxWhite tableDiv">
				<table class="easyui-datagrid" id="dataList"
					   data-options="url:'/admin/ModelCollection/getGroupData.jspx?type=company',pageList: [5,10,15,20],pageSize:10,fitColumns:'true',rownumbers:'true'" nowrap="false"
					   pagination="true" sortName="modify_date" sortOrder="desc" idField="id" treeField="name" checkbox="true">
					<thead>
						<tr>
							<th data-options="field:'id',checkbox:true"></th>
							<th data-options="field:'mc_industry_class',hidden:true"></th>
							<th data-options="field:'mc_industry_class_name',width:$(this).width()*0.15,sortable:'true' ,align: 'center'">行业分类</th>
							<th data-options="field:'name_id',hidden:true" formatter="formatup"></th>
							<th data-options="field:'name',width:$(this).width()*0.15,sortable:'true' ,align: 'center'" formatter="companyOperation">公司名称</th>
							<th data-options="field:'major_product',hidden:true" formatter="formatup"></th>
							<th data-options="field:'major_product_name',width:$(this).width()*0.18,sortable:'true',align: 'center'" formatter="formatup">主营产品名称</th>
							<th data-options="field:'mc_brand_and_models',hidden:true" formatter="formatup"></th>
							<th data-options="field:'mc_model',width:$(this).width()*0.22,sortable:'true',align: 'center'" formatter="mc_brand_modelOperation">仪器品牌型号</th>
							<th data-options="field:'mcproductclass',hidden:true" formatter="formatup"></th>
							<th data-options="field:'mcproductclass_name',width:$(this).width()*0.18,sortable:'true',align: 'center'" formatter="formatup">仪器名称</th>
							<!--<th data-options="field:'mcproductclass_name',width:$(this).width()*0.18,sortable:'true',align: 'center'" formatter="formatup">仪器名称</th>-->
							<th data-options="field:'subscribe_content',width:$(this).width()*0.15,sortable:'true',align: 'center'" formatter="formnull">订阅内容</th>
							<!--<th data-options="field:'mc_model',hidden:true" formatter="formatup"></th>
							<th data-options="field:'mc_model_name',width:$(this).width()*0.3,sortable:'true',align: 'center'" formatter="formatup">原来的常用仪器型号</th>-->
							<th data-options="field:'contact',hidden:true" formatter="formatup"></th>
							<th data-options="field:'contact_name',width:$(this).width()*0.11,sortable:'true',align: 'center'" formatter="contactOperation">联系人</th>
							<th data-options="field:'blame',hidden:true" formatter="formatup"></th>
							<th data-options="field:'blame_name',width:$(this).width()*0.15,sortable:'true',align: 'center'" formatter="">责任人</th>
							<th data-options="field:'grade',width:$(this).width()*0.07,sortable:'true',align: 'center'" formatter="formatupgrade">等级</th>
							<th data-options="field:'measurement_time',width:$(this).width()*0.15,sortable:'true',align: 'center'" formatter="formatupmeasurement_time">计量时间</th>
							<th data-options="field:'ckZt',width:$(this).width()*0.15,sortable:'true',align: 'center'" formatter="formatupckzt">订阅邮件</th>
							<th data-options="field:'rate',width:$(this).width()*0.15,sortable:'true',align: 'center'" formatter="formatuprate">订阅周期</th>
							<th data-options="field:'introducer',width:$(this).width()*0.15,sortable:'true',align: 'center'" formatter="">介绍人</th>
							<th data-options="field:'mc_website',width:$(this).width()*0.18,sortable:'true',align: 'center'" formatter="formatup">公司网站</th>
							<th data-options="field:'remark',width:$(this).width()*0.15,sortable:'true',align: 'center'" formatter="">备注</th>
							<th data-options="field:'modify_date',width:$(this).width()*0.15,sortable:'true',align: 'center'" formatter="formdate">更新时间</th>
							<th id="th1"
								data-options="field:'action',width:$(this).width()*0.16,align:'center'"
								formatter="formatOperation">操作</th>
						</tr>
					</thead>
				</table>
			</div>
	</form>
	<div id="divdia" style="display: none;"></div>
	<div id="divdia2" style="display: none;"></div>
	<div id="divdia3" style="display: none;"></div><!-- 这个暂时没用到 -->

</div>
<script type="text/javascript">
    if("${showhandle}"){//非管理员用户，隐藏增删改按钮
        //$("#hre1").hide();
        $("#hre2").hide();
        $("#hre3").hide();
        //$('#th1').attr('hidden','hidden');
    }

    //下拉树实现自定义查询效果
    $('#searchKeyword').combobox({
        filter: function(q, row){
            var opts = $(this).combobox('options');
            return row[opts.textField].indexOf(q) >= 0;//这里改成>=即可在任意地方匹配
        }
    });
    //下拉树实现自定义查询效果
    $('#mode_blame').combobox({
        filter: function(q, row){
            var opts = $(this).combobox('options');
            return row[opts.textField].indexOf(q) >= 0;//这里改成>=即可在任意地方匹配
        }
    });
    //下拉树实现自定义查询效果
    $('#mode_blame').combobox({
        filter: function(q, row){
            var opts = $(this).combobox('options');
            return row[opts.textField].indexOf(q) >= 0;//这里改成>=即可在任意地方匹配
        }
    });



    function submitForm(map) {
        var data = {};
        data.id=$("#id").val();
        data.website=$("#mc_website_coll").val();//公司网站
        //data.mc_industry_class=$("#mc_industry_class_coll").combobox('getValues').toString();
        data.mc_industry_class=$("#mc_industry_class_coll").val();

        data.major_product=$("#major_product_coll").combotree('getValues').toString();//getValues获取组件的值的数组,再转成字符串保存
        // data.major_product=$("#major_product_coll").val();
        //data.major_product=$ ("#major_product_coll").combotree ('getText');

        data.grade=$("#grade").val();
        data.measurement_time=$("#measurement_time").val();
        data.ckZt=$("#ckZt").val();
        data.rate=$("#rate").val();
        data.subscribeContent=$("#subscribe_content").val();
        var contact2=$("#contact").combobox('getValues');
        data.contact=contact2.toString();

        //data.mc_productclass=$("#mc_productclass_coll").combobox('getValues').toString();
        data.mc_productclass=$("#mc_productclass_coll").val();

        data.mc_brand6=[];
        $.each($("#addForm table input[name='brand']"),function (i,e) {
            data.mc_brand6.push(e.value)
        })
        data.mc_model6=[];
        $.each($("#addForm table input[name='model']"),function (i,e) {
            data.mc_model6.push(e.value)
        })
        data.mc_productclass_number6=[];
        $.each($("#addForm table input[name='number']"),function (i,e) {
            data.mc_productclass_number6.push(e.value)
        })
        data.mc_productclass_name6=[];
        $.each($("#addForm table input[name='mc_productclass_name']"),function (i,e) {
            data.mc_productclass_name6.push(e.value)
        })
        var blame2=$("#blame").combobox('getValues');
        data.blame=blame2.toString();
        //介绍人
        var mc_introducer2=$("#mc_introducer_coll").val();
        data.introducer=mc_introducer2.toString(); //介绍人的字段introducer 需要和持久化类的属性名对应

        //备注
        var mc_remark2=$("#mc_remark_coll").val();
        data.remark=mc_remark2.toString();

        data.name=$("#name").combobox('getValue').toString();
        var formflag = $(map["formId"]).form().form('validate');
        console.log(data);

//        if(check()){
//            result
//        }
        if (formflag && condition_company) {
            $.Loading.show(map["loadshow"]);
            var options = {
                url : map["url"],
                type : "POST",
                dataType : 'json',
                data:data,
                success : function(result) {
                    if (result.result == 1) {
                        $.Loading.show(result.message);
                        $(map["divDialog"]).dialog('close');
                        $(map["gridreload"]).datagrid('reload');
                    }
                    if (result.result == 0) {
                        $.Loading.error(result.message);
                    }
                    $.Loading.hide();
                },
                error : function(e) {
                    alert("出现错误 ，请重试");
                }
            };
            $.ajax(options);
        }
    }


    function append(id) {
        var map = {}; // Map map = new HashMap();
        if (!id) {
            map["href"] = "/admin/ModelCollection/add_modelcollection.jspx";
            map["formId"] = "#addForm";
            map["url"] = "/admin/ModelCollection/doAdd_memberGrade.jspx?ajax=yes";
            map["title"] = "添加信息";
            map["loadshow"] = "正在添加......";
        } else {
            map["href"] = "/admin/ModelCollection/edit_memberGrade.jspx?id=" + id;
            map["formId"] = "#editForm";
            map["url"] = "/admin/ModelCollection/doEdit_memberGrade.jspx?ajax=yes";
            map["title"] = "修改信息";
            map["loadshow"] = "正修改......";
        }
        map["divDialog"] = "#divdia";
        map["gridreload"] = "#dataList";
        addDialog(map);
    }

    function addDialog(map) {
        $(map["divDialog"]).show();
        $(map["divDialog"]).dialog({
            title : map["title"],
            width : 900,
            height : 740,
            closed : false,
            cache : false,
            href : map["href"],
            modal : true,
            buttons : [ {
                text : '保存',
                iconCls : 'icon-ok',
                handler : function() {
                    if (checkaddForm()) {
                        return
                    }
                    for(instance in CKEDITOR.instances){
                        CKEDITOR.instances[instance].updateElement();
                    }
                    var savebtn = $(this);
                    var disabled=savebtn.hasClass("l-btn-disabled");
                    if(!disabled){
                        submitForm(map,savebtn);
                    }
                }
            }, {
                text : '清空',
                handler : function() {
                    clearForm(map);
                }
            } ]
        });
    }

    function clearForm(map) {
        $(map["formId"]).form('clear');
    }

    function formatOperation(value, row, index) {
        var val = "<a class='edit' title='修改' href='javascript:void(0);' onclick='append("+row.id+")' ></a>";
        return val;
    }
    function formatup(value, row, index) {
        if(value==undefined){
            return "";
        }
        var va=value+"";
        return va.replace(/^,+/,"").replace(/,+$/,"");
    }
    //查看常用仪器品牌型号的详细信息
    function mc_brand_modelOperation(value, row, index) {//row是easyUI里面的一个属性，指代所选择的行
        var str='';
        if (row.mc_brand_and_models!=undefined) {//这里需要判断一下，不然客户信息无法显示出来
            $.each( row.mc_brand_and_models, function(i, n){//将有多个联系人的数据，用a标签拼接成多个，用逗号隔开
                var val = "<a class='details' title='查看' href='javascript:void(0);' onclick='newTab(\""
                    + row.mc_model[i]
                    + "-信息\",\"/admin/mcBrandAndModel/edit_memberGrade.jspx?brandAndModel_type=brandAndModelshow&id="
                    +n + "\")' >"+row.mc_brand_name[i]+' '+row.mc_model[i]+' '+row.mc_productclass_number[i]+"</a>";
                str=str+val+',';
            });
        }
        return str.replace(/^,+/,"").replace(/,+$/,"");//正则去掉末尾的逗号
    }
    //查看联系人的详细信息
    function contactOperation(value, row, index) {//row是easyUI里面的一个属性，指代行
        var str='';
        $.each( row.contact, function(i, n){//将有多个联系人的数据，用a标签拼接成多个，用逗号隔开
            var val = "<a class='details' title='查看' href='javascript:void(0);' onclick='newTab(\""
                + row.contact_name[i]
                + "-信息\",\"/admin/mcContacts/edit_memberGrade.jspx?contact_type=contactshow&id="
                +n + "\")' >"+row.contact_name[i]+"</a>";
            str=str+val+',';
        });
        return str.replace(/^,+/,"").replace(/,+$/,"");//正则去掉末尾的逗号
    }
    //查看公司的详细信息
    function companyOperation(value, row, index) {
        var str='';
        $.each( row.name_id, function(i, n){//将有多个联系人的数据，用a标签拼接成多个，用逗号隔开
            var val = "<a class='details' title='查看' href='javascript:void(0);' onclick='newTab(\""
                + row.name[i]
                + "-信息\",\"/admin/mcCompanyName/edit_memberGrade.jspx?company_type=companyshow&id="
                +n + "\")' >"+row.name[i]+"</a>";
            str=str+val+',';
        });
        return str.replace(/^,+/,"").replace(/,+$/,"");//正则去掉末尾的逗号

    }

    function formnull(value, row, index) {
        if(value == 'undefined'){
            return null;
        }
        return value;
    }
    function formdate(value, row, index) {
        if(value != null){
            return new Date(value).format("yyyy-MM-dd");
        }

    }
    function formatupgrade(value, row, index) {
        if(value == 1){
            return "一级";
        }
        if(value == 2){
            return "二级";
        }
        if(value == 3){
            return "三级";
        }
        if(value == 4){
            return "四级";
        }
        if(value == 5){
            return "五级";
        }
        if(value == 6){
            return "六级";
        }
        if(value == 7){
            return "七级";
        }
        if(value == 8){
            return "八级";
        }
        if(value == 9){
            return "九级";
        }

    }
    function formatupmeasurement_time(value, row, index) {
        if(value == 1){
            return "一月";
        }
        if(value == 2){
            return "二月";
        }
        if(value == 3){
            return "三月";
        }
        if(value == 4){
            return "四月";
        }
        if(value == 5){
            return "五月";
        }
        if(value == 6){
            return "六月";
        }
        if(value == 7){
            return "七月";
        }
        if(value == 8){
            return "八月";
        }
        if(value == 9){
            return "九月";
        }
        if(value == 10){
            return "十月";
        }
        if(value == 11){
            return "十一月";
        }
        if(value == 12){
            return "十二月";
        }

    }
    function formatupckzt(value, row, index) {
        if(value == 1){
            return "是";
        }
        if(value == 2){
            return "否";
        }

    }
    function formatuprate(value, row, index) {
        if(value == 1){
            return "当天";
        }
        if(value == 7){
            return "当周";
        }
        if(value == 30){
            return "当月";
        }
    }
    function showTemplate(value, row, index) {
        return "<a class='details' title='查看' href='javascript:void(0);' onclick='newTab(\""
            + row.templatename
            + "-模版内容\",\"/admin/userGroupMng/getTemplateContext.jspx?template="
            + row.templateId + "\")' >"+row.templatename+"</a>";
    }

    function del() {
        var rows = $('#dataList').datagrid("getSelections");
        if (rows.length < 1) {
            $.Loading.error("请选择要删除的帮助信息");
            return;
        }
        if (!confirm("确认删除选中的信息？")) {
            return;
        }
        var gradeId=[];
        for(var i=0;i<rows.length;i++){
            gradeId[i]=rows[i].id;
        }
        var options = {
            url : "/admin/ModelCollection/del_memberGrade.jspx?ajax=yes&&gradeId="+gradeId,
            type : "POST",
            success : function(result) {

                if (result.result == 1) {
                    $.Loading.success(result.message);
                    $('#dataList').datagrid('reload');
                    $('#dataList').datagrid('reload');
                }else{
                    $.Loading.error(result.message);
                }
            },
            error : function(e) {
                $.Loading.error("出现错误 ，请重试");
            }
        };
        $('#dataList').ajaxSubmit(options);
    }
    function allocate_customer() {//分配客户
        var rows = $('#dataList').datagrid("getSelections");
        if (rows.length < 1) {
            $.Loading.error("请选择要分配的客户信息");
            return;
        }
        if (!confirm("确认分配选中的客户？")) {
            return;
        }
        var gradeId=[];
        for(var i=0;i<rows.length;i++){
            gradeId[i]=rows[i].id;
        }
        var options = {
            url : "/admin/ModelCollection/allocate_customer.jspx?ajax=yes&&gradeId="+gradeId+"&&mode_blame="+$("#mode_blame").combobox('getValue'),
            type : "POST",
            success : function(result) {

                if (result.result == 1) {
                    $.Loading.success(result.message);
                    $('#dataList').datagrid('reload');
                    $('#dataList').datagrid('reload');
                }else{
                    $.Loading.error(result.message);
                }
            },
            error : function(e) {
                $.Loading.error("出现错误 ，请重试");
            }
        };
        $('#dataList').ajaxSubmit(options);
    }

    function clearFormcontact(map) {
        $(map["formId"]).form('clear');
    }

    function searchIndustryClass(){
        var keyword = $("#searchKeyword").combobox('getValues');
        var mode_blame = $("#mode_blame").combobox('getValues');
        var search_contact = $("#search_contact").combobox('getValues'); //搜索联系人
        //var search_mc_brand = $("#search_mc_brand").val();//搜索常用仪器品牌和型号
        var search_introducer = $("#search_introducer").val(); //搜索介绍人
        var mc_industry_class = $("#mc_industry_class_all").val();
        // var major_product = $("#major_product_all").val();
        var major_product = $("#major_product_all").combobox('getValues');//搜索主营产品名称
        var mc_productclass = $("#mc_productclass_all").combobox('getValues');//搜索常用仪器名称
        var mc_brand = $("#mc_brand_all").combobox('getValues');//搜索常用仪器名称
        var mc_model = $("#mc_model_all").val();
        var create_date = $("#create_date_all").val();
        var grade_all = $("#grade_all").val();
        var measurement_time_all = $("#measurement_time_all").val();
        /* var mc_industry_class = $("#mc_industry_class_show").combotree('getValues');
        var major_product = $("#major_product_show").combotree('getValues');
        var mc_productclass = $("#mc_productclass_show").combotree('getValues'); */
        /* $("#dataList").datagrid("reload",{
            keyword:keyword,
            major_product:major_product.toString(),
            mc_industry_class:mc_industry_class.toString()
        }); */
        $("#dataList").datagrid('options').queryParams = {
            keyword:keyword.toString(),
            mode_blame:mode_blame.toString(),
            search_contact:search_contact.toString(),//搜索联系人
            //search_mc_brand:search_mc_brand.toString(),//搜索常用仪器品牌和型号
            search_introducer:search_introducer.toString(),//搜索介绍人
            mc_industry_class:mc_industry_class.toString(),
            major_product:major_product.toString(),//并且要转成字符串
            mc_productclass:mc_productclass.toString(),
			mc_brand:mc_brand.toString(),
			mc_model:mc_model.toString(),
            grade:grade_all,
            measurement_time:measurement_time_all,
            create_date:create_date/* ,
			major_product:major_product.toString(),
			mc_industry_class:mc_industry_class.toString(),
			mc_productclass:mc_productclass.toString() */
        };
        $("#dataList").datagrid('reload');
    }


    function orderExport(){
        var keyword = $("#searchKeyword").combobox('getValues');
        var mode_blame = $("#mode_blame").combobox('getValues');
        var search_introducer = $("#search_introducer").val();
        var mc_industry_class = $("#mc_industry_class_all").val();
        var major_product = $("#major_product_all").val();
        var mc_productclass = $("#mc_productclass_all").val();
        var create_date = $("#create_date_all").val();
        var grade_all = $("#grade_all").val();
        var measurement_time_all = $("#measurement_time_all").val();
        window.location.href = "/admin/ModelCollection/orderExport.jspx?keyword="+keyword+"&mode_blame="+mode_blame+
            "&mc_industry_class="+mc_industry_class+"&search_introducer="+search_introducer+"&major_product="+major_product+"&mc_productclass="+mc_productclass+"&create_date="+create_date+"&grade="+grade_all+"&measurement_time"+measurement_time_all;
    }
</script>
</body>
</html>