<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>忘记密码 - 晧辰仪联网</title>
[#include '/template/front/include/csslist.html' /]
<link rel="stylesheet" href="/statics/front/css/login.css">
</head>
<body>
<!--top-->
<div class="toplogind">
  <div class="main">
    <div class="logod"><a href="/"><img src="statics/front/images/logo.png"></a></div>
    <div class="titd">忘记密码</div>
  </div>
</div>
<!--./top--> 

<!--content-->
<div class="mainloginpd">
  <div class="mainlogind">
    <div class="main"> 
      <!--loginwd-->
      <div class="loginwd">
        <div class="loginnav">
          <ul>
            <li class="on" w><a href="javascript:;" class="ia">邮箱找回</a></li>
            <li><a href="javascript:;">默认手机找回</a></li>
            <!-- <li><a href="javascript:;">QQ快速登录</a></li>
            <li><a href="javascript:;">新浪微博登录</a></li> -->
          </ul>
        </div>
        <!--./loginnav-->
        
        <div class="logincontd loginformd">
          <form name="n_loginForm" id="n_loginForm" method="post" action="">
          	<div style="padding-bottom:40px;"></div> 
            <div class="row">
              <p style="padding-left:10px; ">请输入已验证的邮箱, 用于重设密码信息.</p>
            </div>
            <div class="row" style="padding-bottom:28px;">
              <p class="l">邮　箱：</p>
              <p class="r">
                <input type="email" name="email" id="email" class="txt">
              </p>
              <p class="annotate"></p>
            </div>
            <div class="row">
              <p class="l">&nbsp;</p>
              <p class="r"><input type="submit" value="确 定"  class="btn" id="normalBtn" /></p>
            </div>
            <div class="row">
              <p class="l">&nbsp;</p>
              <p class="r linkd"><a href="/login" class="wjmm">登录</a>
              <a href="/register.jhtml">注册新账号</a>
              <!-- <a href="/help/${help.id}.jhtml">联系我们</a></p> -->
            </div>
          </form>
        </div>
        <!--./logincontd-->
        
         <div class="logincontd loginformd" style="display:none;">
          <form name="loginForm" id="loginForm" method="post" action="">
            <div class="row">
              <p class="l">手机号：</p>
              <p class="r">
                <input type="text" name="phonenamefor" id="phonenamefor" class="txt">
              </p>
              <p class="annotate"></p>
            </div>
               <div class="row">
          <p class="l">验证码：</p>
          <div class="r">
            <p class="fl">
              <input type="text" name="text" id="yanzhengmafor" class="txt">
            </p>
            &nbsp;&nbsp;
            <p class="fl w1">
              <input type="button" class="sendText" name="sendText" id="sendTextfor" value="发送验证码">
            </p>
             <p class="rr"></p>
          </div>
        </div>
            <div class="row">
              <p class="l">&nbsp;</p>
              <p class="r"><a href="#" class="btn" onclick="phonezhaohui();">登 录</a></p>
            </div>
          </form>
        </div>
        
        <div class="logincontd loginformd" style="display:none;">
          <form name="loginForm" id="loginForm" method="post" action="">
            <div class="row">
              <p class="l">QQ号：</p>
              <p class="r">
                <input type="text" name="txtUsername" id="txtUsername" class="txt">
              </p>
            </div>
            <div class="row">
              <p class="l">密　码：</p>
              <p class="r">
                <input type="password" name="txtPassword" id="txtPassword" class="txt">
              </p>
            </div>
            <div class="row">
              <p class="l">&nbsp;</p>
              <p class="r"><a href="javascript:;" class="btn">确 定</a></p>
            </div>
          </form>
        </div>
        <!--./logincontd-->
        
        <div class="logincontd loginformd" style="display:none;">
          <form name="loginForm" id="loginForm" method="post" action="">
            <div class="row">
              <p class="l">新浪账号：</p>
              <p class="r">
                <input type="text" name="txtUsername" id="txtUsername" class="txt">
              </p>
            </div>
            <div class="row">
              <p class="l">密　码：</p>
              <p class="r">
                <input type="password" name="txtPassword" id="txtPassword" class="txt">
              </p>
            </div>
            <div class="row">
              <p class="l">&nbsp;</p>
              <p class="r"><a href="user.html" class="btn">登 录</a></p>
            </div>
          </form>
        </div>
        <!--./logincontd--> 
        
      </div>
      <!--./loginwd--> 
    </div>
  </div>
</div>
<!--./content--> 

<!--foot-->
<div class="footd">
  <div class="main">
    <div class="fcontd">
      <p>Copyright &copy; 2007 All Rights Reserved. 深圳市晧辰电子科技有限公司 版权所有&nbsp;&nbsp;<a href="http://www.miitbeian.gov.cn/" target="_blank">[粤ICP备14101712号-1]</a>&nbsp;<a href="#" target="_blank">[法律顾问]</a></p>
      <p>公司地址：广东省深圳市南山区西丽街道牛成路221号8楼&nbsp;&nbsp;邮编：518055</p>
      <p>在线QQ服务：<a href="#"><img src="statics/front/images/fico0.png"></a>&nbsp;&nbsp;服务热线：0755－86016691&nbsp;&nbsp;电话：13715327187&nbsp;&nbsp;传真：0755-86641139-816</p>
      <p>E-mail：info@wl95.com</p>
    </div>
    <div class="fimgd"><a href="#" target="_blank"><img src="statics/front/images/fico1.png"></a><a href="#" target="_blank"><img src="statics/front/images/fico2.png"></a><a href="#" target="_blank"><img src="statics/front/images/fico3.png"></a><a href="#" target="_blank"><img src="statics/front/images/fico4.png"></a></div>
  </div>
</div>
<!--./foot--> 

[#include '/template/front/include/jslist.html' /]
[#-- validate 验证器 --]
<script type="text/javascript" src="${base}/statics/validate/jquery.validate.min.js?version=${setting.basic.siteVersion}"></script>
<script type="text/javascript" src="${base}/statics/validate/jquery.validate.method.min.js?version=${setting.basic.siteVersion}"></script>
<script type="text/javascript">
//切换登录方式
$(".loginnav li").click(function(){
	$(".loginnav li").removeClass("on");
	$(this).addClass("on");
	$(".logincontd").hide();
	$(".logincontd").eq($(this).index()).fadeIn(200);
});
$nForm= $("#n_loginForm"), $nbtn= $nForm.find(":submit");

$(function(){
	$nForm.validate({
		rules:{
			email:{
				required:true,
				pattern:/^(([^()[\]\\.,;:\s@\"]+(\.[^()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,
			}
		},
		messages:{
			email:{
				required:"请输入邮箱",
				pattern:"请输入正确的邮箱格式"
			}
		},
		errorPlacement:function(error,element){
			element.closest("div.row").find(".annotate").text(error.text());
		},
		unhighlight: function(element){
			$(element).closest("div.row").find(".annotate").text("");
		},
		submitHandler:function(form){
			$nbtn.prop("disabled",true);
			$.ajax({
				type:"post",
				data:{
					email:$nForm.find("#email").val()
				},
				dataType:"json",
				cache:false,
				url:"/login/findPass.jspx",
				success:function(result1){
					if(result1.result1=="success"){
						alert("发送Mail成功，请去注册的邮箱地址修改密码！");
						window.location="/login/updatePassword1.jhtml?email="+$nForm.find("#email").val();
					}else{
						alert("发送Mail失败，确认注册的邮箱!");
						$("#email").attr("value","");
						$nbtn.prop("disabled",false);
					}
				},
				error:function(){
					alert("发送Mail失败，确认注册的邮箱!");
					$("#email").attr("value","");
					$nbtn.prop("disabled",false);
				}
			}); 
		}
	});
	
	$("#sendTextfor").on("click",function(){
		var phone = $(this).closest("form").find("input[name='phonenamefor']").val();
		if(phone != null && phone != ''){
			console.log(phone);
			sendupdateText(phone);
		}else{
			alert('请输入电话号码');
		}
})
	
	
});

function sendupdateText(phone){
 	$.ajax({
 		url:"/text/sendupdateTwo",
 		data:{username:phone,validate:'login'},
 		dataType:"json",
 		type:"post",
 		success:function(){
 			alert("发送成功!");			
 		},
 		error:function(){
 			alert("网络异常,请重试!");
 		}
 	});
 }


/**
 * 手机号找回密码
 */
function phonezhaohui()
{
	$.ajax({
		url:"/login/phoneupdatePassword",
		data:{
			username: $("#phonenamefor").val(),
			text: $("#yanzhengmafor").val()
		},
		cache:false,
		type:"post",
		dataType:"json",
		beforeSend:function(request,settings){
			//request.setRequestHeader("token", $.cookie("token"));
			//$nForm.find(".btn").val(" 登 录 中 ... ");
		},
		success:function(msg){
			$nForm.find("#txtPassword").val("");
			if(msg.type=="success"){
				window.location = "/login/phoneupdatePassword2?username="+$("#phonenamefor").val();
			}else{
				alert(msg.cont);
				//$nBtn.val("登录");
				$captchaImg.click();
				$nBtn.prop("disabled", false);
			}
		},
		error:function(){
			alert("登录失败");
		}
	});
}
</script>
</body>
</html>
