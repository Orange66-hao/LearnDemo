<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>个人中心 - 晧辰仪联网</title> [#include
'/template/front/include/csslist.html' /]
<link rel="stylesheet" type="text/css"
	href="/adminthemes/new/js/easy-ui/themes/gray1/easyui.css" />
<link rel="stylesheet" type="text/css"
	href="/adminthemes/new/js/easy-ui/themes/icon.css" />
<link rel="stylesheet" type="text/css"
	href="/statics/front/js/uploadify/uploadify.css"/ >
	<link rel="stylesheet" href="/statics/front/css/postbirdAlertBox.min.css" />
	<script type="text/javascript"
			src="/statics/front/js/postbirdAlertBox.min.js"></script>
</head>
<body>
	<!--top-->
	[#include '/template/front/include/header.html' /]
	<!--./top-->
	<!--loading-->
	<div class="listloadingd" id="indexLoading"></div>
	<!--./loading-->
	<div class="indexContent">
		<!--content-->
		<div class="main userd">
			<div class="umaintitd">
				当前位置：<a href="/" style="text-decoration: none;">首页</a> &gt; <a
					href="/user/user" style="text-decoration: none;">会员中心 </a>&gt; <a
					href="javascript:void;" style="text-decoration: none;"><span>发布新品</span></a>
			</div>
			<!--usernav-->
			[#include '/template/front/include/usernav.html' /]
			<!--./usernav-->

			<!--umainr-->
			<div class="umainr">
				<div class="umainrtitd">
					<span>发布新品</span>
				</div>

				<!--upublishd2-->
				<div class="upublishd2">
					[#include '/front/include/pubHead.html']
					<!--./upubnavd2-->

					<!--客户发布-->
					<div class="upformd">
						<form id="perRegist" action="/" method="post"
							enctype="multipart/form-data" name="pubForm" id="pubForm">
							<input type="text" name="memberId" id="memberId"
								value="${currentMember.id}" style="display: none;">
								

<div hidden="true">
	<input type="text" name="proNameEn" id="proNameEn" class="txt w2" >
               <textarea name="faultEn" id="faultEn" class="txta w1"></textarea>
              <textarea name="maintaindemoEn" id="maintaindemoEn" class="txta w1"></textarea>
  </div>
								
							<div class="row">
								<p class="l">
									<i class="x">*</i>品 牌：
								</p>
								<p class="r">
									<input class="easyui-combobox combo " type="text"
										name="brandId"
										data-options="url:'/brand/get_brand_names.jspx',method:'get',valueField:'id',textField:'text'"
										style="width: 292px; height: 36px;" id="brandId"></input>
								</p>
								<p class="rr">填写维修的产品品牌</p>
							</div>
							<div class="row">
								<p class="l">
									<i class="x">*</i>型 号：
								</p>
								<p class="r">
									<input type="text" name="proNo" id="proNo" class="txt">
								</p>
								<p class="rr"></p>
							</div>
							<div class="row tongbu" style="display: none;">
								<p class="l">&nbsp;</p>
								<p class="fl pr15">根据您填写的品牌和型号，数据库子已有记载是否同步信息：</p>
								<div class="r">
									<label class="pr15"> <input type="radio" name="tongbu"
										id="tongbu1" value="0" checked> 否
									</label> <label class="pr15"> <input type="radio" name="tongbu"
										id="tongbu2" value="1"> 是
									</label>
								</div>
							</div>
							<div class="row">
								<p class="l">选 件：</p>
								<p class="r">
									<input type="text" name="poption" id="poption" class="txt">
								</p>
								<p class="rr"></p>
							</div>
							<div class="row">
								<p class="l">
									<i class="x">*</i>名 称：
								</p>
								<div class="r">
									<p class="fl">
										<input type="text" name="proName" id="proName" class="txt w2">
									</p>
									<!-- 	<p class="fl pl15">英文名：</p>
									<p class="fl">
										<input type="text" name="proNameEn" id="proNameEn"
											class="txt w2">
									</p> -->
								</div>
								<p class="rr"></p>
							</div>
							<div class="row">
								<p class="l">
									<i class="x">*</i>设备类目：
								</p>
								<p class="r">
									<select style="width: 292px; height: 36px;"
										name="proClassId"
										id="proClassId" /> </select>
								</p>
								<p class="rr"></p>
							</div>
							<div class="row">
								<p class="l">是否上架：</p>
								<div class="r">
									<label class="pr15"> <input type="radio"
										name="proownaudit" id="proownaudit" value="1" checked>
										是
									</label> <label class="pr15"> <input type="radio"
										name="proownaudit" id="proownaudit" value="0"> 否
									</label>
								</div>
							</div>
							<div class="row">
								<p class="l">本信息显示在：</p>
								<div class="r">
									<label class="pr15"> <input type="checkbox"
										name="webzh" id="webzh" value="1" checked> 中文站
									</label> <label class="pr15"> <input type="checkbox"
										name="weben" id="weben" value="1"> 英文站
									</label>
								</div>
								<p class="rr"></p>
							</div>
							<div class="row">
								<p class="l">维修价格：</p>
								<div class="r">
									<p class="fl">
										<input type="text" name="repairPrice" id="repairPrice"
											class="txt w3">
									</p>
									<p class="fl pl5">
										<select name="repairPriceUnit" id="repairPriceUnit"
											class="txt sel w4">
											<option value="yuan">元</option>
											<option value="millionyuan">万元</option>
										</select>
									</p>
									<p class="fl pl5">
										<select name="repairPriceType" id="repairPriceType"
											class="txt sel w4">
											<option value="rmb">人民币</option>
											<option value="dollar">美元</option>
										</select>
									</p>
								</div>
								<p class="rr">面议请填0</p>
							</div>
							<div class="row" id="isTax">
								<p class="l">是否含税：</p>
								<div class="r">
									<label class="pr15"> <input type="radio" name="isTax"
										id="isTax" value="0" checked> 否
									</label> <label class="pr15"> <input type="radio" name="isTax"
										id="isTax" value="1"> 是
									</label>
								</div>
								<div class="rr"></div>
							</div>
							<div class="row" id="taxRate" style="display: none;">
								<p class="l">税率：</p>
								<p class="r">
									<select name="taxRate" id="taxRate" class="txt sel w1">
										<option value="invoice">普通发票3%</option>
										<option value="taxInvoice">增值税专用发票3%</option>
										<option value="taxSpecialInvoice">增值税专用发票16%</option>
									</select>
								</p>
							</div>
							<div class="row">
								<p class="l">是否可计量：</p>
								<div class="r">
									<p class="fl" id="isUnit">
										<label class="pr15"> <input type="radio" name="isUnit"
											id="isUnit" value="0" checked> 否
										</label> <label class="pr15"> <input type="radio"
											name="isUnit" id="isUnit" value="1"> 是
										</label>
									</p>
									<p class="fl pl5" id="proUnit">
										<input type="text" name="proUnit" id="proUnit" class="txt w5"
											style="display: none;">
									</p>
								</div>
								<p class="rr"></p>
							</div>
							<div class="row">
								<p class="l">维修周期：</p>
								<div class="r">
									<p class="fl">
										<input type="text" name="maintainPeriod" id="maintainPeriod"
											class="txt w7">
									</p>
									<p class="fl pl5">
										<select name="maintainPeriodunit" id="maintainPeriodunit"
											class="txt sel w6">
											<option value="day">天</option>
											<option value="week">周</option>
											<option value="month">月</option>
										</select>
									</p>
								</div>
								<p class="rr"></p>
							</div>
							<div class="row">
								<p class="l">维修地：</p>
								<div class="r">
									<p class="fl">
										<select name="prouseAddress" id="prouseAddress"
											data-options="editable:false" class="easyui-combobox combo"
											style="width: 125px; height: 36px;">
											<option value="inChina">中国</option>
											<option value="outofChina">国外</option>
										</select>
									</p>
									<p class="fl pl5">
										<input class="easyui-combobox combo " type="text"
											name="areaProvince"
											data-options="url:'/worldArea/get_province.jspx?id=0',method:'get',valueField:'id',textField:'text',editable:false "
											style="width: 125px; height: 36px;" id="areaProvince"></input>
									</p>
									<p class="fl pl5">
										<input class="easyui-combobox combo " type="text"
											name="areaCity" style="width: 125px; height: 36px;"
											id="areaCity"
											data-options="method:'get',valueField:'id',textField:'text',editable:false "></input>
									</p>
								</div>
								<p class="rr">填写维修产品的所在地</p>
							</div>
							<div class="row">
								<p class="l">保修时间：</p>
								<div class="r">
									<p class="fl">
										<input type="text" name="repairPeriod" id="repairPeriod"
											class="txt w7">
									</p>
									<p class="fl pl5">
										<select name="repairPeriodUnit" id="repairPeriodUnit"
											class="txt sel w6">
											<option value="day">天</option>
											<option value="week">周</option>
											<option value="month">月</option>
										</select>
									</p>
								</div>
								<p class="rr">无保修请填0</p>
							</div>
							<div class="row">
								<p class="l">添加图片:</p>
								<p class="r">
									<INPUT type="file" name="uploadify" id="uploadify" />
								</p>
								<p class="rr">选择要上传的图片，最多4张</p>
							</div>
							<div class="row">
								<p class="l">图片预览:</p>
								<div class="xsfb-preview-ad">
									<div id="preview1" class="xsfb-vdiv img-previewd"
										style="display: none;">
										<img class="urt-tit-img"
											src="/statics/front/images/close_2.png"
											style="position: absolute; right: 3px; top: 3px;"
											onclick="delImg(1)" /> <img class=advimg1 src="" width="100"
											height="100"> <input class="prooriginal1" type="text"
											name="proOriginal1" hidden />
									</div>
									<div id="fileQueue1"></div>
									<div id="preview2" class="xsfb-vdiv img-previewd"
										style="display: none;">
										<img class="urt-tit-img"
											src="/statics/front/images/close_2.png"
											style="position: absolute; right: 3px; top: 3px;"
											onclick="delImg(2)" /> <img class=advimg2 src="" width="100"
											height="100"> <input class="prooriginal2" type="text"
											name="proOriginal2" hidden />
									</div>
									<div id="preview3" class="xsfb-vdiv img-previewd"
										style="display: none;">
										<img class="urt-tit-img"
											src="/statics/front/images/close_2.png"
											style="position: absolute; right: 3px; top: 3px;"
											onclick="delImg(3)" /> <img class=advimg3 src="" width="100"
											height="100"> <input class="prooriginal3" type="text"
											name="proOriginal3" hidden />
									</div>
									<div id="preview4" class="xsfb-vdiv img-previewd"
										style="display: none;">
										<img class="urt-tit-img"
											src="/statics/front/images/close_2.png"
											style="position: absolute; right: 3px; top: 3px;"
											onclick="delImg(4)" /> <img class=advimg4 src="" width="100"
											height="100"> <input class="prooriginal4" type="text"
											name="proOriginal4" hidden />
									</div>
									<div class="clear"></div>
								</div>
							</div>
							<div class="row">
								<p class="l">常见故障：</p>
								<p class="r">
									<textarea name="fault" id="fault" class="txta w1"></textarea>
								</p>
							</div>
							<!-- <div class="row">
								<p class="l">英文输入：</p>
								<p class="r">
									<textarea name="faultEn" id="faultEn" class="txta w1"></textarea>
								</p>
							</div> -->
							<div class="row">
								<p class="l">维修案例：</p>
								<p class="r">
									<textarea name="maintaindemo" id="maintaindemo" class="txta w1"></textarea>
								</p>
							</div>
							<!-- <div class="row">
								<p class="l">英文输入：</p>
								<p class="r">
									<textarea name="maintaindemoEn" id="maintaindemoEn"
										class="txta w1"></textarea>
								</p>
							</div> -->
							<div class="row">
								<p class="l">信息有效期：</p>
								<div class="r">
									<p class="fl">
										<input style="width: 292px; line-height: 36px; height: 36px;"
											panelWidth="292px;"
											data-options="required:true,missingMessage:'必填项',editable:false"
											id="inforValidity" name="inforValidity" type="text"
											class="easyui-datebox"> <span id="changqi"><input
											type="checkbox" name="longTerm" id="longTerm"
											style="width: 20px; height: 20px; vertical-align: middle;">&nbsp;长期</span>
									</p>
								</div>
								<p class="rr"></p>
							</div>
							<div class="row">
								<p class="l">产品分类：</p>
								<p class="r">
									<select style="width: 292px; line-height: 36px; height: 36px;"
										name="indClassId"
										id="indClassId" /> </select>
										<!--<input type="button" style="width: 50px;height: 30px" value="刷新" onclick="refresh()"/>-->
								</p>
								<p class="rr">选择该仪器可以测试的产品（支持多选）</p>
							</div>
							<div class="row">
								<p class="l">备注：</p>
								<p class="r">
									<input type="text" name="apply" id="apply" class="txt">
								</p>
							</div>
							<div class="row">
								<p class="l">优化标题</p>
								<p class="r">
									<input type="text" name="prometaTitle" id="prometaTitle"
										class="txt">
								</p>
								<p class="rr">商品页的页头上进行显示的SEO标题信息，不多于150字</p>
							</div>
							<div class="row">
								<p class="l">优化关键字</p>
								<p class="r">
									<input type="text" name="proMetaKeywords" id="proMetaKeywords"
										class="txt">
								</p>
								<p class="rr">设置关键字，以便于搜索引擎抓取，不多于100字</p>
							</div>
							<div class="row">
								<p class="l">优化描述</p>
								<p class="r">
									<input type="text" name="prometaDescription"
										id="prometaDescription" class="txt">
								</p>
							</div>
							<div class="row tkd">
								<p class="l">&nbsp;</p>
								<p class="r">
									<input type="checkbox" name="ckTK" id="ckTK" checked>
									我已阅读并同意<a href="#" class="blue" target="_blank">《晧辰仪联网服务条款》</a>
								</p>
							</div>
							<div class="row">
								<p class="l">&nbsp;</p>
								<p class="r">
									<input type="submit" value="提交" class="subbtn"
										style="border: 0px;">
								</p>
							</div>
						</form>
					</div>
					<!--./upformd-->

				</div>
				<!--./upublishd-->
			</div>
			<!--./umainr-->
		</div>
		<!--./content-->
	</div>
	<!--foot-->
	[#include '/template/front/include/footer2.html' /]
	<!--./foot-->

	[#include '/template/front/include/jslist.html' /]
	<!-- uploadify -->
	<script type="text/javascript"
		src="/statics/front/js/uploadify/jquery.uploadify.v2.1.4.min.js"></script>
	<script type="text/javascript"
		src="/statics/front/js/uploadify/swfobject.js"></script>

	<script type="text/javascript"
		src="/adminthemes/new/js/ajaxupload.3.9.js"></script>
	<script type="text/javascript" src="/adminthemes/new/js/easy-ui/jquery1.easyui.min.js"></script>
	<script type="text/javascript"
		src="/adminthemes/new/js/easy-ui/easyui-lang-zh_CN.js"></script>
	<script src="/statics/front/js/kindeditor/kindeditor-all-min.js"></script>
	[#-- validate 验证器 --]
	<script type="text/javascript"
		src="/statics/validate/jquery.validate.min.js"></script>
	<script type="text/javascript"
		src="/statics/validate/jquery.validate.method.min.js"></script>


	<script>
        function refresh() {
            $.ajax({
                url:"/admin/industyClass/expandByYiqiId.jspx",
                type:"post",
                data:{"yiqiId": $("#proClassId").combotree('getValue')},
                success:function (data) {
                    var arr=[];
                    $.each(data,function (index,e) {
                        var t = $('#indClassId').combotree('tree');	// get the tree object
                        // find a node and then select it
                        var node = t.tree('find',e.id);
                        arr.push(e.id)
                    })
                    $('#indClassId').combotree('setValues',arr)
                }
            })
        }
        $('#proClassId').combotree({
            width:300,
            method:'get',
            url: '/productClass/combotreeData.json',

            required: true
        });

        $('#indClassId').combotree({
            width:300,
            method:'get',
            url: '/industryClass/combotreeData.json',
            onlyLeafCheck:true,
            multiple: true
        });

		//长期
		$("#longTerm").click(function() {
			if ($(this).attr("checked")) {
				$("#inforValidity").datebox({
					disabled : true
				});
			} else {
				$("#inforValidity").datebox({
					disabled : false
				});
			}
		});
		//给点击的target加上链接样式 
		$(".upubnavd2").find("li").eq(2).find("a").eq(0).addClass("on");
		//品牌 触发同步
		$("#brandId").combobox({
			onSelect : function() {
				$.ajax({
					data : {
						brandId : $("#brandId").combobox('getValue'),
						proNo : $("#proNo").val()
					},
					dataType : "json",
					type : "post",
					caChe : false,
					url : "/tongBasedata/Tong",
					success : function(result) {
						if (result.result == 1) {
							$(".tongbu").show();
						} else {
							$(".tongbu").hide();
						}
					},
					error : function() {
					}
				});
			}
		});
		//型号 触发同步
		$("#proNo").on('input', function() {
			$.ajax({
				data : {
					brandId : $("#brandId").combobox('getValue'),
					proNo : $("#proNo").val()
				},
				dataType : "json",
				type : "post",
				caChe : false,
				url : "/tongBasedata/Tong",
				success : function(result) {
					if (result.result == 1) {
						$(".tongbu").show();
					} else {
						$(".tongbu").hide();
					}
				},
				error : function() {
				}
			});
		});

		//是否同步数据
		$("input[name=tongbu]").click(function(){
			$.ajax({
				data:{
					brandId: $("#brandId").combobox('getValue'),
					proNo : $("#proNo").val()
				},
				dataType:"json",
				type:"post",
				caChe:false,
				url:"/tongBasedata/Tong",
				success:function(result){
					if($("input[name=tongbu]:checked").attr("id") == "tongbu2"){
						$("#proName").val(result.proName);
						$("#proNameEn").val(result.proNameEn);
						$("#proClassId").combotree({
							onLoadSuccess:function(){
								$("#proClassId").combotree('setValue', result.proClassId);
							}
						});
						$("#indClassId").combotree({
							onLoadSuccess:function(){
								$("#indClassId").combotree('setValue', result.indClassId);
							}
						});
					}else{
						$("#proName").val("");
						$("#proNameEn").val("");
						$("#proClassId").combotree({
							onLoadSuccess:function(){
								$("#proClassId").combotree('setValue', "");		
							}
						});				
						$("#indClassId").combotree({
							onLoadSuccess:function(){
								$("#indClassId").combotree('setValue', "");
							}
						});
					}
				},
				error:function(){}
			});
		});
		$("#isUnit").find("input[name=isUnit]").change(function() {
			if ($(this).val() == 1) {
				$("#proUnit").find("input[name=proUnit]").fadeIn();
			} else {
				$("#proUnit").find("input[name=proUnit]").fadeOut();
			}
		});
		$("#isTax").find("input[name=isTax]").change(function() {
			if ($(this).val() == 1) {
				$("#taxRate").slideDown();
			} else {
				$("#taxRate").slideUp();
			}
		});

		//图片上传取消
		function delImg(index) {
			document.getElementById("preview" + index).style.display = "none";
			$(".advimg" + index).attr("src", "");
			$(".prooriginal" + index).attr("value", "");
		}

		/* 	initAjaxUploadImg('btnPreViewImg','exap','img');
		 initAjaxUploadImg('btnPreViewImg1','exap1','img1');
		 initAjaxUploadImg('btnPreViewImg2','exap2','img2');
		 initAjaxUploadImg('btnPreViewImg3','exap3','img3'); */
		 var editor_fault, editor_faultEn, editor_maintaindemo, editor_maintaindemoEn;
		 KindEditor.ready(function(K) {
		 	editor_fault = K.create('#fault');
		 	editor_faultEn = K.create('#faultEn');
		 	editor_maintaindemo = K.create('#maintaindemo');
		 	editor_maintaindemoEn = K.create('#maintaindemoEn');
		 	//window.editor = K.create('#proSynopsisEn, #proContent, #proContentEn');
		 });
		var $pubForm = $("#perRegist");
		$(function() {
            //阻止输入没有的品牌
            $("#brandId").combobox({
                filter: function (q, row) {
                    var opts = $(this).combobox('options');
                    return row.text.indexOf(q) >= 0||row.textZh.toUpperCase().indexOf(q.toUpperCase())>=0;//这里改成>=即可在任意地方匹配
                },
                onHidePanel: function() {
                    var valueField = $(this).combobox("options").valueField;
                    var val = $(this).combobox("getValue");  //当前combobox的值
                    var allData = $(this).combobox("getData");   //获取combobox所有数据
                    var result = true;      //为true说明输入的值在下拉框数据中不存在
                    for (var i = 0; i < allData.length; i++) {
                        if (val == allData[i][valueField]) {
                            result = false;
                            break;
                        }
                    }
                    if (result) {
                        PostbirdAlertBox.alert({
                            'title': '提 示',
                            'content': '请选择下拉框中的品牌',
                            'okBtn': '好的',
                            'contentColor': 'blue',
                            'onConfirm': function () {
                            }
                        });
                        $(this).combobox("clear");
                    }
                }
            })
			//初始化上传按钮
			$("#uploadify")
					.uploadify(
							{//初始化函数
								'uploader' : '/statics/front/js/uploadify/uploadify.swf',//flash文件位置，注意路径
								'script' : '/fileUpload/imgUpload.jspx',//后台处理的请求
								'cancelImg' : '/statics/front/js/uploadify/cancel.png',//取消按钮图片
								'folder' : 'uploads',//您想将文件保存到的路径
								'queueID' : 'fileQueue1',//与下面的上传文件列表id对应
								'queueSizeLimit' : 4,//上传文件的数量
								'fileDesc' : '图片文件',//上传文件类型说明
								'fileExt' : '*.jpg;*.jpeg;*.png;*.gif;*.bmp', //控制可上传文件的扩展名，启用本项时需同时声明fileDesc
								'method' : 'post',//如果向后台传输数据，必须是get
								'sizeLimit' : 6 * 1024 * 1024,//文件上传的大小限制，单位是字节
								'auto' : true,//是否自动上传
								'multi' : true,
								'simUploadLimit' : 4,//同时上传文件的数量
								//'buttonText' :'上传',//浏览按钮图片
								'onComplete' : function(event, queueID,
										fileObj, response, data) {//当上传完成后的回调函数，ajax方式哦~~ 

									if (document.getElementById("preview1").style.display == "none") {
										document.getElementById("preview1").style.display = "";
										$(".advimg1").attr("src", response);
										$(".prooriginal1").attr("value",
												response);

									} else if (document
											.getElementById("preview2").style.display == "none") {
										document.getElementById("preview2").style.display = "";
										$(".advimg2").attr("src", response);
										$(".prooriginal2").attr("value",
												response);
									} else if (document
											.getElementById("preview3").style.display == "none") {
										document.getElementById("preview3").style.display = "";
										$(".advimg3").attr("src", response);
										$(".prooriginal3").attr("value",
												response);
									} else if (document
											.getElementById("preview4").style.display == "none") {
										document.getElementById("preview4").style.display = "";
										$(".advimg4").attr("src", response);
										$(".prooriginal4").attr("value",
												response);
									}
								},
								'onError' : function(a, b, c, d) {
									if (d.status == 404)
										alert('找不到文件');
									else if (d.type === "HTTP")
										alert('error ' + d.type + ": "
												+ d.status);
									else if (d.type === "File Size")
										alert('上传的文件合计大小超过6M');
									else
										alert('error ' + d.type + ": " + d.info);
								}

							});

			//有效期
			$('#inforValidity').datebox().datebox('calendar').calendar(
					{
						validator : function(date) {
							var now = new Date();
							var d1 = new Date(now.getFullYear(),
									now.getMonth(), now.getDate() + 1);
							var d2 = new Date(now.getFullYear(),
									now.getMonth(), now.getDate() + 30);
							return d1 <= date && date <= d2;
						}
					});

			//国内
			$("#prouseAddress").combobox(
					{
						onSelect : function() {
							var prouse = $(this).combobox('getValue');
							if (prouse == "outofChina") {
								$("#areaCity").combobox('setValue', "");
								$("#areaProvince").combobox('setValue', "");
								$("#areaProvince").combobox('reload',
										"/worldArea/get_province.jspx?id=1");
							} else {
								$("#areaCity").combobox('setValue', "");
								$("#areaProvince").combobox('setValue', "");
								$("#areaProvince").combobox('reload',
										"/worldArea/get_province.jspx?id=0");
							}
						}
					});
			//省
			$("#areaProvince").combobox(
					{
						onSelect : function() {
							$("#areaCountry").combobox('setValue', "");
							$("#areaCity").combobox('setValue', "");
							$("#areaCity").combobox(
									'reload',
									"/worldArea/get_city.jspx?id="
											+ $(this).combobox('getValue'));
						}
					});
			//市
			$("#areaCity").combobox(
					{
						onSelect : function() {
							$("#areaCountry").combobox('setValue', "");
							$("#areaCountry").combobox(
									'reload',
									"/worldArea/get_country.jspx?id="
											+ $(this).combobox('getValue'));
						}
					});
			var validate = $("#perRegist")
					.validate(
							{
								
								rules : {
									brandId:{required : true},
									proNo : {
										required : true
									},
									poption : {
										pattern : /^([0-9]|[a-z]|[A-Z]|[\.\, ])+$/
									},
									proName : {
										required : true
									},
									repairPrice : {
										required : true
									},
									maintainPeriod : {
										required : true
									}

								},
								messages : {
									proNo : {
										required : "请填写维修产品的型号"
									},
									brandId:{required :"请填写维修产品的品牌"},
									proName : {
										required : "请填写维修产品的名称"
									},
									repairPrice : {
										required : "请填写维修产品的维修价格"
									},
									maintainPeriod : {
										required : "请填写维修产品的维修周期"
									}
								},
								errorPlacement : function(error, element) {
									element.closest(".row").find(".rr").text(
											error.text());
								},
								unhighlight : function(element) {
									$(element).closest(".row").find(".rr")
											.text("");
								},
								submitHandler : function(form) {
									//长期
									if ($("#longTerm").attr("checked") == "checked") {
										$("#longTerm").attr("value", "1");
									} else {
										$("#longTerm").attr("value", "0");
									}
									//中文站
									if ($("#webzh").attr("checked") == "checked") {
										$("#webzh").attr("value", "1")
									} else {
										$("#webzh").attr("value", "0")
									}
									//英文站
									if ($("#weben").attr("checked") == "checked") {
										$("#weben").attr("value", "1");
									} else {
										$("#weben").attr("value", "0");
									}
									if( $ ("#brandId").combobox ('getValue')==""){
										alert("请填写产品品牌");
										return false;
									}
									$pubForm.find(".subbtn").prop("disabled",
											true);
									$
											.ajax({
												url : "/user_pub_repair/user_pub_repair",
												data : {
													longTerm: $("#longTerm").val(),
													brandId: $("#brandId").combobox('getValue'),
													brandName: $("#brandId").combobox('getValue'),
													proNo: $("#proNo").val(),
													poption: $("#poption").val(),
													proName: $("#proName").val(),
													proNameEn: $("#proNameEn").val(),
													proClassId: $("#proClassId").combotree("getValue"),
													indClassId: $("#indClassId").combotree("getText"),
													memberId: $("#memberId").val(),
													repairPrice: $("#repairPrice").val(),
													repairPriceUnit: $("#repairPriceUnit").val(),
													repairPriceType: $("#repairPriceType").val(),
													prouseAddress: $("#prouseAddress").combobox('getValue'),
													areaCity: $("#areaCity").combobox('getValue'),
													areaProvince: $("#areaProvince").combobox('getValue'),
													isUnit: $("#isUnit").find("input[name=isUnit]:checked").val(),
													proUnit: $("input[name=proUnit]").val(),
													maintainPeriodunit: $("#maintainPeriodunit").val(),
													maintainPeriod: $("#maintainPeriod").val(),
													proownaudit: $("#proownaudit").val(),
													webzh: $("#webzh").val(),
													weben: $("#weben").val(),
													isTax: $("#isTax").find("input[name=isTax]:checked").val(),
													taxRate: $("#taxRate").find("#taxRate").val(),
													proOriginal1: $(".advimg1").attr("src"),
													proOriginal2: $(".advimg2").attr("src"),
													proOriginal3: $(".advimg3").attr("src"),
													proOriginal4: $(".advimg4").attr("src"),
													fault: editor_fault.html(),
													faultEn: editor_faultEn.html(),
													maintaindemo: editor_maintaindemo.html(),
													maintaindemoEn: editor_maintaindemoEn.html(),
													apply: $("#apply").val(),
													prometaTitle: $("#prometaTitle").val(),
													proMetaKeywords: $("#proMetaKeywords").val(),
													prometaDescription: $("#prometaDescription").val(),
													inforValidity: $("#inforValidity").datebox('getValue'),
													repairPeriod: $("#repairPeriod").val(),
													repairPeriodUnit: $("#repairPeriodUnit").val()
												},
												dataType : "json",
												cache : false,
												type : "post",
												beforeSend : function() {
													$pubForm.find(".subbtn")
															.val("发布维修中...");
												},
												success : function(message) {
													if (message.type == "success") {
														alert("发布维修成功!等待审核!")
														window.location = "/fastPubSuccess";
													}
													if (message.type == "error") {
														if ($("#proClassId")
																.combotree(
																		"getValue") == "") {
															alert("设备类目不能为空!");
															$pubForm
																	.find(
																			".subbtn")
																	.prop(
																			"disabled",
																			false);
															$pubForm.find(
																	".subbtn")
																	.val("提交");
														} else {
															alert("信息有效期不能为空!");
															$pubForm
																	.find(
																			".subbtn")
																	.prop(
																			"disabled",
																			false);
															$pubForm.find(
																	".subbtn")
																	.val("提交");
														}
													}
												}
											});
								}
							});
		});
	</script>

</body>
</html>
