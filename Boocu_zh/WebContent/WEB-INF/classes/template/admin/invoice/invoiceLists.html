<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=9" > </meta>
<title>云图商城-后台管理</title>
<style type="text/css">
body{
	margin:0px;
	font-family:Arial,"宋体",Verdana,sans-serif;
	font-size:12px;
}
html,body {padding: 0;margin: 0; overflow-x:hidden; overflow-y:auto;}
dl,dd{margin:0px}
ul{
	list-style-type:none;
	margin:0px;
	padding:0px;
	
}
</style>
<script type="text/javascript" src="/adminthemes/new/js/jquery-1.8.3.min.js"></script>
<link rel="stylesheet" type="text/css" href="/adminthemes/new/js/easy-ui/themes/gray/easyui.css"/>    
<link rel="stylesheet" type="text/css" href="/adminthemes/new/js/easy-ui/themes/icon.css"/>  
<script type="text/javascript" src="/adminthemes/new/js/easy-ui/jquery.easyui.min.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/easy-ui/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/jquery.blockUI.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/jquery.loading.js"></script>
<link href="/adminthemes/new/css/main.css" rel="stylesheet" type="text/css" />
<link href="/adminthemes/new/css/style.css" rel="stylesheet" type="text/css" />
<link href="/statics/front/css/xcConfirm.css" rel="stylesheet" type="text/css" />
<link href="/statics/css/daterangepicker.css" rel="stylesheet" type="text/css" />
<script src="/statics/front/js/xcConfirm.js"></script>
<script src="/statics/js/moment.min.js"></script>
<script src="/statics/js/jquery.daterangepicker.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/jquery-form-2.33.js"></script>

<script type="text/javascript">
//初始化数据集
$(function(){
	//隐藏的列
	$("#invoiceList").datagrid('hideColumn', 'id');
	
	//加载时间插件
	//$('#createTime').dateRangePicker();
});
</script>
[#include '/template/admin/include/common.html']

</head>
<body>
<div id="loading"></div>
<div class="main">
	<div class="easyui-tabs">
		<div title="发票列表" style="padding:10px;">
			<div class="clear height10"></div>
			<form id="memberform1">
				<div id="tb" style="height: auto">
					<span style="float: left;"> 
						<span id="simpleSearch">
							发票状态：
							<select id="status" name="status" onchange="searchCon()">
								<option value="-1">- 发票状态 -</option>
								<option value="0">未申请</option>
								<option value="1">审核中</option>
								<option value="2">开票中</option>
								<option value="3">邮寄中</option>
								<option value="4">开票完成</option>
								<option value="5">审核未通过</option>
							</select>
						</span>
					</span>
				</div>
				<div class="clear height10"></div>
				<div class="shadowBoxWhite tableDiv"></div>
			</form>
			<div class="shadowBoxWhite tableDiv">
				<div id="noproc">
					<table class="easyui-datagrid"
						data-options="url:'/adminInvoice/invoiceData.json',pageList: [5,10,15,20],pageSize:10"
						pagination="true" id="invoiceList" sortName="id" sortOrder="desc">
						<thead>
							<tr>
							 	<th data-options="field:'orderNum',width:200,align:'center'" >订单编号</th>
							 	<th data-options="field:'id'" ></th>
							 	<th data-options="field:'proName',width:200,align:'center'">商品名称</th>
							 	<th data-options="field:'userName',width:100,align:'center'" >买家名称</th>
							 	<th data-options="field:'brandName',width:250,align:'center'" >品牌名称</th>
								<th data-options="field:'proNo',width:150,align:'center'">商品型号</th>
								<th data-options="field:'amount',width:100,align:'center'">发票金额</th>
								<th data-options="field:'item',width:70,align:'center'">项目</th>
								<th data-options="field:'type',width:80,align:'center'" formatter="inType">发票类型</th>
								<th data-options="field:'buyTime',width:150,align:'center'">购买时间</th>
								<th data-options="field:'applyTime',width:150,align:'center'">申请时间</th>
								<th data-options="field:'status',width:80,align:'center'" formatter="inStatus">状态</th>
								<th data-options="field:'null',width:70,align:'center'" formatter="opera">操作</th>
							</tr>
						</thead>
					</table>
				</div>
			</div>
		</div>
	</div>
	<div id="divdia" style="display: none;"></div>
</div>

<script type="text/javascript">

function inStatus(value, row, index){
	var status = row.status;
	var status_val;
	if(status == 0){
		status_val = "未申请";
	}else if(status == 1){
		status_val = "审核中";
	}else if(status == 2){
		status_val = "开票中";
	}else if(status == 3){
		status_val = "邮寄中";
	}else if(status == 4){
		status_val = "开票完成";
	}else if(status == 5){
		status_val = "审核未通过";
	}
	
	var val = "<a class='details' title='发票状态' href='javascript:void(0);' >"+status_val+"</a>";
	return val;
}

function searchCon(){
	
	var status = $("#status option:selected ").val();
	
	$("#invoiceList").datagrid("load",{
		status:status,
		page:1
	});
}

function inType(value, row, index){
	var type = row.type;
	var type_val;
	if(type == 0){
		type_val = "普通发票";
	}else if(type == 1){
		type_val = "增值税发票";
	}
	
	var val = "<a class='details' title='发票类型' href='javascript:void(0);' >"+type_val+"</a>";
	return val;
}

function opera(value, row, index){
	var status = row.status;
	var ghtml = "<a class='edit' title='更改状态' href='javascript:void(0);' onclick='upEdit(" + row.id + ")' ></a>";
	ghtml += "<a class='issue' title='查看' href='javascript:void(0);' onclick='seek(" + row.id + ")'></a>";
	return ghtml;
}

function seek(id){
    var map = {}; // Map map = new HashMap();
    if (id != null)
    {
        map["href"] = "/adminInvoice/invoiceDetail.jspx?id=" + id +"&d_type=1";
        map["formId"] = "#editStatusForm";
        map["title"] = "发票信息";
        map["loadshow"] = "正在刷新数据......";
        map["url"] = "#";
        map["text"] = "关闭";
    }
    map["divDialog"] = "#divdia";
    map["gridreload"] = "#invoiceList";
    addDialogInfo (map);
}

function addDialogInfo (map){
    $ (map["divDialog"]).show ();
    $ (map["divDialog"]).dialog (
    {
        title : map["title"],
        width : 900,
        height : 600,
        closed : false,
        cache : false,
        href : map["href"],
        modal : true,buttons : [ {
			text : map['text'],
			iconCls : 'icon-ok',
			handler : function() {
				var savebtn = $(this);
　　				var disabled=savebtn.hasClass("l-btn-disabled");
　　				if(!disabled){
　　					window.location.href = window.location.href;
				}
			}
		} ]
    });
}

function upEdit(id){
    var map = {}; // Map map = new HashMap();
    if (id != null)
    {
        map["href"] = "/adminInvoice/invoiceDetail.jspx?id=" + id +"&d_type=0";
        map["formId"] = "#editStatusForm";
        map["title"] = "修改订单状态";
        map["loadshow"] = "正在刷新数据......";
        map["url"] = "/adminInvoice/updateStatus.jspx";
        map["text"] = "确定";
    }
    map["divDialog"] = "#divdia";
    map["gridreload"] = "#invoiceList";
    addDialog (map);
}

function addDialog (map){
    $ (map["divDialog"]).show ();
    $ (map["divDialog"]).dialog (
    {
        title : map["title"],
        width : 500,
        height : 300,
        closed : false,
        cache : false,
        href : map["href"],
        modal : true,buttons : [ {
			text : map['text'],
			iconCls : 'icon-ok',
			handler : function() {
				var savebtn = $(this);
　　				var disabled=savebtn.hasClass("l-btn-disabled");
　　				if(!disabled){
　　					submitForm(map,savebtn);
				}
			}
		} ]
    });
}

//查看
function submitForm (map)
{
    $.Loading.show (map["loadshow"]);
    var options =
    {
        url : map["url"],
        type : "POST",
        success : function (result)
        {
          
          $ (map["divDialog"]).dialog ('close');
          $ (map["gridreload"]).datagrid ('reload');
          $ (map["orderList"]).datagrid ('reload');
          $.Loading.hide ();
        },
        error : function (e)
        {
         alert ("出现错误 ，请重试");
        }
    };
    $ (map["formId"]).ajaxSubmit (options);
}
</script>
</body>
</html>