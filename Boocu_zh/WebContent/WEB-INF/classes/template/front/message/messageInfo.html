<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>个人中心 - 晧辰仪联网</title> [#include
'/template/front/include/csslist.html' /]
<link rel="stylesheet" type="text/css"
	href="/adminthemes/new/js/easy-ui/themes/gray/easyui.css" />
<link rel="stylesheet" type="text/css"
	href="/adminthemes/new/js/easy-ui/themes/icon.css" />
<style type="text/css">
#w1 {
	display: none;
	background: #000;
	filter: alpha(opacity = 70);
	opacity: 0.7;
	left: 0px;
	top: 0px;
	position: fixed;
	height: 100%;
	width: 100%;
	z-index: 1001;
}

.input_text, .lvPrice, .ipt {
	border: 1px solid #D7D7D7;
	border-radius: 3PX;
	/*height: 14PX;*/
	padding: 7px 0 7px 5px;
	line-height: 14PX;
	font-size: 12px;
	display: inline-block;
	width: 300px;
}

.input_text:focus, .lvPrice:focus, .ipt:focus {
	border: 1px solid #06F;
	box-shadow: inset 0 1px 2px rgba(0, 102, 255, 0.3);
}

.input_text {
	float: left;
}

.quickAdd input[type=text], .quickAdd textarea {
	border: 1px solid #efe591;
	width: 100%;
}

.quickAdd input[type=text]:hover, .quickAdd input[type=text]:focus,
	.quickAdd textarea:focus, .quickAdd textarea:hover {
	border: 1px solid #F60;
}

.field-validation-error {
	color: #fa0202;
	border: 1px solid #fb5240;
	text-indent: 30px;
	display: inline-block;
	background: url(../images/errorIcon.png) no-repeat 5px 2px #fef3f3;
	line-height: 27px;
	padding: 0 5px;
	font-size: 12px;
	border-radius: 3px;
	position: absolute;
	margin-top: -15px;
	white-space: nowrap;
	z-index: 100;
}

.input-validation-error {
	border: 1px solid #ff0000;
}

.validation-summary-errors {
	display: none;
}

.errorInfo {
	border: 0px solid #000;
	position: absolute;
	top: 30px;
	right: 35%;
	width: 30%;
	z-index: 10000;
	color: #fff;
	line-height: 30px;
	padding: 0 5px;
	background: #fd7742;
	text-align: center;
	box-shadow: 0 1px 3px rgba(0, 0, 0, .3);
	max-height: 95px;
	overflow: hidden;
	display: none;
	font-size: 14px;
	border-radius: 3px;
}

.shadowBoxWhite {
	background: #FFF;
	box-shadow: 0 2px 2px rgba(0, 0, 0, 0.3);
	filter:
		"progid:DXImageTransform.Microsoft.Shadow(color=#AAAAAA,direction=0,strength=0) progid:DXImageTransform.Microsoft.Shadow(color=#CCCCCC,direction=90,strength=3) progid:DXImageTransform.Microsoft.Shadow(color=#888888,direction=180,strength=5) progid:DXImageTransform.Microsoft.Shadow(color=#CCCCCC,direction=270,strength=3)";
	*/
}

.order_detail .shadowBoxWhite, .goods_input .shadowBoxWhite,
	.member_detail .shadowBoxWhite {
	background: #FFF;
	box-shadow: none;
}

.shadowBoxYellow {
	background: #fff8be;
	box-shadow: 0 2px 2px rgba(0, 0, 0, 0.3);
	/*filter: "progid:DXImageTransform.Microsoft.Shadow(color=#AAAAAA,direction=0,strength=0) progid:DXImageTransform.Microsoft.Shadow(color=#CCCCCC,direction=90,strength=3) progid:DXImageTransform.Microsoft.Shadow(color=#888888,direction=180,strength=5) progid:DXImageTransform.Microsoft.Shadow(color=#CCCCCC,direction=270,strength=3)";*/
}

.tooltip {
	border-radius: 5px;
	border-style: solid;
	border-width: 1px;
	display: none;
	opacity: 1;
	outline: medium none;
	padding: 5px;
	position: absolute;
	z-index: 9900000;
}

.tooltip-content {
	font-size: 12px;
}

.tooltip-arrow-outer, .tooltip-arrow {
	border-color: rgba(0, 0, 0, 0);
	border-style: solid;
	border-width: 6px;
	font-size: 0;
	height: 0;
	line-height: 0;
	position: absolute;
	width: 0;
}

.tooltip-right .tooltip-arrow-outer {
	left: 0;
	margin: -6px 0 0 -13px;
	top: 50%;
}

.tooltip-right .tooltip-arrow {
	left: 0;
	margin: -6px 0 0 -12px;
	top: 50%;
}

.tooltip-left .tooltip-arrow-outer {
	margin: -6px -13px 0 0;
	right: 0;
	top: 50%;
}

.tooltip-left .tooltip-arrow {
	margin: -6px -12px 0 0;
	right: 0;
	top: 50%;
}

.tooltip-top .tooltip-arrow-outer {
	bottom: 0;
	left: 50%;
	margin: 0 0 -13px -6px;
}

.tooltip-top .tooltip-arrow {
	bottom: 0;
	left: 50%;
	margin: 0 0 -12px -6px;
}

.tooltip-bottom .tooltip-arrow-outer {
	left: 50%;
	margin: -13px 0 0 -6px;
	top: 0;
}

.tooltip-bottom .tooltip-arrow {
	left: 50%;
	margin: -12px 0 0 -6px;
	top: 0;
}

.tooltip {
	background-color: #FFFFFF;
	border-color: #D3D3D3;
	color: #000000;
}

.tooltip-right .tooltip-arrow-outer {
	border-right-color: #D3D3D3;
}

.tooltip-right .tooltip-arrow {
	border-right-color: #FFFFFF;
}

.tooltip-left .tooltip-arrow-outer {
	border-left-color: #D3D3D3;
}

.tooltip-left .tooltip-arrow {
	border-left-color: #FFFFFF;
}

.tooltip-top .tooltip-arrow-outer {
	border-top-color: #D3D3D3;
}

.tooltip-top .tooltip-arrow {
	border-top-color: #FFFFFF;
}

.tooltip-bottom .tooltip-arrow-outer {
	border-bottom-color: #D3D3D3;
}

.tooltip-bottom .tooltip-arrow {
	border-bottom-color: #FFFFFF;
}
</style>
<script src="/statics/front/js/jquery.min.js"></script>
<script type="text/javascript" src="/editor/ckeditor362/ckeditor.js"></script>
<script type="text/javascript"
	src="/adminthemes/new/js/jquery-form-2.33.js"></script>
<script type="text/javascript" src="/statics/js/area_sql.js"></script>
<link rel="stylesheet" type="text/css"
	href="/adminthemes/new/js/easy-ui/themes/gray/easyui.css" />
<link rel="stylesheet" type="text/css"
	href="/adminthemes/new/js/easy-ui/themes/icon.css" />
<script type="text/javascript"
	src="/adminthemes/new/js/easy-ui/jquery.easyui.min.js"></script>
<script type="text/javascript"
	src="/adminthemes/new/js/easy-ui/easyui-lang-zh_CN.js"></script>
<script type="text/javascript"
	src="/adminthemes/new/js/jquery.blockUI.js"></script>
<script type="text/javascript"
	src="/adminthemes/new/js/jquery.loading.js"></script>
<link href="/adminthemes/new/css/style.css" rel="stylesheet"
	type="text/css" />
<script type="text/javascript" src="/adminthemes/js/BooCu.js"></script>
<script type="text/javascript"
	src="/adminthemes/new/js/ajaxupload.3.9.js"></script>
<script type="text/javascript" src="/frontthemes/js/easyuiUtil.js"></script>
</head>
<body>
	<!--top-->
	[#include '/template/front/include/header.html' /]
	<!--./top-->
	<!--loading-->
	<div class="listloadingd" id="indexLoading"></div>
	<!--./loading-->
	<div class="indexContent">
		<!--content-->
		<div id="w1"></div>
		<div id="w3" style="display: none;">
			<div id="w" class="easyui-window" title="提  示"
				data-options="closed:true,resizable:false,minimizable:false,maximizable:false,modal:true,"
				style="width: 320px; height: 220px; padding: 5px; background: #3a93d4;">
				<div class="easyui-layout" data-options="fit:true">
					<div data-options="region:'center'"
						style="padding: 10px; background: #fff;">
						您的账号信息不全或者账号正在审核，暂时不能发布信息，请完善资料后等待审核!
						<p style="padding-top: 80px; margin-left: 110px;">
							<a class="easyui-linkbutton" href="javascript:void(0)"
								onclick="window_submit()" style="width: 80px">确 认</a>
						</p>
					</div>
				</div>
			</div>
			<div id="w2" class="easyui-window" title="提  示"
				data-options="closed:true,resizable:false,minimizable:false,maximizable:false"
				style="width: 320px; height: 220px; padding: 5px; background: #3a93d4;">
				<div class="easyui-layout" data-options="fit:true">
					<div data-options="region:'center'"
						style="padding: 10px; background: #fff">
						您的账号未激活，请先登录注册邮箱激活，如果您是手机快捷注册用户，请在右下角对话框联系管理员给您审核激活
						<p style="padding-top: 105px; margin-left: 110px;">
							<a class="easyui-linkbutton" href="javascript:void(0)"
								onclick="window_close()" style="width: 80px">确 认</a>
						</p>
					</div>
				</div>
			</div>
		</div>
		<div class="main userd">
			<div class="umaintitd">
				当前位置：<a href="/" style="text-decoration: none;">首页</a> &gt; <a
					href="/user/user" style="text-decoration: none;">会员中心 </a>&gt; <a
					href="javascript:void;" style="text-decoration: none;"><span>产品信息管理</span></a>
			</div>
			<!--usernav-->
			[#include '/template/front/include/usernav.html' /]
			<!--./usernav-->

			<!--umainr-->
			<div class="umainr">
				<div class="umainrtitd">
					<span>站内信管理</span>
				</div>

				<!--uprod-->
				<div class="uprod">
					<div class="upronavd">
						<ul>
							<li class="${(appr == 1)?string('on','')}"><a
								href="javascript:void(0);">收件箱（${page.total}）</a></li>
							<li class="${(appr == 2)?string('on','')}"><a
								href="javascript:void(0);">发件箱（${page1.total}）</a></li>
						</ul>
						<div class="addprod">
							<a href="javascript:void(0);" s_id="1" onclick="append1(1);">写信</a>
						</div>
					</div>
					<!--./upronavd-->
					<div class="uprotabd" style="${(appr == 1)?string('','display:none')}">
						<form name="uosearchForm" id="uosearchForm" method="post"
							action="toMessageList.jspx?type=1">
							<input name="pageNum" hidden="true">
							<div style="margin: 10px; text-align: center;">
								<input type="text" name="keyword" id="txtKey" class="txt"
									placeholder="请输入搜索关键字"> <a href="javascript:;"
									class="fb" onclick="javascript:$('#uosearchForm').submit();">消息搜索</a>
							</div>
						</form>
						<table width="100%" cellspacing="0" class="uprotab" id="uprotabd">
							<tr>
								<th width="4%">&nbsp;</th>
								<th width="35%">内容</th>
								<th width="10%">发件人</th>
								<th width="20%">状态</th>
								<th width="20%">发送时间</th>
								<th width="15%">操作</th>
							</tr>
							[#list page.cont as item]
							<tr>
								<td><input type="checkbox" name="ckId" id="ckId"
									value="${item.id}"></td>
								<td class="l"><a class="tit" href="#"
									onclick="append2(${item.id});">[#if
										item.messageEntity.message_context.length()>20]
										${item.messageEntity.message_context?substring(0,20)} [#else]
										${item.messageEntity.message_context} [/#if]</a></td>
								<td>${item.sendEntity.username}</td>
								<td>[#if item.state==0]未读[#else]已读[/#if]</td>
								<td>${item.createDate?string("yyyy-MM-dd")}</td>
								<td><a class="tit" href="#" onclick="append2(${item.id});">查看</a>&nbsp;&nbsp;<a
									class="tit" href="#" onclick="append3(${item.id});">回复</a></td>
							</tr>
							[/#list]
						</table>
						<!--uexepaged-->
						<div class="uexepaged">
							<div class="uexed">
								<p>
									<label> <input type="checkbox" name="ckAll" id="ckAll"
										class="ckall"> 全选
									</label>
								</p>
								<ul>
									<li><a href="javascript:;" onclick="Del()">永久删除</a></li>
								</ul>
							</div>
							<!--./uexed-->
							<div class="upagfr">
								<!--pagd-->
								<div class="upagd" id="upagd">
									[#if (page.pageNumber-1) gte 1]<a class="prev"
										href="javascript:void(0);" s_val="${page.pageNumber-1}">上一页</a>[/#if]
									[#list -2..2 as item] [#if (page.pageNumber+item) gte 1 &
									(page.pageNumber+item) lte page.totalPages]<a
										href="javascript:void(0);" s_val="${page.pageNumber+item}"
										class="${(item ==0)?string('on','')}">${page.pageNumber+item}</a>[/#if]
									[/#list] [#if page.pageNumber lt page.totalPages]<a
										class="next" href="javascript:void(0);"
										s_val="${page.pageNumber+1}">下一页</a>[/#if]<span class="tnum">共${page.totalPages}页</span><span
										class="txtd">到 <input type="text" name="txtPnum"
										id="txtPnum" class="txt"> 页
									</span><input type="button" class="btn" id="btn" href="javascript:;"
										value="确认" />
								</div>
								<!--./pagd-->
							</div>
							<!--./uexepaged-->
						</div>
					</div>
					<div class="uprotabd" style="${(appr == 2)?string('','display:none')}">
						<table width="100%" cellspacing="0" class="uprotab" id="uprotabd1">
							<tr>
								<th width="4%">&nbsp;</th>
								<th width="13%">标题</th>
								<th width="48%">内容</th>
								<th width="13%">收件人</th>
								<th width="20%">发送时间</th>
							</tr>
							[#list page1.cont as item]
							<tr>
								<td><input type="checkbox" name="ckId" id="ckId"
									value="${item.id}"></td>
								<td class="l"><a class="tit" href="#" onclick="append4(${item.id});">${item.messageEntity.message_title}</a></td>
								<td class="t">[#if
									item.messageEntity.message_context.length()>20]${item.messageEntity.message_context?substring(0,20)}[#else]
									${item.messageEntity.message_context} [/#if]</td>
								<td>${item.recEntity.username}</td>
								<td>${item.createDate?string("yyyy-MM-dd")}</td>
							</tr>
							[/#list]
						</table>
						<!--uexepaged-->
						<div class="uexepaged">
							<div class="uexed">
								<p>
									<label> <input type="checkbox" name="ckAll" id="ckAll"
										class="ckall"> 全选
									</label>
								</p>
								<ul>
									<li><a href="javascript:;" onclick="Del1()">永久删除</a></li>
								</ul>
							</div>
							<!--./uexed-->

							<div class="upagfr">
								<!--pagd-->
								<div class="upagd" id="upagd1">
									[#if (page1.pageNumber-1) gte 1]<a class="prev"
										href="javascript:void(0);" s_val="${page1.pageNumber-1}">上一页</a>[/#if]
									[#list -2..2 as item] [#if (page1.pageNumber+item) gte 1 &
									(page1.pageNumber+item) lte page1.totalPages]<a
										href="javascript:void(0);" s_val="${page1.pageNumber+item}"
										class="${(item ==0)?string('on','')}">${page1.pageNumber+item}</a>[/#if]
									[/#list] [#if page1.pageNumber lt page1.totalPages]<a
										class="next" href="javascript:void(0);"
										s_val="${page1.pageNumber+1}">下一页</a>[/#if]<span class="tnum">共${page1.totalPages}页</span><span
										class="txtd">到 <input type="text" name="txtPnum1"
										id="txtPnum1" class="txt"> 页
									</span><input type="button" class="btn" id="btn1" href="javascript:;"
										value="确认" />
								</div>
								<!--./pagd-->
							</div>
							<!--./uexepaged-->
						</div>
					</div>

				</div>
				<!--./uprod-->
			</div>
			<!--./umainr-->
		</div>
		<!--./content-->
		<div id="divdia" style="display: none;"></div>
	</div>
	<!--foot-->
	[#include '/template/front/include/footer2.html' /]
	<!--./foot-->

	<script>
		//给点击的加上链接样式 
$(function(){
	 //$ (".uprod").find (".upronavd").find ("li").eq (0).addClass ("on");
	  $("#message").hide();
})
      
        //选项卡
        $ (".upronavd li").click (function ()
        {
	        $ (".upronavd li").removeClass ("on");
	        $ (this).addClass ("on");
	        $ (".uprotabd").hide ();
	        $ (".uprotabd").eq ($ (this).index ()).fadeIn (200);
        });
        
        //全选
        $ (".ckall").click (
                function ()
                {
	                if ($ (this).attr ("checked"))
	                {
		                $ (this).parent ().parent ().parent ().parent ().parent ().find ("input[name='ckId']").attr (
		                        "checked", "checked");
	                }
	                else
	                {
		                $ (this).parent ().parent ().parent ().parent ().parent ().find ("input[name='ckId']")
		                        .removeAttr ("checked");
	                }
                });
        
        //审核分页
        $ ("#upagd").find ("a").click (function ()
        {
	        window.location.href = "/memberMessage/toMessageList.jspx?appr=1&pageNum=" + $ (this).attr ("s_val");
        });
        
        //待审核分页
        $ ("#upagd1").find ("a").click (function ()
        {
	        window.location.href = "/memberMessage/toMessageList.jspx?appr=2&pageNum=" + $ (this).attr ("s_val");
        });
        
        	//shoujianxiang
        $ ("#upagd").find ("#btn").click (function ()
        {
	        var txt = $ ("#txtPnum").val ();
	        var a1 = ${ page.totalPages};
	        if (txt > a1 || txt < 1)
	        {
		        return;
	        }
	        window.location.href = "/memberMessage/toMessageList.jspx?appr=1&pageNum=" + txt ;
        });
        
        //发件箱
        $ ("#upagd1").find ("#btn1").click (function ()
        {
	        var txt = $ ("#txtPnum1").val ();
	        var a1 = ${page1.totalPages};
	        if (txt > a1 || txt < 1)
	        {
		        return;
	        }
	        window.location.href = "/memberMessage/toMessageList.jspx?appr=2&pageNum=" + txt;
        });
        
        //审核永久删除
        function Del ()
        {
	        var rows = $ ("#uprotabd").find ("input:checkbox[checked=checked]");
	        var rowsArr = [];
	        rows.each (function ()
	        {
		        rowsArr.push ($ (this).val ());
	        });
	        if (rowsArr.length ==0)
	        {
		        alert ("请选择要删除的短消息");
		        return;
	        }
	        if (!confirm("确认要删除该消息"))
	        {
		        return;
	        }
	        $.ajax (
	        {
	            data :
	            {
	            	messageId : rowsArr,type:1
	            },
	            traditional:true,
	            type : "post",
	            url : "/memberMessage/delMessage.jspx",
	            success : function (result)
	            {
		            var rows = $ ("#uprotabd").find ("input:checkbox[checked=checked]").closest ('tr');
		            if (result.result == 1)
		            {
			            alert ("删除短消息成功");
			            window.location.href = "/memberMessage/toMessageList.jspx";
		            }
	            },
	            error : function (e)
	            {
		            alert ("出现错误, 请重试");
	            }
	        });
        }
        function Del1 ()
        {
	        var rows = $ ("#uprotabd1").find ("input:checkbox[checked=checked]");
	        var rowsArr = [];
	        rows.each (function ()
	        {
		        rowsArr.push ($ (this).val ());
	        });
	        if (rowsArr.length < 1)
	        {
		        alert ("请选择要删除的短消息");
		        return;
	        }
	        if (!confirm("确认要删除该消息"))
	        {
		        return;
	        }
	        $.ajax (
	        {
	            data :
	            {
	            	messageId : rowsArr,type:2
	            },
	            traditional:true,
	            type : "post",
	            url : "/memberMessage/delMessage.jspx",
	            success : function (result)
	            {
		            var rows = $ ("#uprotabd1").find ("input:checkbox[checked=checked]").closest ('tr');
		            if (result.result == 1)
		            {
			            alert ("删除短消息成功");
			            window.location.href = "/memberMessage/toMessageList.jspx";
		            }
	            },
	            error : function (e)
	            {
		            alert ("出现错误, 请重试");
	            }
	        });
        }

    	function append1(id) {
    		var map = {}; // Map map = new HashMap();
    		if (id != null) {
    			map["href"] = "/memberMessage/sendMessage.jspx";
    			map["formId"] = "#editForm";
    			map["url"] = "/memberMessage/doSendMessage.jspx";
    			map["title"] = "  写信";
    			map["loadshow"] = "正在提交......";
    			map["class"] = "#selectMessage";
    		}
    		map["divDialog"] = "#divdia";
    		map["gridreload"] = ".uprod";
    		addDialog(map);
    	}
    	function append3(id) {
    		var map = {}; // Map map = new HashMap();
    		if (id != null) {
    			map["href"] = "/memberMessage/ReplyMessage.jspx?messageId="+id;
    			map["formId"] = "#editForm";
    			map["url"] = "/memberMessage/doReplyMessage.jspx";
    			map["title"] = "  回复短消息";
    			map["loadshow"] = "正在提交......";
    		}
    		map["divDialog"] = "#divdia";
    		map["gridreload"] = ".uprod";
    		addDialog(map);
    	}
        function addDialog(map) {
    		$(map["divDialog"]).show();
    		$(map["divDialog"]).dialog({
    			title : map["title"],
    			width : 600,
    			height : 500,
    			closed : false,
    			cache : false,
    			href : map["href"],
    			buttons : [ {
    				text : '保存',
    				handler : function() {
    					var savebtn = $(this);
    	　　				var disabled=savebtn.hasClass("l-btn-disabled");
    	　　				if(!disabled){
    						 submitForm(map,savebtn);
    					}
    				}
    			}, {
    				text : '清空',
    				handler : function() {
    					clearForm(map);
    				}
    			} ]
    		});
    		
    	}

    	function append2(id) {
    		var map = {}; // Map map = new HashMap();
    		if (id != null) {
    			map["href"] = "/memberMessage/findMessage.jspx?messageId="+id+"&type=1";
    			map["formId"] = "#editForm";
    			map["url"] = "/memberMessage/toMessageList.jspx";
    			map["title"] = "  查看短信息";
    			map["loadshow"] = "正在获取数据......";
    		}
    		map["divDialog"] = "#divdia";
    		map["gridreload"] = ".uprod";
    		addDialog1(map);
    		
    	}
    	function append4(id) {
    		var map = {}; // Map map = new HashMap();
    		if (id != null) {
    			map["href"] = "/memberMessage/findMessage.jspx?messageId="+id+"&type=2";
    			map["formId"] = "#editForm";
    			map["url"] = "/memberMessage/toMessageList.jspx";
    			map["title"] = "  查看短信息";
    			map["loadshow"] = "正在获取数据......";
    		}
    		map["divDialog"] = "#divdia";
    		map["gridreload"] = ".uprod";
    		addDialog1(map);
    		
    	}
        function addDialog1(map) {
    		$(map["divDialog"]).show();
    		$(map["divDialog"]).dialog({
    			title : map["title"],
    			width : 500,
    			height : 400,
    			closed : false,
    			cache : false,
    			href : map["href"],buttons : [ {
    				text : '返回',
    				handler : function() {
    					var savebtn = $(this);
    	　　				var disabled=savebtn.hasClass("l-btn-disabled");
    	　　				if(!disabled){
    	　　					location.href='/memberMessage/toMessageList.jspx'
    					}
    				}
    			}]
    		});
    	}
        
    	function submitForm(map) {
    		var formflag = $(map["formId"]).form().form('validate');
    		if (formflag) {
    			$.Loading.show(map["loadshow"]);
    			var options = {
    				url : map["url"],
    				type : "POST",
    				dataType : 'json',
    				success : function(result) {
    					$.Loading.show(result.cont);
    					$.Loading.hide();
						location.href='/memberMessage/toMessageList.jspx'
    				},
    				error : function(e) {
    					alert("出现错误 ，请重试");
    				}
    			};
    			$(map["formId"]).ajaxSubmit(options);  
    		}
    	}
   
     
	</script>
</body>
</html>
