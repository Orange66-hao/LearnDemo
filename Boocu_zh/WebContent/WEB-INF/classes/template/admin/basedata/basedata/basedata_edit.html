
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=9" > </meta>
<title>嘉捷惠-后台管理</title>
<script type="text/javascript" src="/adminthemes/new/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/jquery-form-2.33.js"></script>

    <link rel="stylesheet" type="text/css" href="/adminthemes/new/js/easyui-1.6.7/themes/gray/easyui.css"/>
    <link rel="stylesheet" type="text/css" href="/adminthemes/new/js/easyui-1.6.7/themes/icon.css"/>
    <script type="text/javascript" src="/adminthemes/new/js/easyui-1.6.7/jquery.easyui.min.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/easy-ui/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/jquery.blockUI.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/jquery.loading.js"></script>
<link href="/adminthemes/new/css/main.css" rel="stylesheet" type="text/css" />
<link href="/adminthemes/new/css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/adminthemes/new/js/ajaxupload.3.9.js"></script>
<script type="text/javascript" src="/editor/ckeditor362/ckeditor.js"></script>
</head>
<body>
<div class="main" style="background-color: white;">
	<div class="easyui-panel" style="border-style: none;">
		<form id="editForm" method="post" class="validate">
			<table>
				<tr style="display:none">
					<th>id</th>
					<td><input class="input_text easyui-validatebox" type="text" 
						name="id" data-options="required:true" value="${item.id}" ></input>
					</td>
				</tr>
				<tr>
					<th>品牌</th>
					<td><input class="easyui-combobox" data-options="url:'/admin/basedata/brand/get_brand_names.jspx',valueField:'id',textField:'text', width:307,[#if item.productBrandEntity??]value:'${item.productBrandEntity.id}'[/#if]" style="height:30px;" name="brandId" >
					</td>	
				</tr>
				<tr>
					<th>型号</th>
					<td><input class="input_text easyui-validatebox" type="text" value="${item.proNo}"
						name="proNo" data-options="required:true" ></input>
					</td>
				</tr>
				<tr>
					<th>商品名称</th>
					<td><input class="input_text" type="text" value="${item.proName}"
						name="proName" id="proName"></input>
					</td>
				</tr>
				<tr>
					<th>商品英文名称</th>
					<td><input class="input_text" type="text" value="${item.proNameEn}"
						name="proNameEn"  ></input>
					</td>
				</tr>
				 <tr>
					<th>设备类目</th>
					<td ><select style="width:307px;height:30px;" class="easyui-combotree" url="/admin/basedata/productclass/combotreeData.json" name="proClassId" id="proClassId" />
					</td>
				</tr>
				<tr>
					<th>产品分类</th>
					<td style="display:inline-block" width="308"><select style="width:307px;height:30px;" multiple class="easyui-combotree" url="/admin/industyClass/combotreeData.json" name="indClassId" id="indClassId" />
                    </td>
                    <td style="display:inline-block" style="float: left"><a href="#" class="easyui-linkbutton" onclick="refresh()">刷</a></td>
				</tr>
				<tr style="display:none;">
					<th>行业分类字符串</th>
					<td ><input class="input_text" type="text" value="${item.industryClass}" name="industryClass" id="industryClass"></input>
					</td>
				</tr>
				  <tr>
					<th>商品图片</th>
					<td><input id="exap" type="hidden" name="image" value="${item.image}" />
						<img class="picImg" id="img" style="width:80px;height:80px" src="${item.image}" />
						<input class="button blueButton" type="button" id="btnPreViewImg" value="上传图片" />
					</td>
				</tr>
				<tr>
					<th>产品描述</th>
					<td ><textarea id="proSynopsis" name="proSynopsis" class="ckeditor" >${item.proSynopsis}</textarea>
					</td>
				</tr>
				<tr>
					<th>英文描述</th>
					<td ><textarea id="proSynopsisEn" name="proSynopsisEn" class="ckeditor" >${item.proSynopsisEn}</textarea>
					</td>
				</tr>
				<tr>
					<th>详细信息</th>
					<td ><textarea id="proContent" name="proContent" class="ckeditor" >${item.proContent}</textarea>
					</td>
				</tr>
				<tr>
					<th>英文详细信息</th>
					<td ><textarea id="proContentEn" name="proContentEn" class="ckeditor" >${item.proContentEn}</textarea>
					</td>
				</tr>
			</table>
		</form>
	</div>
	<div class="buttonWrap fixed">
		<a id="searchAdvance" class="easyui-linkbutton" onclick="submitForm()"
			href="javascript:;">修改</a>
	</div>
</div>
<script>
	initAjaxUploadImg('btnPreViewImg','exap','img');
	function loadSec(ele){
		var value = $(ele).attr("s_value");
		$(ele).combobox("select",value);
	}
	$(function () {
	    CKEDITOR.replace('proSynopsis', { height: '240px', width: '600px' });
	    CKEDITOR.replace('proSynopsisEn', { height: '240px', width: '600px' });
	    CKEDITOR.replace('proContent', { height: '240px', width: '600px' });
	    CKEDITOR.replace('proContentEn', { height: '240px', width: '600px' });
	    $("#proClassId").combotree({
            editable:true,
            onBeforeSelect:function (node) {
	    	    //防止选中父节点   只能选子节点
                var tree = $('#proClassId').combotree('tree');// get the tree object
                if (!$("#proClassId").combotree("tree").tree('isLeaf', node.target)) {
                    return false;
                }
            }
	    });
        $("#indClassId").combotree({
            onlyLeafCheck:true,
			onLoadSuccess:function(){//回显数据
            $("#proClassId").combotree('setValue', "${item.productclass.id}");
            var str="${item.industryClass}";
            if(str!=null&&str.length>0){
                var list=str.split(",")
                for(var i=0;i<list.length;i++){
                    var node=$("#indClassId").combotree('tree').tree('find',list[i]);
                    if(node){
                        $("#indClassId").combotree('tree').tree('check',node.target)
                    }
                }
            }
        }
    });

	});
	function refresh() {
        $.ajax({
            url:"/admin/industyClass/expandByYiqiId.jspx",
            type:"post",
            data:{"yiqiId": $("#proClassId").combotree('getValue')},
            success:function (data) {
                var arr=[];
                $.each(data,function (index,e) {
                    var t = $('#indClassId').combotree('tree');	// get the tree object
                    // find a node and then select it
                    var node = t.tree('find',e.id);
                    arr.push(e.id)
                })
                $('#indClassId').combotree('setValues',arr)
            }
        })
    }
	$("#isUnit").find("[name=isUnit]").change(function(){
		if($(this).val()==0){
			$("#proUnit").hide();
			$("#proUnit").prev().hide();
		}else{
			$("#proUnit").show();
			$("#proUnit").prev().show();
		}
	});
	function submitForm(){

		var formflag = $("#editForm").form().form('validate');
		if (formflag) {
			for(instance in CKEDITOR.instances){
				CKEDITOR.instances[instance].updateElement();
			}
			$.Loading.show("正在修改......");
			var options = {
				url : "/admin/basedata/basedata/save_edit_basedata.jspx?ajax=yes",
				type : "POST",
				dataType : 'json',
				success : function(result) {
					if(result.result==1){
						$.Loading.success(result.message);
					}
					if(result.result==0){ 
						$.Loading.error(result.message);
					}
					$.Loading.hide();
                    parent.CloseTabByTitle("${item.proName}-信息修改")
                    $("#memberdata").datagrid('reload');
				},
				error : function(e) {
					alert("出现错误 ，请重试");
				}
			};
			$("#editForm").ajaxSubmit(options);
		}
	}
</script>
</body>