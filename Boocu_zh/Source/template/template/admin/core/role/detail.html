<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=9" > </meta>
<title>示例商城-后台管理</title>
<style type="text/css">
body{
	margin:0px;
	font-family:Arial,"宋体",Verdana,sans-serif;
	font-size:12px;
}
html,body {padding: 0;margin: 0; overflow-x:hidden; overflow-y:auto;}
dl,dd{margin:0px}
ul{
	list-style-type:none;
	margin:0px;
	padding:0px;
}
</style>

<script type="text/javascript" src="/adminthemes/new/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/jquery-form-2.33.js"></script>

<link rel="stylesheet" type="text/css" href="/adminthemes/new/js/easy-ui/themes/gray/easyui.css"/>    
<link rel="stylesheet" type="text/css" href="/adminthemes/new/js/easy-ui/themes/icon.css"/>  
<script type="text/javascript" src="/adminthemes/new/js/easy-ui/jquery.easyui.min.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/easy-ui/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/jquery.blockUI.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/jquery.loading.js"></script>
<link href="/adminthemes/new/css/main.css" rel="stylesheet" type="text/css" />
<link href="/adminthemes/new/css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/adminthemes/js/BooCu.js"></script>
</head>
<body>

<div class="main" style="background-color: white;">
	<form id="editForm">
		<table width="98%" border="0" cellspacing="0" cellpadding="8">
			<tr>
				<th>角色名称：</th>
				<td><input class="input_text easyui-validatebox" type="text"
					id="name" name="name" data-options="required:true" value="${entity.name}"></input>
				</td>
				<th>角色描述：</th>
				<td><input class="input_text easyui-validatebox"
					type="text" name="description" data-options="required:true" value="${entity.description}"></input>
				</td>
			</tr>
		 
		</table>
		
			<input type="hidden" name="id"
			value="${entity.id}">
	</form>

	<div style="text-align: center;">
		<a href="javascript:void(0)" class="button blueButton"
			onclick="editForm()">保存修改</a>
	</div>
	
</div>


<div id="loading"></div>
<div class="main">
	<form id="memberform">
		<div id="tb" style="height: auto">
			 
			<span style="float: right;"> 
				<span id="simpleSearch">
					<input id="searchKeyword" class="input_text" type="text" value="" size="30" style="width: 300px;"
					placeholder="请输入资源名称，资源值" name="searchKeyWord"> 
					<a href="javascript:void(0)" class="easyui-linkbutton" 
					data-options="plain:true" onclick="searchMember()">搜索</a>
				</span>
			
			</span>
		</div>
		
		<div class="clear height10"></div>
		<div class="shadowBoxWhite tableDiv">
		<table class="easyui-datagrid"
			data-options="url:'/admin/role/authority/data.json?role_id=${entity.id}',pageList: [20,50],pageSize:20,fitColumns:'true'"
			pagination="true" id="data" sortName="id" sortOrder="desc" >
			<thead>
				<tr>
					<th data-options="field:'id'" formatter="formatOperation">是否勾选</th>
					<th data-options="field:'name',width:200">权限名称</th>
					<th data-options="field:'description',width:500">权限描述</th> 
					<th data-options="field:'create_date',width:120,sortable:'true'"
						formatter="formatLastlogin">创建日期</th> 
				 
				</tr>
			</thead>
		</table>
		</div>
	</form>
	<div id="divdia" style="display: none;"></div>

</div>


<script>

	function editForm() {
		var formflag= $("#editForm").form().form('validate');
			if(formflag){
				$.Loading.show("正在修改......");
				var options = {
						url :"/admin/role/saveEdit.jspx?ajax=yes",
						type : "POST",
						dataType : 'json',
						success : function(result) {
							if(result.result==1){
								$.Loading.success(result.message);
							}
							if(result.result==0){ 
								$.Loading.error(result.message);
							}
							$.Loading.hide();
						},
						error : function(e) {
							alert("出现错误 ，请重试");
						}
					};
				$('#editForm').ajaxSubmit(options);
			}		
	}

	function formatLastlogin(value, row, index) {
		return getFormatDateByLong(value, "yyyy-MM-dd hh:mm:ss");
	}
	
	function formatOperation(value, row, index) {
		var val = "<input type='checkbox'  id='id' value='"+row.id+"' "+row.checked+" onclick='CheckAuthority(\"${entity.id}\",\""+row.id+"\")' >";
		return val;
	}
	
	function CheckAuthority(role_id,auth_id){
		$.ajax({
			 type: "GET",
			 url: "/admin/role/authority/check.json?ajax=yes",
			 data:  {"role_id":role_id,"auth_id":auth_id},
			 dataType:'json',
			 success: function(result){
				 if(result.result==0){
					  
				 }else{
					 
				 }
		     },
		     error:function(){
				
			 }
		}); 
	}

	function searchMember(){
		 
		var keyword = $("#searchKeyword").val();
		var name = $("#name").val();
		$("#data").datagrid('load', {
		 
			 keyword:keyword,
		 
			 name:name,
			
			 page:1
	    });
	}
	
</script>

</body>
</html>