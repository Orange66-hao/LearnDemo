
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=9">
</meta>
<title>云图商城-后台管理</title>
<style type="text/css">
body {
	margin: 0px;
	font-family: Arial, "宋体", Verdana, sans-serif;
	font-size: 12px;
}

html, body {
	padding: 0;
	margin: 0;
	overflow-x: hidden;
	overflow-y: auto;
}

dl, dd {
	margin: 0px
}

ul {
	list-style-type: none;
	margin: 0px;
	padding: 0px;
}

.prosortd {
	clear: both;
	margin-left: 10px;
	overflow: hidden;
	zoom: 1;
}

.prosortd p {
	float: left;
	padding-right: 160px;
	font-size: 14px;
}
</style>

<script type="text/javascript"
	src="/adminthemes/new/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript"
	src="/adminthemes/new/js/jquery-form-2.33.js"></script>
<script type="text/javascript" src="/statics/js/area_sql.js"></script>
<link rel="stylesheet" type="text/css"
	href="/adminthemes/new/js/easy-ui/themes/gray/easyui.css" />
<link rel="stylesheet" type="text/css"
	href="/adminthemes/new/js/easy-ui/themes/icon.css" />
<script type="text/javascript"
	src="/adminthemes/new/js/easy-ui/jquery.easyui.min.js"></script>
<script type="text/javascript"
	src="/adminthemes/new/js/easy-ui/easyui-lang-zh_CN.js"></script>
<script type="text/javascript"
	src="/adminthemes/new/js/jquery.blockUI.js"></script>
<script type="text/javascript"
	src="/adminthemes/new/js/jquery.loading.js"></script>
<link href="/adminthemes/new/css/main.css" rel="stylesheet"
	type="text/css" />
<link href="/adminthemes/new/css/style.css" rel="stylesheet"
	type="text/css" />
<script type="text/javascript" src="/adminthemes/js/BooCu.js"></script>
<script type="text/javascript"
	src="/adminthemes/new/js/ajaxupload.3.9.js"></script>
<script type="text/javascript" src="/frontthemes/js/easyuiUtil.js"></script>
<script type="text/javascript" src="/editor/ckeditor362/ckeditor.js"></script>
[#include '/template/admin/include/common.html']

</head>
<body>

	<div id="bookinfo" style="display: none;"></div>
	<div id="loading"></div>
	<div class="main">
		<form id="memberform">
			<div title="筛选条件" data-options="selected:true">
				<div class="prosortd">
					<p>新闻类别</p>
					<p>
						<input type="radio" s_val="1" name="state"> 中文新闻
					</p>
					<p>
						<input type="radio" s_val="2" name="state"> 英文新闻
					</p>
				</div>
			</div>
			<div id="tb" style="height: auto">
				<a href="javascript:append()" class="button blueButton"
					data-options="iconCls:'icon-add',plain:true" onclick="append(0)">添加</a>
				<a href="javascript:void(0)" class="easyui-linkbutton"
					data-options="plain:true" onclick="del()">删除</a> <span
					style="float: right;"> <span id="simpleSearch"> <input
						id="searchKeyword" class="input_text" type="text" value=""
						size="30" style="width: 300px;" placeholder="请输入新闻标题"
						name="searchKeyWord"> <a href="javascript:void(0)"
						class="easyui-linkbutton" data-options="plain:true"
						onclick="searchAdvertBase()">搜索</a>
				</span>
				</span>
			</div>

			<div class="clear height10"></div>
			<div class="shadowBoxWhite tableDiv">
				<table class="easyui-datagrid"
					data-options="url:'/admin/index/news/data.json',pageList: [5,10,15,20],pageSize:10,fitColumns:'true'"
					pagination="true" id="memberdata" sortName="id" sortOrder="desc">
					<thead>
						<tr>
							<th data-options="field:'id',checkbox:true"></th>
							<th
								data-options="field:'title',width:$(this).width()*0.1,sortable:'true'">新闻标题</th>
							<th
								data-options="field:'newstype',width:$(this).width()*0.1,sortable:'true'"
								formatter="newstypeFormatter">新闻类型</th>
							<th
								data-options="field:'newsareaId',width:$(this).width()*0.1,sortable:'true'">新闻区域</th>
							<th
								data-options="field:'creatuser',width:$(this).width()*0.1,sortable:'true'">创建人</th>
							<th
								data-options="field:'updateuser',width:$(this).width()*0.1,sortable:'true'">修改人</th>
							<th
								data-options="field:'isrecommend',width:$(this).width()*0.1,sortable:'true'">是否推荐</th>
							<th
								data-options="field:'sort',width:$(this).width()*0.1,sortable:'true'">排序</th>
							<th
								data-options="field:'action',width:$(this).width()*0.1,align:'center'"
								formatter="formatOperation">操作</th>
						</tr>
					</thead>
				</table>
			</div>
		</form>
		<div id="divdia" style="display: none;"></div>

	</div>
	<script type="text/javascript">


	function submitForm(map) {
		var formflag = $(map["formId"]).form().form('validate');
		if (formflag) {
			$.Loading.show(map["loadshow"]);
			var options = {
				url : map["url"],
				type : "POST",
				dataType : 'json',
				success : function(result) {
					if (result.result == 1) {
						$.Loading.show(result.message);
						$(map["divDialog"]).dialog('close');
						$(map["gridreload"]).datagrid('reload');
					}
					if (result.result == 0) {
						$.Loading.error(result.message);
					}
					$.Loading.hide();
				},
				error : function(e) {
					alert("出现错误 ，请重试");
				}
			};
			$(map["formId"]).ajaxSubmit(options);
		}
	}

	$(".prosortd").find("input[type='radio']").change(function(){
		searchAdvertBase();
	});
	
	function append(id) {
		var state = $("input[name='state']:checked").attr("s_val");
		var news ="news";
		if(state=='2'){
			news="newsEn";
		}
		var map = {}; // Map map = new HashMap();
		if (!id) {
			map["href"] = "/admin/index/"+news+"/add_news.jspx";
			map["formId"] = "#addForm";
			map["url"] = "/admin/index/"+news+"/save_news.jspx?ajax=yes";
			map["title"] = "添加新闻信息";
			map["loadshow"] = "正在添加......";
		} else {
			map["href"] = "/admin/index/"+news+"/edit_news.jspx?id=" + id;
			map["formId"] = "#editForm";
			map["url"] = "/admin/index/"+news+"/save_edit_news.jspx?ajax=yes";
			map["title"] = "修改新闻信息";
			map["loadshow"] = "正在修改......";
		}
		map["divDialog"] = "#divdia";
		map["gridreload"] = "#memberdata";
		addDialog(map);
	}
	
	function addDialog(map) {
		$(map["divDialog"]).show();
		$(map["divDialog"]).dialog({
			title : map["title"],
			width : 800,
			height : 750,
			closed : false,
			cache : false,
			href : map["href"],
			modal : true,
			onLoad:function(){
				var instance = CKEDITOR.instances["content"];
				if (instance) { CKEDITOR.remove(instance); }
				//$("#content").ckeditor();
				CKEDITOR.replace('content',{height:'240px', width:'600px'});
			},
			buttons : [ {
				text : '保存',
				iconCls : 'icon-ok',
				handler : function() {
					for(instance in CKEDITOR.instances){
						CKEDITOR.instances[instance].updateElement();
					}
					var savebtn = $(this);
	　　				var disabled=savebtn.hasClass("l-btn-disabled");
	　　				if(!disabled){
						 submitForm(map,savebtn);
					}
				}
			}, {
				text : '清空',
				handler : function() {
					clearForm(map);
				}
			} ]
		});
	}
	
	function clearForm(map) {
		$(map["formId"]).form('clear');
	}
	
	function formatOperation(value, row, index) {
		var val = "<a class='edit' title='修改' href='javascript:void(0);' onclick='append("+row.id+")' ></a>";
		return val;
	}
	
	function del() {
		var rows = $('#memberdata').datagrid("getSelections");
		if (rows.length < 1) {
			$.Loading.error("请选择要删除的新闻");
			return;
		}
		if (!confirm("确认删除选中的该新闻？")) {
			return;
		}
		var options = {
			url : "/admin/index/news/delete_news.jspx?ajax=yes",
			type : "POST",
			dataType : 'json',
			success : function(result) {
				$.Loading.success(result.message);
				if (result.result == 1) {
					var rows = $('#memberdata').datagrid("getSelections");
					for ( var i = 0; i < rows.length; i++) {
						var index = $('#memberdata').datagrid('getRowIndex',
								rows[i]);
						$('#memberdata').datagrid('deleteRow', index);
					}
				}
			},
			error : function(e) {
				$.Loading.error("出现错误 ，请重试");
			}
		};
		$('#memberform').ajaxSubmit(options);
	}
	
	function newstypeFormatter(value,row,index){
		return 'enterprise' == value ? '企业新闻' :('industry' == value ? '行业新闻':'国际新闻');
	}
	
	function searchAdvertBase(){
		var state=$("input[name='state']:checked").attr("s_val");
		var keyword = $("#searchKeyword").val();
		var newurl = "/admin/index/news/data.json";
		if(state=='2'){
			var newurl="/admin/index/newsEn/data.json";
		}
		$('#memberdata').datagrid({
			  url : newurl
		});
		$("#memberdata").datagrid("load",{
			keyword:keyword,
			page:1
		});
	}
	
</script>
</body>
</html>