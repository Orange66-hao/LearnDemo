<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<div class="main" style="background-color: white;">
	<div class="easyui-panel" style="border-style: none;">
		<form id="addForm" method="post" class="validate">
			<table>
			<tr>
					<th>所属品牌</th>
					<td>
					<select style="width: 308px; height: 36px;"
										class="easyui-combobox"
										url="/admin/mcBrand/get_model_names.jspx" name="mc_brand"
										id="mc_brand" data-options="multiple:false,cascadeCheck:false,valueField:'id',textField:'text'" required="required"/> </select>
										
										</td>
										
										
					<td><span class="rr_model" style="color: red"></span></td>
				</tr>
			   <tr>
					<th>型号名</th>
					<td><input class="input_text easyui-validatebox" type="text" id="mm_name"
						name="name" data-options="required:true"></input>
					</td>
				</tr>
				<tr>
					<th>排序</th>
					<td><input class="input_text easyui-numberbox" type="text" 
						name="sort" id="mm_sort" data-options="required:true"></input>
					</td>
				</tr>
				<tr>
					<th>备注</th>
					<td><input class="input_text" type="text" id="mm_remark"
						name="remark"  ></input>
					</td>
				</tr>
			</table>
			<!-- 当从型号收集模块添加数据时，隐藏该按钮 -->
			<!-- <input type="button" id="model_yincang"  class="input_text2 easyui-validatebox"   value="添加品牌"  onclick="appendmcbrand()" style="left: 400px;top: 58px;position: absolute;"/> -->
		</form>
	</div>
</div>
<script type="text/javascript">
	if('${model_yincang}'){//当从型号收集模块新增时，隐藏新增上级数据按钮
		$("#model_yincang").hide();
	}
		/*
		新增品牌
		*/
		function submitFormmcbrand(map) {
		var data = {};
		data.mc_productclass=$("#mc_productclass").combobox('getValue');
		data.name=$("#mb_name").val();
		data.sort=$("#mb_sort").val();
		data.remark=$("#mb_remark").val();
		//var formflag = $(map["formId"]).form().form('validate');
		if (data.name != '' && data.sort != '') {
			$.Loading.show(map["loadshow"]);
			var options = {
				url : map["url"],
				type : "POST",
				dataType : 'json',
				data:data,
				success : function(result) {
					if (result.result == 1) {
						$.Loading.show(result.message);
						$(map["divDialog"]).dialog('close');
						//$(map["gridreload"]).datagrid('reload');
						$('#mc_brand').combotree('reload');//新增后，刷新树
					}
					if (result.result == 0) {
						$.Loading.error(result.message);
					}
					$.Loading.hide();
				},
				error : function(e) {
					alert("出现错误 ，请重试");
				}
			};
			console.log(data);
			$.ajax(options);
		}
		}
		
		
		function appendmcbrand(id) {
			var map = {}; // Map map = new HashMap();
			if (!id) {
				map["href"] = "/admin/mcBrand/add_mcBrand.jspx";
				map["formId"] = "#addForm";
				map["url"] = "/admin/mcBrand/doAdd_memberGrade.jspx?ajax=yes";
				map["title"] = "添加信息";
				map["loadshow"] = "正在添加......";
			} else {
				map["href"] = "/admin/mcBrand/edit_memberGrade.jspx?id=" + id;
				map["formId"] = "#editForm";
				map["url"] = "/admin/mcBrand/doEdit_memberGrade.jspx?ajax=yes";
				map["title"] = "修改信息";
				map["loadshow"] = "正修改......";
			}
			map["divDialog"] = "#divdia2";
			map["gridreload"] = "#dataList";
			addDialogmcbrand(map);
		}
		
		function addDialogmcbrand(map) {
		$(map["divDialog"]).show();
		$(map["divDialog"]).dialog({
			title : map["title"],
			width : 600,
			height : 300,
			closed : false,
			cache : false,
			href : map["href"],
			modal : true,
			buttons : [ {
				text : '保存',
				iconCls : 'icon-ok',
				handler : function() {
					for(instance in CKEDITOR.instances){
						CKEDITOR.instances[instance].updateElement();
					}
					var savebtn = $(this);
						var disabled=savebtn.hasClass("l-btn-disabled");
						if(!disabled){
						 submitFormmcbrand(map,savebtn);
					}
				}
			}, {
				text : '清空',
				handler : function() {
					clearForm(map);
				}
			} ]
		});
		}
</script>
