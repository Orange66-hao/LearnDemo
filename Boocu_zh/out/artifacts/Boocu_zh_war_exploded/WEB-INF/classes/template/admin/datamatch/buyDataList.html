<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=9" > </meta>
<title>云图商城-后台管理</title>
<style type="text/css">
body{
	margin:0px;
	font-family:Arial,"宋体",Verdana,sans-serif;
	font-size:12px;
}
html,body {padding: 0;margin: 0; overflow-x:hidden; overflow-y:auto;}
dl,dd{margin:0px}
ul{
	list-style-type:none;
	margin:0px;
	padding:0px;
	
}
.prosortd{ clear:both;  margin-left:10px; overflow:hidden; zoom:1; }
.prosortd p{ float:left; padding-right:120px; font-size:14px;}
.prosortd1{ clear:both; margin-left:10px; overflow:hidden; zoom:1; }
.prosortd1 p{ float:left; padding-right:150px; font-size:14px;}
.prosortd2{ clear:both; margin-left:240px; overflow:hidden; zoom:1; }
.prosortd2 p{ float:left; padding-right:150px; font-size:14px;}
</style>
<script type="text/javascript" src="/editor/ckeditor362/ckeditor.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/jquery-form-2.33.js"></script>
<script type="text/javascript" src="/statics/js/area_sql.js"></script>
<link rel="stylesheet" type="text/css" href="/adminthemes/new/js/easy-ui/themes/gray/easyui.css"/>    
<link rel="stylesheet" type="text/css" href="/adminthemes/new/js/easy-ui/themes/icon.css"/>  
<script type="text/javascript" src="/adminthemes/new/js/easy-ui/jquery.easyui.min.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/easy-ui/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/jquery.blockUI.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/jquery.loading.js"></script>
<link href="/adminthemes/new/css/main.css" rel="stylesheet" type="text/css" />
<link href="/adminthemes/new/css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/adminthemes/js/BooCu.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/ajaxupload.3.9.js"></script>
<script type="text/javascript" src="/frontthemes/js/easyuiUtil.js"></script>


[#include '/template/admin/include/common.html']

</head>
<body>
 
<div id="bookinfo" style="display: none;"></div>
<div id="loading"></div>
<div class="main">
	<div title="筛选条件" data-options="selected:true">
		 <div class="prosortd">
		 <!-- 会员等级 -->
	        <p>日期: </p>
	        <p><input type="radio"  s_val="1" checked="checked" name="dateGroupId" >今日</p>
	        <p><input type="radio"  s_val="3" name="dateGroupId">最近三天</p>
	        <p><input type="radio"  s_val="7" name="dateGroupId">最近七天</p>
	        <p><input type="radio"  s_val="30" name="dateGroupId">最近一月</p>
	    </div>
	</div>
	<div class="easyui-tabs">
		<div title="销售/求购" style="padding:10px;">
			<div id="tb" style="height: auto">
				<a href="javascript:void(0)" id="saleA" class="button blueButton" data-options="plain:true" onclick="showSale()">销售匹配求购</a>
				<a href="javascript:void(0)" id="buyA" class="button" data-options="plain:true" onclick="showBuy()">求购匹配销售</a>
					
				<span style="float: right;">
					<span id="saleSpan">
					<input class="easyui-combobox combo " type="text" id="saleSel" name="id" data-options=
					"url:'/productSale/getSaleNames.jspx?date=1',method:'get',valueField:'id',textField:'text', width:300 "/>
					</span>
					<span id="buySpan">
					<input class="easyui-combobox combo " type="text" id="buySel" name="id" data-options=
					"url:'/productBuy/getBuyNames.jspx?date=1',method:'get',valueField:'id',textField:'text', width:300 "/>
					</span>
					<span id="simpleSearch">
						<input id="searchKeyword1" class="input_text" type="text" value="" size="30" style="width: 300px;"
						placeholder="请输入品牌型号" name="searchKeyWord">
						<input type="hidden" id="jyFlag" value="-1">
						<a href="javascript:void(0)" class="easyui-linkbutton" 	data-options="plain:true" onclick="search1()">搜索</a>
					</span>
				</span>
			</div>
			<div class="clear height10"></div>
			<div class="shadowBoxWhite tableDiv">
				<div id="salediv">
					<table class="easyui-datagrid"
						data-options="url:'/productSale/saleMatchBuy.json',pageList: [5,10,15,20],pageSize:10"
						pagination="true" id="saledata1" sortName="id" sortOrder="desc">
						<thead>
							<tr>
							 	<th data-options="field:'id',checkbox:true">id</th>
							 	<th data-options="field:'name',width:150,sortable:'true',align:'center'" formatter="reqinfo" >品牌/型号</th>
								<th data-options="field:'poption',width:150,align:'center'">选件</th>
								<th data-options="field:'qualityStatus',width:150,align:'center'">成色</th>
								<th data-options="field:'repairPeriod',width:100,align:'center'">保修时间</th>
								<th data-options="field:'prouseAddress',width:150,align:'center'">使用地</th>
								<th data-options="field:'price',width:100,align:'center'">预算价格</th>
								<th data-options="field:'userName',width:150,align:'center'">用户名</th>
								<!-- 
								<th data-options="field:'linkUp',width:200,align:'center'" formatter="linkUp">沟通</th>
								<th data-options="field:'quote',width:200,align:'center'" formatter="quote1">询价</th>
								 -->
							</tr>
						</thead>
					</table>
				</div>
				<div id="buydiv">
					<table class="easyui-datagrid"
						data-options="url:'/productBuy/buyMatchSale.json',pageList: [5,10,15,20],pageSize:10"
						pagination="true" id="buydata1" sortName="id" sortOrder="desc">
						<thead>
							<tr>
								<th data-options="field:'id',checkbox:true">id</th>
							 	<th data-options="field:'name',width:150,sortable:'true',align:'center'" formatter="reqinfo" >品牌/型号</th>
								<th data-options="field:'poption',width:150,align:'center'">选件</th>
								<th data-options="field:'qualityStatus',width:150,align:'center'">成色</th>
								<th data-options="field:'repairPeriod',width:100,align:'center'">保修时间</th>
								<th data-options="field:'prouseAddress',width:150,align:'center'">使用地</th>
								<th data-options="field:'price',width:100,align:'center'">价格</th>
								<th data-options="field:'userName',width:150,align:'center'">用户名</th>
								<!-- 
								<th data-options="field:'linkUp',width:200,align:'center'" formatter="linkUp">沟通</th>
								<th data-options="field:'quote',width:200,align:'center'" formatter="quote2">报价</th>
								 -->
							</tr>
						</thead>
					</table>
				</div>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">

	//初始化数据集
	$(function(){
		//隐藏的div
		$("#buydiv").hide();
		//隐藏的select
		$("#buySpan").hide();
	});

	$(".prosortd").find("input[type='radio']").change(function(){
		var date = $(".prosortd").find("input[name='dateGroupId']:checked").attr("s_val");
		
		var kw = $("#searchKeyword1").val();
		
		if($("#jyFlag").val()==-1){
			//销售
			$("#saleSel").combobox("clear");
			$("#saleSel").combobox("reload","/productSale/getSaleNames.jspx?keyword="+kw+"&date="+date);
		}else{
			$("#buySel").combobox("clear");
			$("#buySel").combobox("reload","/productBuy/getBuyNames.jspx?keyword="+kw+"&date="+date);
		}
		
	});
	
	//计数器，判断要不要刷新表格
	var buyf = true;
	
	function showSale(){
		$("#salediv").show();
		$("#buydiv").hide();
		
		$("#buySpan").hide();
		$("#saleSpan").show();
		
		$("#saleA").addClass("blueButton");
		$("#buyA").removeClass("blueButton")
		
		//修改标识
		$("#jyFlag").val(-1);
		//清空input的值
		$("#searchKeyword1").val("");
	}
	
	function showBuy(){
		$("#buydiv").show();
		$("#salediv").hide();
		
		$("#buySpan").show();
		$("#saleSpan").hide();
		
		$("#buyA").addClass("blueButton");
		$("#saleA").removeClass("blueButton");
		if(buyf){
			$("#buydata1").datagrid('reload');
		}
		//修改标识
		$("#jyFlag").val(1);
		$("#searchKeyword1").val("");
		
		buyf = false;
	}
	
	//销售的下拉事件
	$("#saleSel").combobox({
		onChange:function(id,e){
			$("#saledata1").datagrid("load",{
				keyword:id,
				page:1
			});
		}
	});
	
	//求购的下拉事件
	$("#buySel").combobox({
		onChange:function(id,e){
			$("#buydata1").datagrid("load",{
				keyword:id,
				page:1
			});
		}
	});
	
	//销售、求购搜索事件
	function search1(){
		var kw = $("#searchKeyword1").val();
		var date = $(".prosortd").find("input[name='dateGroupId']:checked").attr("s_val");
		
		if($("#jyFlag").val()==-1){
			//销售
			$("#saleSel").combobox("clear");
			$("#saleSel").combobox("reload","/productSale/getSaleNames.jspx?keyword="+kw+"&date="+date);
		}else{
			$("#buySel").combobox("clear");
			$("#buySel").combobox("reload","/productBuy/getBuyNames.jspx?keyword="+kw+"&date="+date);
		}
	}
	
	function reqinfo(value, row, index) {
		var val = "<a class='details' title='名称' href='javascript:void(0);' onclick='alert(\""+row.name+"\")'>"+row.name+"</a>";
		return val;
	}
	
	//沟通
	function linkUp(value, row, index) {
		var val = "<a class='details' title='沟通' href='javascript:void(0);' onclick='alert(\""+row.linkUp+"\")'>沟通</a>";
		return val;
	}
	
	//报价
	function quote1(value, row, index) {
		var val = "<a class='details' title='报价' href='javascript:void(0);' onclick='seek(\""+row.id+"\")'>询价</a>";
		return val;
	}
	
	//报价
	function quote2(value, row, index) {
		var val = "<a class='details' title='报价' href='javascript:void(0);' onclick='seek(\""+row.id+"\")'>报价</a>";
		return val;
	}
	
	function seek(proId){
		$.post("/quote/insertQuote.jspx",{"proId":proId,"type":"productSale"},
			function(data){
				if(data){
					if(data=="ok"){
						alert("报价成功，请耐心等待。。。");
					}else if(data == "exist"){
						alert("已经报价，请不要重复报价。。。")
					}else{
						alert("报价失败，未知异常，请稍候再试。。。")
					}
				}
		})
	}
</script>
</body>
</html>