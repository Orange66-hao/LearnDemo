
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=9" > </meta>
<title>云图商城-后台管理</title>
<style type="text/css">
body{
	margin:0px;
	font-family:Arial,"宋体",Verdana,sans-serif;
	font-size:12px;
}
html,body {padding: 0;margin: 0; overflow-x:hidden; overflow-y:auto;}
dl,dd{margin:0px}
ul{
	list-style-type:none;
	margin:0px;
	padding:0px;
}
</style>

<script type="text/javascript" src="/adminthemes/new/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/jquery-form-2.33.js"></script>
<script type="text/javascript" src="/statics/js/area_sql.js"></script>
<link rel="stylesheet" type="text/css" href="/adminthemes/new/js/easy-ui/themes/gray/easyui.css"/>    
<link rel="stylesheet" type="text/css" href="/adminthemes/new/js/easy-ui/themes/icon.css"/>  
<script type="text/javascript" src="/adminthemes/new/js/easy-ui/jquery.easyui.min.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/easy-ui/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/jquery.blockUI.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/jquery.loading.js"></script>
<link href="/adminthemes/new/css/main.css" rel="stylesheet" type="text/css" />
<link href="/adminthemes/new/css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/adminthemes/js/BooCu.js"></script>
<script type="text/javascript" src="/adminthemes/new/js/ajaxupload.3.9.js"></script>
<script type="text/javascript" src="/frontthemes/js/easyuiUtil.js"></script>
[#include '/template/admin/include/common.html']

</head>
<body>
 
<div id="bookinfo" style="display: none;"></div>
<div id="loading"></div>
<div class="main">
<div class="easyui-tabs">
	<div title="显示" style="padding:10px;">
	<form id="memberform1">
		<div id="tb" style="height: auto">
		    <a href="javascript:;" class="easyui-linkbutton" 
				data-options="plain:true" onclick="cancel1()" >取消</a>
				
			<span style="float: right;"> 
				<span id="simpleSearch">
					<input id="searchKeyword1" class="input_text" type="text" value="" size="30" style="width: 300px;"
					placeholder="会员名|型号" name="searchKeyWord"> 
					<a href="javascript:void(0)" class="easyui-linkbutton" 
					data-options="plain:true" onclick="searchAdvertBase1()">搜索</a>
				</span>
			</span>
		</div>
		
		<div class="clear height10"></div>
		<div class="shadowBoxWhite tableDiv">
		<table class="easyui-datagrid"
			data-options="url:'/admin/index/sales/display.json',pageList: [5,10,15,20],pageSize:10"
			pagination="true" id="memberdata1" sortName="id" sortOrder="desc" >
			<thead>
				<tr>
					<th data-options="field:'item.id',checkbox:true"></th>
					<th data-options="field:'item.memberEntity.username',width:150,sortable:'true'">用户名</th>
					<th data-options="field:'item.productBrandEntity.name',width:150,sortable:'true'">品牌</th>
					<th data-options="field:'item.proNo',width:100,sortable:'true'">商品型号</th>
					<th data-options="field:'item.proName',width:150,sortable:'true'">商品名称</th>
					<th data-options="field:'item.proOriginal1',width:200,sortable:'true'" formatter="formatImg">促销图片</th>
					<th data-options="field:'item.sort',width:100,sortable:'true'" >排序</th>
					<th data-options="field:'item.referencePrice',sortable:'true',width:100 ">全新参考价</th>
					<th data-options="field:'item.referencepriceType',sortable:'true',width:100 " formatter="typeOperation">全新参考价单位</th>
					<th data-options="field:'item.referencePriceLimit',sortable:'true',width:100 " formatter="priceOperation">全新参考价币别</th>
					<th data-options="field:'item.proCustomPrice',sortable:'true',width:100 ">来宾价格</th>
					<th data-options="field:'item.proCustomPriceType',sortable:'true',width:100 " formatter="typeOperation">来宾价格单位</th>
					<th data-options="field:'item.proMemberPrice',sortable:'true',width:100 ">客户价格</th>
					<th data-options="field:'item.proMemberPriceType',sortable:'true',width:100 " formatter="typeOperation">客户价格单位</th>
					<th data-options="field:'item.proPeer',sortable:'true',width:100 ">同行价格</th>
					<th data-options="field:'item.proPeerType',sortable:'true',width:100 " formatter="typeOperation">同行价格单位</th>
					<th data-options="field:'item.proVipPrice',sortable:'true',width:100 ">VIP价格</th>
					<th data-options="field:'item.proVipPriceType',sortable:'true',width:100 " formatter="typeOperation">VIP价格单位</th>
					<th data-options="field:'action',width:100,align:'center'" formatter="formatOperation1">操作</th>
				</tr>
			</thead>
		</table>
		</div>
	</form>
	</div>
<div title="未显示" style="padding:10px;">
	<form id="memberform2">
		<div id="tb" style="height: auto">
		    <a href="javascript:;" class="button blueButton" 
				data-options="plain:true" onclick="agree2()" >同意</a>
			<a href="javascript:;" class="easyui-linkbutton"
				data-options="plain:true" onclick="cancel2()">取消</a>
				
			<span style="float: right;"> 
				<span id="simpleSearch">
					<input id="searchKeyword2" class="input_text" type="text" value="" size="30" style="width: 300px;"
					placeholder="会员名|型号" name="searchKeyWord"> 
					<a href="javascript:void(0)" class="easyui-linkbutton" 
					data-options="plain:true" onclick="searchAdvertBase2()">搜索</a>
				</span>
			</span>
		</div>
		
		<div class="clear height10"></div>
		<div class="shadowBoxWhite tableDiv">
		<table class="easyui-datagrid"
			data-options="url:'/admin/index/sales/Ndisplay.json',pageList: [5,10,15,20],pageSize:10"
			pagination="true" id="memberdata2" sortName="id" sortOrder="desc" >
			<thead>
				<tr>
					<th data-options="field:'item.id',checkbox:true"></th>
					<th data-options="field:'item.memberEntity.username',width:150,sortable:'true'">用户名</th>
					<th data-options="field:'item.productBrandEntity.name',width:150,sortable:'true'">品牌</th>
					<th data-options="field:'item.proNo',width:100,sortable:'true'">商品型号</th>
					<th data-options="field:'item.proName',width:150,sortable:'true'">商品名称</th>
					<th data-options="field:'item.proOriginal1',width:200,sortable:'true'" formatter="formatImg">促销图片</th>
					<th data-options="field:'item.sort',width:100,sortable:'true'" >排序</th>
					<th data-options="field:'item.referencePrice',sortable:'true',width:100 ">全新参考价</th>
					<th data-options="field:'item.referencepriceType',sortable:'true',width:100 " formatter="typeOperation">全新参考价单位</th>
					<th data-options="field:'item.referencePriceLimit',sortable:'true',width:100 " formatter="priceOperation">全新参考价币别</th>
					<th data-options="field:'item.proCustomPrice',sortable:'true',width:100 ">来宾价格</th>
					<th data-options="field:'item.proCustomPriceType',sortable:'true',width:100 " formatter="typeOperation">来宾价格单位</th>
					<th data-options="field:'item.proMemberPrice',sortable:'true',width:100 ">客户价格</th>
					<th data-options="field:'item.proMemberPriceType',sortable:'true',width:100 " formatter="typeOperation">客户价格单位</th>
					<th data-options="field:'item.proPeer',sortable:'true',width:100 ">同行价格</th>
					<th data-options="field:'item.proPeerType',sortable:'true',width:100 " formatter="typeOperation">同行价格单位</th>
					<th data-options="field:'item.proVipPrice',sortable:'true',width:100 ">VIP价格</th>
					<th data-options="field:'item.proVipPriceType',sortable:'true',width:100 " formatter="typeOperation">VIP价格单位</th>
					<th data-options="field:'action',width:100,align:'center'" formatter="formatOperation2">操作</th>
				</tr>
			</thead>
		</table>
		</div>
	</form>
	</div>
	</div>
	<div id="divdia" style="display: none;"></div>

</div>
<script type="text/javascript">
	function submitForm(map) {
		var formflag = $(map["formId"]).form().form('validate');
		if (formflag) {
			$.Loading.show(map["loadshow"]);
			var options = {
				url : map["url"],
				type : "POST",
				dataType : 'json',
				success : function(result) {
					if (result.result == 1) {
						$.Loading.show(result.message);
						$(map["divDialog"]).dialog('close');
						$(map["gridreload"]).datagrid('reload');
					}
					if (result.result == 0) {
						$.Loading.error(result.message);
					}
					$.Loading.hide();
				},
				error : function(e) {
					alert("出现错误 ，请重试");
				}
			};
			$(map["formId"]).ajaxSubmit(options);
		}
	}
	
	
	function append1(id) {
		var map = {}; // Map map = new HashMap();
		if(id !=null){
			map["href"] = "/admin/index/sales/edit_sales.jspx?id="+id;
			map["formId"] = "#editForm";
			map["url"] = "/admin/index/sales/save_edit_sales.jspx?ajax=yes";
			map["title"] = "修改促销信息";
			map["loadshow"] = "正在修改......";
		}
		map["divDialog"] = "#divdia";
		map["gridreload"] = "#memberdata1";
		addDialog(map);
	}
	
	function append2(id) {
		var map = {}; // Map map = new HashMap();
		if(id !=null){
			map["href"] = "/admin/index/sales/edit_sales.jspx?id="+id;
			map["formId"] = "#editForm";
			map["url"] = "/admin/index/sales/save_edit_sales.jspx?ajax=yes";
			map["title"] = "修改促销信息";
			map["loadshow"] = "正在修改......";
		}
		map["divDialog"] = "#divdia";
		map["gridreload"] = "#memberdata2";
		addDialog(map);
	}
	
	function addDialog(map) {
		$(map["divDialog"]).show();
		$(map["divDialog"]).dialog({
			title : map["title"],
			width : 600,
			height : 400,
			closed : false,
			cache : false,
			href : map["href"],
			modal : true,
			buttons : [ {
				text : '保存',
				iconCls : 'icon-ok',
				handler : function() {
					var savebtn = $(this);
	　　				var disabled=savebtn.hasClass("l-btn-disabled");
	　　				if(!disabled){
						 submitForm(map,savebtn);
					}
				}
			}, {
				text : '清空',
				handler : function() {
					clearForm(map);
				}
			} ]
		});
	}
	
	function clearForm(map) {
		$(map["formId"]).form('clear');
	}
	
	function formatOperation1(value, row, index) {
		var val = "<a class='edit' title='修改' href='javascript:void(0);' onclick='append1("+row.item.id+")' ></a>";
		return val;
	}

	function formatOperation2(value, row, index) {
		var val = "<a class='edit' title='修改' href='javascript:void(0);' onclick='append2("+row.item.id+")' ></a>";
		return val;
	}
	
	function typeOperation(value, row, index){
		return "millionyuan" == value ? "万元" : "元"
	}

	function priceOperation(value, row, index){
		return "dollar" == value ? "美元" : "人民币"
	}
	//显示列表   取消
	function cancel1() {
		var rows = $('#memberdata1').datagrid("getSelections");
		if (rows.length < 1) {
			$.Loading.error("请选择要取消的选项");
			return;
		}
		if (!confirm("确认取消选中的该选项？")) {
			return;
		}
		var options = {
			url : "/admin/index/sales/cancel?ajax=yes",
			type : "POST",
			dataType : 'json',
			success : function(result) {
				$.Loading.success(result.message);
				if (result.result==1) {
					var rows = $('#memberdata1').datagrid("getSelections");
					for ( var i = 0; i < rows.length; i++) {
						var index = $('#memberdata1').datagrid('getRowIndex',rows[i]);
						$('#memberdata1').datagrid('reload');
					}
				}
			},
			error:function(e) {
				$.Loading.error("出现错误 ，请重试");
			}
		};
		$('#memberform1').ajaxSubmit(options);
	}
	//未显示列表   取消
	function cancel2() {
		var rows = $('#memberdata2').datagrid("getSelections");
		if (rows.length < 1) {
			$.Loading.error("请选择要取消的选项");
			return;
		}
		if (!confirm("确认取消选中的该选项？")) {
			return;
		}
		var options = {
			url : "/admin/index/sales/cancel?ajax=yes",
			type : "POST",
			dataType : 'json',
			success : function(result) {
				$.Loading.success(result.message);
				if (result.result == 1) {
					var rows = $('#memberdata2').datagrid("getSelections");
					for ( var i = 0; i < rows.length; i++) {
						var index = $('#memberdata2').datagrid('getRowIndex',
								rows[i]);
						$('#memberdata2').datagrid('reload');
					}
				}
			},
			error : function(e) {
				$.Loading.error("出现错误 ，请重试");
			}
		};
		$('#memberform2').ajaxSubmit(options);
	}
	//未显示列表  同意
	function agree2() {
		var rows = $('#memberdata2').datagrid("getSelections");
		if (rows.length < 1) {
			$.Loading.error("请选择要取消的选项");
			return;
		}
		if (!confirm("确认取消选中的该选项？")) {
			return;
		}
		var options = {
			url : "/admin/index/sales/agree?ajax=yes",
			type : "POST",
			dataType : 'json',
			success : function(result) {
				$.Loading.success(result.message);
				if (result.result == 1) {
					var rows = $('#memberdata2').datagrid("getSelections");
					for ( var i = 0; i < rows.length; i++) {
						var index = $('#memberdata2').datagrid('getRowIndex',
								rows[i]);
						$('#memberdata2').datagrid('reload');
						$('#memberdata1').datagrid('reload');
					}
				}
			},
			error:function(e) {
				$.Loading.error("出现错误 ，请重试");
			}
		};
		$('#memberform2').ajaxSubmit(options);
	}
	
	function searchAdvertBase1(){
		var keyword = $("#searchKeyword1").val();
		$("#memberdata1").datagrid("load",{
			keyword:keyword,
			page:1
		});
	}
	function searchAdvertBase2(){
		var keyword = $("#searchKeyword2").val();
		$("#memberdata2").datagrid("load",{
			keyword:keyword,
			page:1
		});
	}
	
</script>
</body>
</html>