<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>我的购物车 - ${currentMember.realName}</title>
[#include '/template/front/include/csslist.html' /]
<style type="text/css">
#w1 {
	display:none;
	background: #000;
	filter: alpha(opacity = 70);
	opacity: 0.7;
	left: 0px;
	top: 0px;
	position: fixed;
	height: 100%;
	width: 100%;
	z-index: 1001;
}
.osc {
	height: 26px;
	line-height: 26px;
	padding: 0 10px;
	border: 1px #ccc solid;
	display: inline-block;
	border-radius: 3px;
	-webkit-border-radius: 3px;
	-moz-border-radius: 3px;
}
.op{
	float: left;
	margin-right: 10px;
}
</style>
<link rel="stylesheet" type="text/css" href="/statics/front/css/xcConfirm.css"/>
</head>
<body>
[#include '/template/front/include/header.html' /]
[#include '/template/front/include/jslist.html' /]
 <!--loading-->
 <div class="listloadingd" id="indexLoading" ></div>
	<!--content-->
	<div id="w1"></div>
	<div id="w3" style="display:none;">
		<div id="w" class="easyui-window" title="提  示" data-options="closed:true,resizable:false,minimizable:false,maximizable:false,modal:true," style="width:320px;height:220px;padding:5px;background:#3a93d4;">
			<div class="easyui-layout" data-options="fit:true">
				<div data-options="region:'center'" style="padding:10px;background:#fff;">
					您的账号信息不全或者账号正在审核，暂时不能发布信息，请完善资料后等待审核!
					<p style="padding-top:80px;margin-left:110px;"><a class="easyui-linkbutton" href="javascript:void(0)" onclick="window_submit()" style="width:80px">确  认</a></p>
				</div>
			</div>
		</div>
	    <div id="w2" class="easyui-window" title="提  示" data-options="closed:true,resizable:false,minimizable:false,maximizable:false" style="width:320px;height:220px;padding:5px;background:#3a93d4;">
			<div class="easyui-layout" data-options="fit:true">
				<div data-options="region:'center'" style="padding:10px;background:#fff">
					您的账号未激活，请先登录注册邮箱激活!
					<p style="padding-top:105px;margin-left:110px;"><a class="easyui-linkbutton" href="javascript:void(0)" onclick="window_close()" style="width:80px">确  认</a></p>
				</div>
			</div>
		</div>
	</div>
	<div class="main userd">
	  <div class="umaintitd">当前位置：<a href="/" style="text-decoration:none;">首页</a> &gt; <a href="/user/user" style="text-decoration:none;">
	  		会员中心 </a>&gt; <a href="javascript:void;" style="text-decoration:none;"><span>订单管理</span></a></div>
	  <!--usernav-->
	  [#include '/template/front/include/usernav.html' /]
	  <!--./usernav--> 
	  
	  <!--umainr-->
	  <div class="umainr">
	    <div class="umainrtitd"><span>购物车</span></div>
	    <div class="uorderd"> 
	      
	      <!--uotitd-->
	      <div class="uotitd">
	        <div class="l">
	          <p>全部商品：<span class="b">${shopCart.total}</span></p>
	          <p>降价商品：<span class="b">0</span></p>
	          <p class="last">库存紧张：<span class="b">0</span></p>
	        </div>
	        <div class="r">已选商品（不含运费，满300元包邮）<span id="sumAmount" style="font-weight:700;" class="red">￥：0.00</span><a href="javascript:;" onclick="settle()" class="jsa">结算</a></div>
	      </div>
	      <!--./uotitd--> 
	      
	      <!--uosearchd-->
	      <div class="uosearchd">
	      	<input type="hidden" id="typeO" value="${selOType}">
	      	<input type="hidden" id="noPro" value="${selProNo}">
	      	<input type="hidden" id="isfirst" value="${isFirst}">
	      	
	        <form name="uosearchForm" id="scForm" method="post" action="/shopCart/toShopCart.jspx">
	          <div class="keyinpd">
	            <p>
	              <input type="text" name="txtProName" id="txtKey" class="txt" value="${proName}" placeholder="请输入商品名称">
	            </p>
	            <p><a class="btn" href="javascript:;" onclick="$('#scForm').submit()">商品搜索</a></p>
	            <p><a class="link" href="javascript:;"><span>精简筛选条件</span><i></i></a><div><span style="color: red;float: right;font-weight: bold;">（税率不同的商品不能一起结算）</span></div></p>
	          </div>
	          <div class="uosjjd">
	            <div class="row">
	              <div class="fl dw4" style="width: 400px">
	                <p class="fl">产品品牌：</p>
	                <p class="fl">
	                  <select name="selOType" id="selOType" onchange="$('#scForm').submit()" style="width: 250px" class="sel">
	                    <option value="0">全部品牌</option>
	                  </select>
	                </p>
	              </div>
	              <div class="fl dw4">
	                <p class="fl">产品型号：</p>
	                <p class="fl">
	                  <select name="selProNo" id="selProNo" onchange="$('#scForm').submit()" class="sel">
	                    <option value="0">全部型号</option>
	                  </select>
	                </p>
	              </div>
	            </div>
	            <!--./row--> 
	          </div>
	        </form>
	      </div>
	      <!--./uosearchd--> 
	      
	      <!--uotabd-->
	      <div class="uotabd">
	        <table width="100%" cellspacing="0" class="uinqtab">
	          <tr>
	            <th width="30%">商品名称</th>
	            <th width="13%">单价（元）</th>
	            <th width="5%">数量</th>
	            <th width="15%">金额（元）</th>
	            <th width="13%">税率</th>
	            <th width="13%">操作</th>
	          </tr>
	          <tr class="b0">
	            <td colspan="6"><div class="texed">
	                <div class="l">
	                  <p class="op"><label><input type="checkbox" name="ckAll" id="ckAll" class="ckall">&nbsp;全选</label></p>
	                </div>
	                <div style="float: left;">
	                  <p class="op"><a class="bj" href="javascript:;" onclick="batchDel()">批量删除</a></p>
	                </div>
	              </div>
	            </td>
	          </tr>
	          [#list shopCart.cont as product]
	          <tr>
	            <td>      
	            	<label style="float: left;"><input type="checkbox" name="ckId" h_is_rate="${product.productEntity.isTax}" h_rate='${product.productEntity.taxRate}' h_price="${product.price * product.count}" value="${product.id}"></label>
	            	<a href="javascript:;" onclick="window.open('${product.url}')" class="tit">${product.productEntity.productBrandEntity.name} ${product.productEntity.proNo} ${product.productEntity.proName}</a><img style="width: 100px;height: 100px;" 
										src="${product.productEntity.proOriginal1}"/><!-- <img style="width: 100px;height: 100px;" src="[#if product.proOriginal1!]${product.proOriginal1}[#else]/statics/front/images/nopic.jpg[/#if]" /> -->
	            </td>
	            <td><a href="javascript:;">￥${product.price}</a></td>
	            <td>${product.count}</td>
	            <td>￥${product.price * product.count}</td>
	            <td>[#if product.productEntity.isTax == 1][#if product.productEntity.taxRate=='invoice' || product.productEntity.taxRate=='taxInvoice']3%
	            [#elseif product.productEntity.taxRate=='taxSpecialInvoice']17%[/#if][#else]不含税[/#if]</td>
	            <td><a href="javascript:;" onclick="collect(${product.productEntity.id})">加入收藏夹</a><br>
	            <a href="javascript:;" onclick="del(${product.id})">删除</a></td>
	          </tr>
	          [/#list] 
	        </table>
	        
	        <!--uexepaged-->
	        <div class="uexepaged">
	          <div class="upagfr"> 
	           <!--pagd-->
	 			<div class="upagd" id="upagd">
	 			[#if (shopCart.pageNumber-1) gte 1]<a class="prev" href="javascript:void(0);" s_val="${shopCart.pageNumber-1}">上一页</a>[/#if][#list -2..2 as item]
				[#if (shopCart.pageNumber+item) gte 1 & (shopCart.pageNumber+item) lte shopCart.totalPages]<a href="javascript:void(0);" s_val="${shopCart.pageNumber+item}" class="${(item ==0)?string('on','')}">${shopCart.pageNumber+item}</a>[/#if]
	 			[/#list][#if shopCart.pageNumber lt shopCart.totalPages]<a class="next" href="javascript:void(0);" s_val="${shopCart.pageNumber+1}">下一页</a>[/#if]<span class="tnum">共${shopCart.totalPages}页</span><span class="txtd">到
	            <input type="text" name="txtPnum" id="txtPnum" class="txt">页</span><input type="button" class="btn" id="btn" href="javascript:;" value="确认" /></div>
	 			<!--./pagd--> 
	 			</div>
		    </div>
	      </div>
	    </div>
	  </div>
	</div>
<!--./content--> 

<script type="text/javascript" src="/statics/front/js/xcConfirm.js"></script>
<script type="text/javascript" src="/statics/front/js/shopcart.js"></script>
<!--foot--> 
[#include '/template/front/include/footer2.html' /]
<!--./foot--> 
<script type="text/javascript">
//精简条件
$(".uosearchd .keyinpd .link").click(function(){
	var formObj=$(".uosjjd");
	if(!formObj.is(":hidden")){
		formObj.slideUp(200);	
		$(this).removeClass("on");
	}else{
		formObj.slideDown(200);	
		$(this).addClass("on");
	}
});

function collect(proId){
	$.post("/collection/joinColl",{"memberId":${currentMember.id},"proId":proId},
	function(data){
		window.wxc.xcConfirm(data.cont, window.wxc.xcConfirm.typeEnum.info);
	});
}

function del(proId){
	$.post("/shopCart/delshopcart.jspx",{"id":proId,"isFirst":$("#isfirst").val()},
	function(data){
		if(data == "ok"){
			window.wxc.xcConfirm("删除成功！", window.wxc.xcConfirm.typeEnum.success,{onOk:function(){
				window.location.href="/shopCart/toShopCart.jspx";
			}});
		}else{
			window.wxc.xcConfirm("删除失败，请稍后再试！", window.wxc.xcConfirm.typeEnum.error);
		}
	});
}

//全选
$(".ckall").click(function(e){
    if($(this).attr("checked")){
		$("input[name='ckId']").attr("checked","checked");
		$(".ckall").attr("checked","checked");
		
		sumCount();
	}else{
		$("input[name='ckId']").removeAttr("checked");
		$(".ckall").removeAttr("checked");
		$("#sumAmount").html("￥：0.00");
	}
});

//单选
$("input[name='ckId']").click(function(){
	sumCount();
})
</script>
</body>
</html>
