<!--
  ~ Copyright (c) 2018. Lorem ipsum dolor sit amet, consectetur adipiscing elit.
  ~ Morbi non lorem porttitor neque feugiat blandit. Ut vitae ipsum eget quam lacinia accumsan.
  ~ Etiam sed turpis ac ipsum condimentum fringilla. Maecenas magna.
  ~ Proin dapibus sapien vel ante. Aliquam erat volutpat. Pellentesque sagittis ligula eget metus.
  ~ Vestibulum commodo. Ut rhoncus gravida arcu.
  -->

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9">
    </meta>
    <title>云图商城-后台管理</title>
    <style type="text/css">
        body {
            margin: 0px;
            font-family: Arial, "宋体", Verdana, sans-serif;
            font-size: 12px;
        }

        html, body {
            padding: 0;
            margin: 0;
            overflow-x: hidden;
            overflow-y: auto;
        }

        dl, dd {
            margin: 0px
        }

        ul {
            list-style-type: none;
            margin: 0px;
            padding: 0px;
        }

        .input_text2 {
            border: 1px solid #D7D7D7;
            border-radius: 3PX;
            /*height: 14PX;*/
            padding: 7px 0 7px 5px;
            line-height: 14PX;
            font-size: 12px;
            display: inline-block;
            width: 150px;
        }

        .input_text2:focus {
            border: 1px solid #06F;
            box-shadow: inset 0 1px 2px rgba(0, 102, 255, 0.3);
        }

    </style>
    <script type="text/javascript" src="/editor/ckeditor362/ckeditor.js"></script>
    <script type="text/javascript"
            src="/adminthemes/new/js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript"
            src="/adminthemes/new/js/jquery-form-2.33.js"></script>
    <script type="text/javascript" src="/statics/js/area_sql.js"></script>
    <link rel="stylesheet" type="text/css"
          href="/adminthemes/new/js/easy-ui/themes/gray/easyui.css"/>
    <link rel="stylesheet" type="text/css"
          href="/adminthemes/new/js/easy-ui/themes/icon.css"/>
    <script type="text/javascript"
            src="/adminthemes/new/js/easy-ui/jquery.easyui.min.js"></script>
    <script type="text/javascript"
            src="/adminthemes/new/js/easy-ui/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript"
            src="/adminthemes/new/js/jquery.blockUI.js"></script>
    <script type="text/javascript"
            src="/adminthemes/new/js/jquery.loading.js"></script>
    <link href="/adminthemes/new/css/main.css" rel="stylesheet"
          type="text/css"/>
    <link href="/adminthemes/new/css/style.css" rel="stylesheet"
          type="text/css"/>
    <script type="text/javascript"
            src="/adminthemes/new/js/main.js"></script>
    <script type="text/javascript" src="/adminthemes/js/BooCu.js"></script>
    <script type="text/javascript"
            src="/adminthemes/new/js/ajaxupload.3.9.js"></script>
    <script type="text/javascript" src="/frontthemes/js/easyuiUtil.js"></script>


    [#include '/template/admin/include/common.html']

</head>
<body>

<div id="bookinfo" style="display: none;"></div>
<div id="loading"></div>
<div class="main">
    <form id="memberform">
        <div id="tb" style="height: auto">
            [#if currentUser.username=='lwz'||currentUser.username=='admin']
            <a href="javascript:void(0)" class="button blueButton"
               data-options="iconCls:'icon-add',plain:true" onclick="addGuanlian()">添加</a>
            [/#if]

            <!--<a href="javascript:void(0)" class="easyui-linkbutton"
                data-options="plain:true" onclick="del()">删除</a>-->

            <span style="float: right;margin-right: 100px;">

				&nbsp;&nbsp;&nbsp;&nbsp;
				<span>
					<span>
				仪器名称：
				 <input style="width: 200px; height: 30px;"
                        class="easyui-combobox"
                        url="/admin/basedata/productclass/combotreeData.json?getSanji=true" name="productName"
                        data-options="multiple:false,valueField:'id',textField:'text',editable:true"
                        id="productName"/>
				</span>
				<span>
				产品名称：
				 <input style="width: 200px; height: 30px;"
                        class="easyui-combobox"
                        url="/admin/industyClass/combotreeData.json?getSanji=true" name="industryClassName"
                        data-options="multiple:false,valueField:'id',textField:'text',editable:true"
                        id="industryClassName"/>

				</span>


                     <span>
				型号名称：
				<input style="width: 140px; height: 30px;display: inline-block;font-size: 12px" name="model" id="model"
                       placeholder="请输入型号名称"></input>
				</span>

                    <!--创建时间：
                    <select id="create_date_all" name="create_date_all" class="input_text"  style="width: 100px; height: 32px;">
                    <option value='all' selected="selected">全部
                    <option value='3'>三天内
                    <option value='7'>本周内
                    <option value='30'>本月内
                </select>-->
				</span>
				&nbsp;&nbsp;&nbsp;&nbsp;
                <!-- <span id="simpleSearch">
                    <input id="searchKeyword" class="input_text" type="text" value="" size="30" style="width: 300px;"
                    placeholder="请输入公司名称" name="searchKeyWord">  -->
				<a href="javascript:void(0)" class="easyui-linkbutton"
                   data-options="plain:true" onclick="searchIndustryClass();">搜索</a>
				</span>
            </span>

        </div>

        <div class="clear height10"></div>
        <div class="shadowBoxWhite tableDiv">
            <table class="easyui-datagrid" id="dataList"
                   data-options="url:'/admin/industyClass/getGroupData.jspx',pageList: [5,10,15,20],pageSize:10,fitColumns:'true',rownumbers:'true'"
                   nowrap="false"
                   pagination="true" sortName="p.modify_date" sortOrder="desc" idField="p_id" treeField="name"
                   checkbox="true">
                <thead>
                <tr>
                    <th data-options="field:'p_id',checkbox:true"></th>
                    <!--<th data-options="field:'name',width:$(this).width()*0.25,sortable:'true',align: 'center'" formatter="formatupmajor">产品名称</th>-->
                    <th data-options="field:'p_name',width:$(this).width()*0.1,align: 'center'" formatter="formatName">
                        仪器名称
                    </th>
                    <!--<th data-options="field:'mc_productclass',hidden:true" formatter="formatup"></th>-->
                    <th data-options="field:'indulist',width:$(this).width()*0.1,align: 'center'"
                        formatter="formatIndustryClass">产品名称
                    </th>
                    <th data-options="field:'pbmlist',width:$(this).width()*0.25,align: 'center'"
                        formatter="formatBrandAndModel">产品型号
                    </th>
                    <th data-options="field:'p_modify_date',width:$(this).width()*0.08,sortable:'true',align: 'center'"
                        formatter="formdate">更新时间
                    </th>
                    [#if currentUser.username=='lwz'||currentUser.username=='admin']
                    <th
                            data-options="field:'action',width:$(this).width()*0.06,align:'center'"
                            formatter="formatOperation">操作
                    </th>
                    [/#if]
                </tr>
                </thead>
            </table>
        </div>
    </form>
    <div id="divdia" style="display: none;"></div>
    <div id="divdia2" style="display: none;"></div>
    <div id="divdia3" style="display: none;"></div>
</div>
<script type="text/javascript">

    function formatName(value, row, index) {
        [#if currentUser.username == 'lwz' || currentUser.username == 'admin']
            var val = "<a class='details' title='查看' href='javascript:void(0);' onclick='newTab(\""
                + row.p_name
                + "-信息\",\"/admin/industyClass/guanlian.jspx?yiqiId=" +
                row.p_id + "\")' >" + row.p_name + "</a>";
            return val;
        [#else]
            return row.p_name;
        [/#if]

    }


    $("#brand").combobox({
        valueField: 'id',
        textField: 'text',
        url: '/admin/basedata/brand/get_brand_names.jspx',
        required: true,
        multiple: false, //多选
        //editable: false, //是否可编辑
        filter: function (q, row) {
            var opts = $(this).combobox('options');
            return row.text.indexOf(q) >= 0 || row.nameEn.toUpperCase().indexOf(q.toUpperCase()) >= 0;//这里改成>=即可在任意地方匹配
        }
    })

    function formatIndustryClass(value, row, index) {
        [#if currentUser.username == 'lwz' || currentUser.username == 'admin']
        var str = '';
        $.each(row.indulist, function (i, ele) {//将有多个的数据，用a标签拼接成多个，用逗号隔开
            var val = "<a class='details' title='查看' href='javascript:void(0);' onclick='newTab(\""
                + "关联产品型号\",\"/admin/pBrandAndModel/toList.jspx?productId=" + row.p_id + "&industryClassId=" + ele.i_id
                + "\")' >" + ele.i_name + "</a>";
            str = str + val + ',';
        });
        return str.replace(/^,+/, "").replace(/,+$/, "");//正则去掉末尾的逗号
        [#else]
        var str = '';
        $.each(row.indulist, function (i, ele) {//将有多个的数据，用a标签拼接成多个，用逗号隔开
            var val = "<a class='details' title='查看' href='javascript:void(0);' >" + ele.i_name + "</a>";
            str = str + val + ',';
        });
        return str.replace(/^,+/, "").replace(/,+$/, "");//正则去掉末尾的逗号
        [/#if]

    }

    function formatBrandAndModel(value, row, index) {
        var str = '';
        $.each(row.pbmlist, function (i, ele) {//将有多个的数据，用a标签拼接成多个，用逗号隔开
            var val = "<a class='details' title='查看' href='javascript:void(0);'>" + ele.b_model + "</a>";
            str = str + val + ',';
        });
        return str.replace(/^,+/, "").replace(/,+$/, "");//正则去掉末尾的逗号
    }

    //下拉树实现自定义查询效果
    $('#productName').combobox({
        filter: function (q, row) {
            var opts = $(this).combobox('options');
            return row[opts.textField].indexOf(q) >= 0;//这里改成>=即可在任意地方匹配
        }
    });
    //下拉树实现自定义查询效果
    $('#mc_productclass_all').combobox({
        filter: function (q, row) {
            var opts = $(this).combobox('options');
            return row[opts.textField].indexOf(q) >= 0;//这里改成>=即可在任意地方匹配
        }
    });
    //下拉树实现自定义查询效果
    $('#mc_brand_all').combobox({
        filter: function (q, row) {
            var opts = $(this).combobox('options');
            return row[opts.textField].indexOf(q) >= 0;//这里改成>=即可在任意地方匹配
        }
    });

    function submitForm(map) {
        var data = {};
        data.id = $("#id").val();
        //data.mc_industry_class=$("#mc_industry_class_coll").combobox('getValues').toString();
        //data.mc_industry_class=$("#mc_industry_class_coll").val();

        data.major_product = $("#major_product_coll").combobox('getValues').toString();
        //data.major_product=$("#major_product_coll").val();

        //var contact2=$("#contact").combobox('getValues');
        //data.contact=contact2.toString();

        data.mc_productclass = $("#mc_productclass_coll").combobox('getValues').toString();
        //data.mc_productclass=$("#mc_productclass_coll").val();

        data.mc_brand = $("#mc_brand_coll").combobox('getValues').toString();

        /* 	var mc_model2=$("#mc_model_coll").combobox('getValues');
        data.mc_model=mc_model2.toString(); */

        /* 	var blame2=$("#blame").combobox('getValues');
        data.blame=blame2.toString();

        data.name=$("#name").combobox('getValue');   */
        var formflag = $(map["formId"]).form().form('validate');

        console.log(data);
        if (formflag && condition_company) {
            $.Loading.show(map["loadshow"]);
            var options = {
                url: map["url"],
                type: "POST",
                dataType: 'json',
                data: data,
                success: function (result) {
                    if (result.result == 1) {
                        $.Loading.show(result.message);
                        $(map["divDialog"]).dialog('close');
                        $(map["gridreload"]).datagrid('reload');
                        $("#major_product_all").combobox('reload');
                        $("#mc_productclass_all").combobox('reload');
                        $("#mc_brand_all").combobox('reload');
                    }
                    if (result.result == 0) {
                        $.Loading.error(result.message);
                    }
                    $.Loading.hide();
                },
                error: function (e) {
                    alert("出现错误 ，请重试");
                }
            };
            $.ajax(options);
        }
    }


    function append(id) {
        var map = {}; // Map map = new HashMap();
        if (!id) {
            map["href"] = "/admin/ModelCollectionTwo/add_modelcollectiontwo.jspx";
            map["formId"] = "#addForm";
            map["url"] = "/admin/ModelCollectionTwo/doAdd_memberGrade.jspx?ajax=yes";
            map["title"] = "添加信息";
            map["loadshow"] = "正在添加......";
        } else {
            map["href"] = "/admin/ModelCollectionTwo/edit_memberGrade.jspx?id=" + id;
            map["formId"] = "#editForm";
            map["url"] = "/admin/ModelCollectionTwo/doEdit_memberGrade.jspx?ajax=yes";
            map["title"] = "修改信息";
            map["loadshow"] = "正修改......";
        }
        map["divDialog"] = "#divdia";
        map["gridreload"] = "#dataList";
        addDialog(map);
    }

    function addDialog(map) {
        $(map["divDialog"]).show();
        $(map["divDialog"]).dialog({
            title: map["title"],
            width: 800,
            height: 400,
            closed: false,
            cache: false,
            href: map["href"],
            modal: true,
            buttons: [{
                text: '保存',
                iconCls: 'icon-ok',
                handler: function () {
                    for (instance in CKEDITOR.instances) {
                        CKEDITOR.instances[instance].updateElement();
                    }
                    var savebtn = $(this);
                    var disabled = savebtn.hasClass("l-btn-disabled");
                    if (!disabled) {
                        submitForm(map, savebtn);
                    }
                }
            }, {
                text: '清空',
                handler: function () {
                    clearForm(map);
                }
            }]
        });
    }

    function clearForm(map) {
        $(map["formId"]).form('clear');
    }

    function formatOperation(value, row, index) {
        var val = "<a class='edit' title='查看' href='javascript:void(0);' onclick='newTab(\"修改"
            + row.p_name
            + "-关联信息\",\"/admin/industyClass/edit_class.jspx?productclass_type=productclassshow&productby=" + row.p_name + "&yiqiId=" + row.p_id + "&id="
            + row.p_id + "\")' ></a>";
        return val;
    }

    function formatup(value, row, index) {
        var va = value + "";
        return va.replace(/^,+/, "").replace(/,+$/, "");
    }

    //查看联系人的详细信息
    /* function contactOperation(value, row, index) {
        var str='';
           $.each( row.contact, function(i, n){//将有多个联系人的数据，用a标签拼接成多个，用逗号隔开
                    var val = "<a class='details' title='查看' href='javascript:void(0);' onclick='newTab(\""
                        + row.contact_name[i]
                        + "-信息\",\"/admin/mcContacts/edit_memberGrade.jspx?contact_type=contactshow&id="
                        +n + "\")' >"+row.contact_name[i]+"</a>";
                        str=str+val+',';
            });
          return str.replace(/^,+/,"").replace(/,+$/,"");//正则去掉末尾的逗号

    } */
    function formatupmajor(value, row, index) {
        var str = '';
        $.each(row.productclassEntities, function (i, n) {//将有多个的数据，用a标签拼接成多个，用逗号隔开
            var val = "<a class='details' title='查看' href='javascript:void(0);' onclick='newTab(\""
                + row.productclassEntities[i]
                + "-信息\",\"/admin/mcMajor/edit_memberGrade.jspx?major_type=majorshow&id="
                + n + "\")' >" + row.productclassEntities[i] + "</a>";
            str = str + val + ',';
        });
        return str.replace(/^,+/, "").replace(/,+$/, "");//正则去掉末尾的逗号

    }

    function addGuanlian() {
        newTab("添加仪器关联产品", "/admin/industyClass/guanlian.jspx");
    }

    function formatupproductclass(value, row, index) {
        var str = '';
        $.each(row.pbModelList, function (index, element) {//将有多个的数据，用a标签拼接成多个，用逗号隔开
            var val = "<a class='details' title='查看' href='javascript:void(0);' >" + element.pb_model + "</a>";
            str = str + val + ',';
        });
        return str.replace(/^,+/, "").replace(/,+$/, "");//正则去掉末尾的逗号

    }

    function formatupbrand(value, row, index) {
        var str = '';
        $.each(row.brand, function (i, n) {//将有多个的数据，用a标签拼接成多个，用逗号隔开
            var val = "<a class='details' title='查看' href='javascript:void(0);' onclick='newTab(\""
                + row.brand_name[i]
                + "-信息\",\"/admin/mcBrand/edit_memberGrade.jspx?brand_type=brandshow&id="
                + n + "\")' >" + row.brand_name[i] + "</a>";
            str = str + val + ',';
        });
        return str.replace(/^,+/, "").replace(/,+$/, "");//正则去掉末尾的逗号

    }

    function formnull(value, row, index) {
        if (value == 'undefined') {
            return null;
        }
        return value;
    }

    function formdate(value, row, index) {
        if (value != null) {
            return new Date(value).format("yyyy-MM-dd");
        }
    }

    function showTemplate(value, row, index) {
        return "<a class='details' title='查看' href='javascript:void(0);' onclick='newTab(\""
            + row.templatename
            + "-模版内容\",\"/admin/userGroupMng/getTemplateContext.jspx?template="
            + row.templateId + "\")' >" + row.templatename + "</a>";
    }

    function del() {
        var rows = $('#dataList').datagrid("getSelections");
        if (rows.length < 1) {
            $.Loading.error("请选择要删除的帮助信息");
            return;
        }
        if (!confirm("确认删除选中的信息？")) {
            return;
        }
        var gradeId = [];
        for (var i = 0; i < rows.length; i++) {
            gradeId[i] = rows[i].id;
        }
        var options = {
            url: "/admin/ModelCollectionTwo/del_memberGrade.jspx?ajax=yes&&gradeId=" + gradeId,
            type: "POST",
            success: function (result) {

                if (result.result == 1) {
                    $.Loading.success(result.message);
                    $('#dataList').datagrid('reload');
                } else {
                    $.Loading.error(result.message);
                }
            },
            error: function (e) {
                $.Loading.error("出现错误 ，请重试");
            }
        };
        $('#dataList').ajaxSubmit(options);
    }

    function clearFormcontact(map) {
        $(map["formId"]).form('clear');
    }

    function searchIndustryClass() {
        //var keyword = $("#searchKeyword").combobox('getValues');
        //var mode_blame = $("#mode_blame").combobox('getValues');
        //var mc_industry_class = $("#mc_industry_class_all").val();
        //var major_product = $("#major_product_all").val();
        //var mc_productclass = $("#mc_productclass_all").val();
        //var mode_blame = $("#mode_blame").combobox('getValues');
        var productName = $("#productName").combotree('getValues');
        var industryClassName = $("#industryClassName").combobox('getValues');

        $("#dataList").datagrid('options').queryParams = {
            model: $("#model").val(),
            productName: productName.toString(),
            industryClassName: industryClassName.toString()
        };
        $("#dataList").datagrid('reload');
    }

</script>
</body>
</html>