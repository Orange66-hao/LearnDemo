<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript" src="/frontthemes/js/sumodelcollection.js"></script>
<!--下面两个是品牌选项框提示选择下拉选项的样式-->
<link rel="stylesheet" href="/statics/front/css/postbirdAlertBox.min.css" />
<script type="text/javascript" src="/statics/front/js/postbirdAlertBox.min.js"></script>
<div class="main" style="background-color: white;">
	<div class="easyui-panel" style="border-style: none;">
		<form id="addForm" method="post" class="validate">
			<table>
				<tr>
					<th>品牌</th>
					<td>
						<input style="width: 308px; height: 36px;"
								class="easyui-combobox"
								url="/admin/basedata/brand/get_brand_names.jspx" name="su_brand" data-options="multiple:'true',cascadeCheck:false,valueField:'id',textField:'text',editable:true"
								id="su_brand_coll"/>
					</td>
				</tr>
				<tr>
					<th>公司名</th>
					<td>
						<input class="easyui-validatebox" id="name" name="name" style="width: 308px; height: 36px;"/>
						<span class="rr_model" style="color: red"></span>
						</td>
					<td></td>
				</tr>
				<tr>
					<th>公司网站</th>
					<td>
						<input style="width: 300px; height: 21px;" class="input_text easyui-validatebox" type="text" id="su_website_coll"
							   name="su_website" data-options="required:false" value=""></input>
					</td>
				</tr>
				<tr>
					<th>行业分类</th>
					<td>
						
						<!-- <select style="width: 308px; height: 36px;"
										class="easyui-combobox"
										 name="su_industry_class" data-options="url:'/admin/suIndustyClass/combotreeData.json',valueField:'id',textField:'text',editable:true,multiple:true"
										id="su_industry_class_coll" /> </select> -->
										<input style="width: 300px; height: 21px;" class="input_text easyui-validatebox" type="text" id="su_industry_class_coll"
						name="su_industry_class" data-options="required:false" value=""></input>
										
						
					</td>
				</tr>
				<tr>
					<th>性  质：</th>
					<td>
						<select style="width: 308px; height: 36px;" id="type" name="type" class="input_text" required="required">
							<option value="" selected="selected">请选择</option>
							<option value="1">进口生产厂商</option>
							<option value="2">国产生产厂商</option>
							<option value="3">进口代理商</option>
							<option value="4">国产代理商</option>
							<option value="5">进口经销商</option>
							<option value="6">国产经销商</option>
							<option value="7">二手同行</option>
							<option value="8">系统集成商</option>
						</select>
					</td>
				</tr>
				<tr id="multiple_list">
					<th>主营设备品牌</th>
					<td >
						<select style="width: 140px; height: 36px;"  class="easyui-combobox" name="brand" id="brand"></select>
						型号<input class="input_text easyui-validatebox" style="width: 100px" type="text"
								   id="model" name="model" data-options="required:false" onblur="additional(0, null, this, null, null)"/>
						<input class="input_text easyui-validatebox" style="display:none" type="number" value="1"
								   id="number" name="number" data-options="required:false" onblur="additional(0, null, null, this, null)"/>
						名称<select style="width: 140px; height: 36px;"  class="easyui-combotree" name="su_productclass_name" id="su_productclass_name"></select>
						<a href="javascript:void(0)" class="button blueButton"
						   data-options="iconCls:'icon-add',plain:true" onclick="addInput()">再加一个型号</a>
					</td>
					<td><span class="rr_brand_and_model" style="color: red"></span></td>
				</tr>
				<tr>
					<th>常用仪器名称</th>
					<td>
						
						<!-- <select style="width: 308px; height: 36px;"
									class="easyui-combobox"
									  data-options="url:'/admin/basedata/suproductclass/get_sumember_names.jspx',multiple:true,valueField:'id',textField:'text',editable:false"
									id="su_productclass_coll" name="su_productclass" /> </select> -->
									<input style="width: 300px; height: 21px;" class="input_text easyui-validatebox" type="text" id="su_productclass_coll"
						name="su_productclass" data-options="required:false" value=""></input>
						<span style="color:red">* 多个请用逗号隔开</span>
					</td>
				</tr>
				<tr>
					<th>常用仪器品牌型号</th>
					<td>
						<input style="width: 300px; height: 21px;" class="input_text easyui-validatebox" type="text" id="su_productclass_type_coll"
							   name="su_productclass_type" data-options="required:false" value=""></input>
						<span style="color:red">* 多个请用逗号隔开</span>
					</td>
				</tr>
				<!--<tr>
					<th>品牌</th>
					<td>
					 <select style="width: 308px; height: 36px;"
								class="easyui-combobox"
								 name="su_brand"
								id="su_brand_coll" data-options="multiple:true,valueField:'id',textField:'text',editable:false"/> </select>
					</td>
				</tr>-->
				<!-- <tr>
					<th ">型号</th>
					<td>

						<select style="width: 308px; height: 36px;"
										class="easyui-combobox"
										 name="su_model"
										id="su_model_coll" data-options="multiple:true,cascadeCheck:false,valueField:'id',textField:'text',editable:false" /> </select>
					</td>
				</tr> -->
				<!-- <tr>
					<th>常用仪器</th>
					<td><input class="input_text easyui-validatebox" type="text"
						name="su_productclass" data-options="required:false" ></input>
					</td>
				</tr> -->
				<tr>
					<th>订阅内容</th>
					<td>
						<input style="width: 300px; height: 21px;" class="input_text easyui-validatebox" type="text" id="su_subscribe_content_coll"
							   name="su_subscribe_content" data-options="required:false" value=""></input>
					</td>
				</tr>
				<tr id="trr1" >
					<th id="trr2">联系人</th>
					<td>
						<input style="width: 308px; height: 36px;"
							   class="easyui-combobox"
							   name="contact" data-options="valueField:'id',textField:'text',multiple:'true',separator:',',editable:false"
							   id="contact" required="required"/>

					</td>
				</tr>
				<tr>
					<th>采购责任人</th>
					<td>
						<select style="width: 308px; height: 36px;"
							class="easyui-combobox"
							url="/admin/suMember/get_sumember_names.jspx" name="blame_buy" data-options="multiple:'true',valueField:'id',textField:'text',editable:false"
							id="blame_buy"/> </select>

					</td>
				</tr>
				<tr>
					<th>跟单责任人</th>
					<td>
						<select style="width: 308px; height: 36px;"
							class="easyui-combobox"
							url="/admin/suMember/get_sumember_names.jspx" name="blame" data-options="multiple:'true',valueField:'id',textField:'text',editable:false"
							id="blame" required="required"/> </select>
						
					</td>
				</tr>
				<tr>
					<th>等级</th>
					<td>
						<select style="width: 308px; height: 36px;" id="grade" name="grade" class="input_text" required="required">
							<option value="1">一级</option>
							<option value="2">二级</option>
							<option value="3">三级</option>
							<option value="4">四级</option>
							<option value="5">五级</option>
							<option value="6">六级</option>
							<option value="7">七级</option>
							<option value="8">八级</option>
							<option value="9"  selected="selected">九级</option>
						</select>

					</td>
				</tr>
				<tr>
					<th>计量时间</th>
					<td>
						<select style="width: 308px; height: 36px;" id="measurement_time" name="measurement_time" class="input_text" required="required">
							<option value="1" selected="selected">一月</option>
							<option value="2">二月</option>
							<option value="3">三月</option>
							<option value="4">四月</option>
							<option value="5">五月</option>
							<option value="6">六月</option>
							<option value="7">七月</option>
							<option value="8">八月</option>
							<option value="9">九月</option>
							<option value="10">十月</option>
							<option value="11">十一月</option>
							<option value="12">十二月</option>
						</select>

					</td>
				</tr>
				<tr>
					<th>订阅邮件</th>
					<td>
						<select style="width: 308px; height: 36px;" id="isAcceptEmail" name="isAcceptEmail" class="input_text" required="required">
							<option value="1">是</option>
							<option value="0" selected="selected">否</option>
						</select>
					</td>
				</tr>
				<tr>
					<th>订阅周期</th>
					<td>
						<select style="width: 308px; height: 36px;" id="rate" name="rate" class="input_text" required="required">
							<option value="1">当天</option>
							<option value="7" selected="selected">当周</option>
							<option value="30">当月</option>
						</select>
					</td>
				</tr>
			</table>
			<input type="button"   class="input_text2 easyui-validatebox"   value="添加公司"  onclick="appendsucompanyname()" style="left: 525px;top: 58px;position: absolute;"/>
			<!-- <input type="button"   class="input_text2 easyui-validatebox"   value="添加行业"  onclick="appendsuindustryclass()" style="left: 515px;top: 103px;position: absolute;"/> -->
			<!-- <input type="button"   class="input_text2 easyui-validatebox"   value="添加主营产品"  onclick="appendsumajor()" style="left: 515px;top: 147px;position: absolute;"/>
			<input type="button"   class="input_text2 easyui-validatebox" id="ddd"  value="添加常用仪器"  onclick="appendsuproductclasstwo()" style="left: 515px;top: 195px;position: absolute;"/> -->
			<!-- <input type="button"   class="input_text2 easyui-validatebox" id="ddd"  value="添加品牌"  onclick="appendsubrand()" style="left: 515px;top: 240px;position: absolute;"/>
			<input type="button"   class="input_text2 easyui-validatebox" id="ddd"  value="添加型号"  onclick="appendsumodel()" style="left: 515px;top: 280px;position: absolute;"/> -->
			<input type="button"   class="input_text2 easyui-validatebox"   value="添加常用联系人"  onclick="appendcontact()" style="left: 525px;top: 470px;position: absolute;"/>
			<input type="button"   class="input_text2 easyui-validatebox"   value="添加采购/跟单责任人"  onclick="appendsumember()" style="left: 525px;top: 530px;position: absolute;"/>
		</form>
	</div>
</div>

<script type="text/javascript">
    $('#major_product_coll').combotree({/*data-options="required:false" value="${item.major_product}"*/
        width:300,
        method:'get',
        url: '/productClass/combotreeData.json',
        multiple: true,
        onlyLeafCheck:true
    });

/* $("#su_productclass11").combotree({
	checkbox:true,
	multiple:true,
	cascadeCheck:true,
	required:false,
	url:'/admin/basedata/suproductclass/combotreeData.json',
	onSelect:function(node){
		if(node.attributes.parent_type_id == '0'){
			$("#su_productclass11").combotree('clear');
			alert('提示',"请选择详细类别");  
			return false;
		}
	}
}); */

 /*    $("#su_productclass11").combotree({
    	url:'/admin/basedata/suproductclass/combotreeData.json',
        checkbox: true,
        cascadeCheck: true,
        multiple:true,
        onCheck: function (node, checked) {
            if (checked) {
                var parentNode = $("#su_productclass11").tree('getParent', node.target);
        	alert(parentNode);
                if (parentNode != null) {
                    $("#su_productclass11").tree('check', parentNode.target);
                }
            } else {
                var childNode = $("#su_productclass11").tree('getChildren', node.target);
                if (childNode.length > 0) {
                    for (var i = 0; i < childNode.length; i++) {
                        $("#su_productclass11").tree('uncheck', childNode[i].target);
                    }
                }
            }
        }
    }); */



    var condition_company=true;
	 $("#name").combobox({
		required:true,
		valueField:'id',
		textField:'text',
		multiple:false,
		editable:true,
		url:'/admin/suCompanyName/get_sumember_names.jspx',
		onSelect:function(node){
			$.ajax({
				url:"/admin/SuModelCollection/register.jspx",
				data:{name:node.id},
				dataType:"json",
				type:"post",
				success:function(msg){
					if(msg.cont == 'false'){
						$(".rr_model").html('数据已存在，请修改！');
						condition_company=false;
						return false;
					}
					if(msg.cont == 'true'){
						$(".rr_model").text('');
						condition_company=true;
						return true;
					}
				},
				error:function(){
					alert("网络异常,请重试!");
					return false;
				}
			});
			var url ='/admin/suContacts/get_sumember_names.jspx?su_company_id='+node.id;
			$("#contact").combobox('reload',url);//input框中有树方法
			$.ajax({
				//几个参数需要注意一下
				type: "POST",//方法类型
				dataType: "json",//预期服务器返回的数据类型
				url: url ,//url
				success: function (result) {
					for (var i=0;i<result.length;i++){
                        $("#contact").combobox('select',result[i].id);//input框中有树方法
					}
				},
				error : function() {
					alert("添加异常！");
				}
			});
		}
	});
	
		
	
	
	/* $("#su_productclass_coll").combobox({
		onSelect:function(node){
					var id=$("#su_productclass_coll").combobox('getValues');
					var url ='/admin/suBrand/get_sumember_names.jspx?su_product_id='+id.toString();
					$("#su_brand_coll").combobox('reload',url);//input框中有树方法

		},
		onUnselect:function(node){
					var id=$("#su_productclass_coll").combobox('getValues');
					$("#su_brand_coll").combobox('clear');//刷新前，先清空树
					$("#su_model_coll").combobox('clear');//刷新前，先清空树
					var url ='/admin/suBrand/get_sumember_names.jspx?su_product_id='+id.toString();
					$("#su_brand_coll").combobox('reload',url);//input框中有树方法

		}
	});  */

	 $("#su_brand_coll").combobox({
		editable:true,
         filter: function (q, row) {
             var opts = $(this).combobox('options');
             return row.text.indexOf(q) >= 0||row.nameEn.toUpperCase().indexOf(q.toUpperCase())>=0;//这里改成>=即可在任意地方匹配
         },
         onHidePanel: function() {
             var valueField = $(this).combobox("options").valueField;
             var val = $(this).combobox("getValue");  //当前combobox的值
             var allData = $(this).combobox("getData");   //获取combobox所有数据
             var result = true;      //为true说明输入的值在下拉框数据中不存在
             for (var i = 0; i < allData.length; i++) {
                 if (val == allData[i][valueField]) {
                     result = false;
                     break;
                 }
             }
             if (result) {
                 PostbirdAlertBox.alert({
                     'title': '提 示',
                     'content': '请选择下拉框中的品牌',
                     'okBtn': '好的',
                     'contentColor': 'blue',
                     'onConfirm': function () {
                     }
                 });
                 $(this).combobox("clear");
             }
         }
	});

	/* $("#su_industry_class_coll").combobox({
		onSelect:function(node){
					var id=$("#su_industry_class_coll").combobox('getValues');
					$("#major_product_coll").combobox('clear');//刷新前，先清空树
				    $("#su_productclass").combobox('clear');//刷新前，先清空树
					$("#su_brand").combobox('clear');//刷新前，先清空树
					$("#su_model").combobox('clear');//刷新前，先清空树 
					var url ='/admin/suMajor/get_major_names.jspx?su_industry_id='+id.toString();
					$("#major_product_coll").combobox('reload',url);//input框中有树方法

		},
		onUnselect:function(node){
					var id=$("#su_industry_class_coll").combobox('getValues');
					$("#major_product_coll").combobox('clear');//刷新前，先清空树
					$("#su_productclass").combobox('clear');//刷新前，先清空树
					$("#su_brand").combobox('clear');//刷新前，先清空树
					$("#su_model").combobox('clear');//刷新前，先清空树 
					var url ='/admin/suMajor/get_major_names.jspx?su_industry_id='+id.toString();
					$("#major_product_coll").combobox('reload',url);//input框中有树方法

		}
	});  */
	
/* 	$("#major_product").combobox({
		onSelect:function(node){
					var id=$("#major_product").combobox('getValues');
					var url ='/admin/basedata/suproductclass/get_sumember_names.jspx?su_major_id='+id.toString();
					$("#su_productclass").combobox('reload',url);//input框中有树方法

		},
		onUnselect:function(node){
					var id=$("#major_product").combobox('getValues');
					$("#su_productclass").combobox('clear');//刷新前，先清空树
					var url ='/admin/basedata/suproductclass/get_sumember_names.jspx?su_major_id='+id.toString();
					$("#su_productclass").combobox('reload',url);//input框中有树方法

		}
	});  */
	
	//该方法判断公司是否为下拉选择，当为直接输入时，提醒，并禁止保存（当combobox失去焦点时触发）
		/*$("#name").combobox('textbox').bind('blur', function(e) {
		var name=$("#name").combobox('getValue');
		if(isNaN(name)){ //isNaN()函数，如果传入的参数是数字返回false,否则返回true
			$(".rr_model").text('不可输入，请下拉选择！');
			condition_company=false;
			return false;
		}

		$.ajax({
			url:"/admin/ModelCollection/register.jspx",
			data:{name:name},
			dataType:"json",
			type:"post",
			success:function(msg){
				if(msg.cont == 'false'){
					$(".rr_model").text('数据已存在，请修改！');
					condition_company=false;
					return false;
				}
				if(msg.cont == 'true'){
					$(".rr_model").text('');
					condition_company=true;
					return true;
				}
			},
			error:function(){
				alert("网络异常,请重试!");
				return false;
			}
		});
				$("#contact").combobox('clear');
				/!* var url ='/admin/mcContacts/get_mcmember_names.jspx?mc_company_id='+name; *!/
				var url ='/admin/suContacts/get_sumember_names.jspx?su_company_id='+name;
				$("#contact").combobox('reload',url);//input框中有树方法



	});*/

</script>
	