<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<div class="main" style="background-color: white;">
	<div class="easyui-panel" style="border-style: none;">
		<form id="addForm" method="post" class="validate">
			<table>
			<tr>
					<th>公司名</th>
					<td>
					<select style="width: 308px; height: 36px;"
										class="easyui-combobox"
										url="/admin/suCompanyName/get_sumember_names.jspx"  data-options="valueField:'id',textField:'text',editable:true"
										id="su_company" name="su_company" required="required"/> </select></td>
					<td><span class="rr_model" style="color: red"></span></td>
				</tr>
			   <tr>
					<th>联系人</th>
					<td><input class="input_text easyui-validatebox" type="text" id="co_name"
						name="name" data-options="required:true"></input>
					</td>
				</tr>
				 <tr>
					<th>职位</th>
					<td>
						<input class="input_text easyui-validatebox" type="text" 
					id="co_job"	name="job"  value="${item.job}"></input>
					</td>
				</tr> 
			   <tr>
					<th>电话</th>
					<td><input class="input_text easyui-validatebox" type="text" 
					id="co_phone" name="phone"></input>
					</td>
				</tr>
			   <tr>
					<th>邮箱</th>
					<td><input class="input_text easyui-validatebox" type="text" 
					id="co_mail" name="mail"></input>
					</td>
				</tr>
				<tr style="display: none">
					<th>排序</th>
					<td><input class="input_text easyui-numberbox" type="text" 
						name="sort" id="co_sort" data-options="required:true" value="1"></input>
					</td>
				</tr>
				<tr>
					<th>备注</th>
					<td><input class="input_text" type="text" id="co_remark"
						name="remark"  ></input>
					</td>
				</tr>
			</table>
			<input type="button" id="model_yincang"   class="input_text2 easyui-validatebox"   value="添加公司"  onclick="appendsucompanyname()" style="left: 400px;top: 58px;position: absolute;"/>
		</form>
	</div>
</div>
<script type="text/javascript">
	if('${model_yincang}'){//当从型号收集模块新增时，隐藏新增上级数据按钮
		$("#model_yincang").hide();
	}
    setTimeout(function () {//setTimeout方法是延时0.3s后执行的方法,因为后台取值传值需要时间
        if('${companyId}'){//如果是该个公司的id，后台传回来的公司id
            $("#su_company").combobox('select', '${companyId}');//easyUI的combobox的选中方式
        }
    }, 300)

	/*
	新增公司
	*/
	function submitFormsucompanyname(map) {
	var data = {};
	//data.status=$("#me_status").combobox('getValue');
	data.address=$("#cn_address").val();
	data.name=$("#cn_name").val();
	data.phone=$("#cn_phone").val();
	data.remark=$("#cn_remark").val();
	//var formflag = $(map["formId"]).form().form('validate');
	if (data.name != '' && data.phone != '' && condition_companyname) {
		$.Loading.show(map["loadshow"]);
		var options = {
			url : map["url"],
			type : "POST",
			dataType : 'json',
			data:data,
			success : function(result) {
				if (result.result == 1) {
					$.Loading.show(result.message);
					$(map["divDialog"]).dialog('close');
					//$(map["gridreload"]).datagrid('reload');
					$('#su_company').combobox('reload');//新增后，刷新树
				}
				if (result.result == 0) {
					$.Loading.error(result.message);
				}
				$.Loading.hide();
			},
			error : function(e) {
				alert("出现错误 ，请重试");
			}
		};
		console.log(data);
		$.ajax(options);
	}
	}
	
	
	function appendsucompanyname(id) {
	var map = {}; // Map map = new HashMap();
	if (!id) {
		map["href"] = "/admin/suCompanyName/add_suCompanyName.jspx";
		map["formId"] = "#addForm";
		map["url"] = "/admin/suCompanyName/doAdd_memberGrade.jspx?ajax=yes";
		map["title"] = "添加信息";
		map["loadshow"] = "正在添加......";
	} else {
		map["href"] = "/admin/suCompanyName/edit_memberGrade.jspx?id=" + id;
		map["formId"] = "#editForm";
		map["url"] = "/admin/suCompanyName/doEdit_memberGrade.jspx?ajax=yes";
		map["title"] = "修改信息";
		map["loadshow"] = "正修改......";
	}
	map["divDialog"] = "#divdia2";
	map["gridreload"] = "#memberdata";
	addDialogsucompanyname(map);
	}
	
	function addDialogsucompanyname(map) {
	$(map["divDialog"]).show();
	$(map["divDialog"]).dialog({
		title : map["title"],
		width : 600,
		height : 300,
		closed : false,
		cache : false,
		href : map["href"],
		modal : true,
		buttons : [ {
			text : '保存',
			iconCls : 'icon-ok',
			handler : function() {
				for(instance in CKEDITOR.instances){
					CKEDITOR.instances[instance].updateElement();
				}
				var savebtn = $(this);
					var disabled=savebtn.hasClass("l-btn-disabled");
					if(!disabled){
					 submitFormsucompanyname(map,savebtn);
				}
			}
		}, {
			text : '清空',
			handler : function() {
				clearForm(map);
			}
		} ]
	});
	}
</script>
