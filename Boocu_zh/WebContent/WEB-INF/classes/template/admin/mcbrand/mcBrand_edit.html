<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<div class="main" style="background-color: white;">
	<div class="easyui-panel" style="border-style: none;">
		<form id="editForm" method="post" class="validate">
			<table>
			<tr style="display:none">
						<th>id</th>
						<td><input class="input_text easyui-validatebox" type="text" 
							name="id" data-options="required:true" value="${item.id}" ></input>
						</td>
					</tr>
				 <tr>
				 <tr>
					<th>所属仪器</th>
					<td>
					<select style="width: 308px; height: 36px;"
										class="easyui-combobox"
										url="/admin/basedata/mcproductclass/get_productclass_names_two.jspx"  data-options="valueField:'id',textField:'text',editable:true,value:${item.mc_productclass}"
										id="mc_productclass" name="mc_productclass" required="required"/> </select></td>
					<td><span class="rr_model" style="color: red"></span></td>
				</tr>
			   <tr>
					<th>品牌名</th>
					<td><input class="input_text easyui-validatebox" type="text" id="mb_name"
						name="name" data-options="required:true" value="${item.name}"></input>
					</td>
				</tr>
				<tr>
					<th>排序</th>
					<td><input class="input_text easyui-numberbox" type="text" 
						name="sort" id="mb_sort" data-options="required:true" value="${item.sort}"></input>
					</td>
				</tr>
				<tr>
					<th>备注</th>
					<td><input class="input_text" type="text" id="mb_remark"
						name="remark"  value="${item.remark}"></input>
					</td>
				</tr>
			</table>
			<input type="button"   class="input_text2 easyui-validatebox"   value="添加仪器"  onclick="appendmcproductclass()" style="left: 400px;top: 58px;position: absolute;"/>
		</form>
	</div>
</div>
<script type="text/javascript">
	/*
	新增仪器
	*/
	function submitFormmcproductclass(map) {
	var data = {};
	data.mc_major=$("#mc_major").combobox('getValue'); 
	data.name=$("#pr_name").val();
	data.sort=$("#pr_sort").val();
	data.remark=$("#pr_remark").val();
	//var formflag = $(map["formId"]).form().form('validate');
	if (data.name != '' && data.sort != '') {
		$.Loading.show(map["loadshow"]);
		var options = {
			url : map["url"],
			type : "POST",
			dataType : 'json',
			data:data,
			success : function(result) {
				if (result.result == 1) {
					$.Loading.show(result.message);
					$(map["divDialog"]).dialog('close');
					//$(map["gridreload"]).datagrid('reload');
					$('#mc_productclass').combobox('reload');//新增后，刷新树
				}
				if (result.result == 0) {
					$.Loading.error(result.message);
				}
				$.Loading.hide();
			},
			error : function(e) {
				alert("出现错误 ，请重试");
			}
		};
		console.log(data);
		$.ajax(options);
	}
	}
	
	
	function appendmcproductclass(id) {
		var map = {}; // Map map = new HashMap();
		if (!id) {
			map["href"] = "/admin/basedata/mcproductclass/add_mcproductclass.jspx?model_yincang=true";
			map["formId"] = "#addForm";
			map["url"] = "/admin/basedata/mcproductclass/save_mcproductclass.jspx?ajax=yes";
			map["title"] = "添加常用仪器";
			map["loadshow"] = "正在添加......";
		} else {
			map["href"] = "/admin/basedata/mcproductclass/edit_mcproductclass.jspx?id=" + id;
			map["formId"] = "#editForm";
			map["url"] = "/admin/basedata/mcproductclass/save_edit_mcproductclass.jspx?ajax=yes";
			map["title"] = "修改常用仪器";
			map["loadshow"] = "正在修改......";
		}
		map["divDialog"] = "#divdia2";
		map["gridreload"] = "#dataList";
		addDialogmcproductclass(map);
	}
	
	function addDialogmcproductclass(map) {
	$(map["divDialog"]).show();
	$(map["divDialog"]).dialog({
		title : map["title"],
		width : 600,
		height : 300,
		closed : false,
		cache : false,
		href : map["href"],
		modal : true,
		buttons : [ {
			text : '保存',
			iconCls : 'icon-ok',
			handler : function() {
				for(instance in CKEDITOR.instances){
					CKEDITOR.instances[instance].updateElement();
				}
				var savebtn = $(this);
					var disabled=savebtn.hasClass("l-btn-disabled");
					if(!disabled){
					 submitFormmcproductclass(map,savebtn);
				}
			}
		}, {
			text : '清空',
			handler : function() {
				clearForm(map);
			}
		} ]
	});
	}
</script>
